<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian Mills">
<meta name="dcterms.date" content="2022-10-05">
<meta name="description" content="Create a TensorFlow.js plugin for the Unity game engine.">

<title>Christian Mills - Using Fastai and TensorFlow.js for Hand Gesture Recognition in Unity Pt. 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Christian Mills - Using Fastai and TensorFlow.js for Hand Gesture Recognition in Unity Pt. 2">
<meta property="og:description" content="Create a [TensorFlow.js](https://www.tensorflow.org/js) plugin for the [Unity](https://unity.com/) game engine.">
<meta property="og:image" content="christianjmills.com/images/logo.png">
<meta property="og:site-name" content="Christian Mills">
<meta property="og:image:height" content="295">
<meta property="og:image:width" content="300">
<meta name="twitter:title" content="Christian Mills - Using Fastai and TensorFlow.js for Hand Gesture Recognition in Unity Pt. 2">
<meta name="twitter:description" content="Create a [TensorFlow.js](https://www.tensorflow.org/js) plugin for the [Unity](https://unity.com/) game engine.">
<meta name="twitter:image" content="christianjmills.com/images/logo.png">
<meta name="twitter:creator" content="@cdotjdotmills">
<meta name="twitter:site" content="@cdotjdotmills">
<meta name="twitter:image-height" content="295">
<meta name="twitter:image-width" content="300">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Christian Mills</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:christian@christianjmills.com"><i class="bi bi-envelope-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cj-mills"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/cdotjdotmills"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tutorial-links" id="toc-tutorial-links" class="nav-link active" data-scroll-target="#tutorial-links">Tutorial Links</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#set-up-unity-hub" id="toc-set-up-unity-hub" class="nav-link" data-scroll-target="#set-up-unity-hub">Set Up Unity Hub</a></li>
  <li><a href="#install-unity-editor" id="toc-install-unity-editor" class="nav-link" data-scroll-target="#install-unity-editor">Install Unity Editor</a></li>
  <li><a href="#create-new-project" id="toc-create-new-project" class="nav-link" data-scroll-target="#create-new-project">Create New Project</a></li>
  <li><a href="#import-assets" id="toc-import-assets" class="nav-link" data-scroll-target="#import-assets">Import Assets</a></li>
  <li><a href="#create-javascript-utility-file" id="toc-create-javascript-utility-file" class="nav-link" data-scroll-target="#create-javascript-utility-file">Create JavaScript Utility File</a></li>
  <li><a href="#create-jslib-plugin" id="toc-create-jslib-plugin" class="nav-link" data-scroll-target="#create-jslib-plugin">Create jslib Plugin</a></li>
  <li><a href="#import-plugin-functions" id="toc-import-plugin-functions" class="nav-link" data-scroll-target="#import-plugin-functions">Import Plugin Functions</a></li>
  <li><a href="#create-image-classifier-script" id="toc-create-image-classifier-script" class="nav-link" data-scroll-target="#create-image-classifier-script">Create Image Classifier Script</a>
  <ul class="collapse">
  <li><a href="#define-public-variables" id="toc-define-public-variables" class="nav-link" data-scroll-target="#define-public-variables">Define public variables</a></li>
  <li><a href="#define-private-variables" id="toc-define-private-variables" class="nav-link" data-scroll-target="#define-private-variables">Define private variables</a></li>
  <li><a href="#define-initialization-methods" id="toc-define-initialization-methods" class="nav-link" data-scroll-target="#define-initialization-methods">Define Initialization Methods</a></li>
  <li><a href="#define-awake-method" id="toc-define-awake-method" class="nav-link" data-scroll-target="#define-awake-method">Define Awake method</a></li>
  <li><a href="#define-start-method" id="toc-define-start-method" class="nav-link" data-scroll-target="#define-start-method">Define Start method</a></li>
  <li><a href="#define-processing-methods" id="toc-define-processing-methods" class="nav-link" data-scroll-target="#define-processing-methods">Define Processing Methods</a></li>
  <li><a href="#define-update-method" id="toc-define-update-method" class="nav-link" data-scroll-target="#define-update-method">Define Update method</a></li>
  <li><a href="#define-gui-methods" id="toc-define-gui-methods" class="nav-link" data-scroll-target="#define-gui-methods">Define GUI Methods</a></li>
  </ul></li>
  <li><a href="#set-up-unity-scene" id="toc-set-up-unity-scene" class="nav-link" data-scroll-target="#set-up-unity-scene">Set up Unity Scene</a></li>
  <li><a href="#test-in-browser" id="toc-test-in-browser" class="nav-link" data-scroll-target="#test-in-browser">Test in Browser</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using Fastai and TensorFlow.js for Hand Gesture Recognition in Unity Pt. 2</h1>
  <div class="quarto-categories">
    <div class="quarto-category">fastai</div>
    <div class="quarto-category">unity</div>
    <div class="quarto-category">tensorflow</div>
    <div class="quarto-category">webgl</div>
  </div>
  </div>

<div>
  <div class="description">
    Create a <a href="https://www.tensorflow.org/js">TensorFlow.js</a> plugin for the <a href="https://unity.com/">Unity</a> game engine.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian Mills </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 5, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#set-up-unity-hub">Set Up Unity Hub</a></li>
<li><a href="#install-unity-editor">Install Unity Editor</a></li>
<li><a href="#create-new-project">Create New Project</a></li>
<li><a href="#import-assets">Import Assets</a></li>
<li><a href="#create-javascript-utility-file">Create JavaScript Utility File</a></li>
<li><a href="#create-jslib-plugin">Create jslib Plugin</a></li>
<li><a href="#import-plugin-functions">Import Plugin Functions</a></li>
<li><a href="#create-image-classifier-script">Create Image Classifier Script</a></li>
<li><a href="#set-up-unity-scene">Set up Unity Scene</a></li>
<li><a href="#test-in-browser">Test in Browser</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
<section id="tutorial-links" class="level2">
<h2 class="anchored" data-anchor-id="tutorial-links">Tutorial Links</h2>
<ul>
<li><a href="../part-1/">Part 1</a>: Train a hand gesture classifier using fastai and export it to TensorFlow.js.</li>
<li><a href="../part-2/">Part 2</a>: Create a TensorFlow.js plugin for the Unity game engine.</li>
<li><a href="../part-3/">Part 3</a>: Build a Unity project as a WebGL application and host it using GitHub Pages.</li>
<li><a href="https://github.com/cj-mills/tensorflow-js-unity-tutorial">GitHub Repository</a></li>
</ul>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In Part 2 of this tutorial series, we first install Unity Hub, download a Unity Editor, and create a new Unity project. Next, we will import any required assets and add a JavaScript utility file and <a href="https://docs.unity3d.com/Manual/webgl-interactingwithbrowserscripting.html">jslib plugin</a>. We will then create an image classifier script to use our trained model in Unity and set up the Unity scene to use it. Finally, we will test our project in a browser. By the end of this post, you will have a working TensorFlow.js plugin for Unity that you can use to recognize hand gestures in your projects.</p>
</section>
<section id="set-up-unity-hub" class="level2">
<h2 class="anchored" data-anchor-id="set-up-unity-hub">Set Up Unity Hub</h2>
<p>Before creating a project, we must install <a href="https://unity3d.com/get-unity/download">Unity Hub</a>, create a <a href="https://id.unity.com/">UnityID account</a>, and activate a (free) Unity license. The beginner Unity tutorial at the link below covers all these steps and how to create a simple flappy bird-style game.</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=8rdfcq-jePw&amp;t=113s">Make Your First Video Game - Ultimate Beginner Unity3D Tutorial</a></li>
</ul>
<p>The link opens to the part covering how to install Unity for the first time, but I recommend watching the entire tutorial for those new to Unity.</p>
</section>
<section id="install-unity-editor" class="level2">
<h2 class="anchored" data-anchor-id="install-unity-editor">Install Unity Editor</h2>
<p>After installing Unity Hub and activating a license, we must add a version of the Unity Editor. We will use the latest 2022.1+ release. The tutorial uses 2022.1.19, which you can install directly from the link below.</p>
<ul>
<li><strong>Unity download archive:</strong> <a href="unityhub://2022.1.19f1/2fd7b40534d1">Unity 2022.1.19</a></li>
</ul>
<p>Open Unity Hub and select the <code>Installs</code> section in the side panel. Then click the <code>Install Editor</code> button in the upper right-hand corner.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-installs.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Click the <code>Install</code> button next to the latest <code>2022.1</code> version under <code>Other Versions</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-installs-select-2022-1-19.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Scroll down the <code>Add modules</code> selection menu and click the check box next to <code>WebGL Build Support</code>. Click the <code>Install</code> button after selecting all desired modules.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-install-2022-1-19-with-webgl.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Unity Hub will begin downloading and installing the selected editor version.</p>
</section>
<section id="create-new-project" class="level2">
<h2 class="anchored" data-anchor-id="create-new-project">Create New Project</h2>
<p>Go back to the <code>Projects</code> section after the editor finishes installing and click <code>New Project</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-new-project.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Select the target editor version from the <code>Editor Version</code> dropdown menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-new-project-select-unity-version.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Select the <code>2D Core</code> template.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-new-project-select-2D-template.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Pick a name for the project and a location for the project folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-new-project-name-project.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Finally, click <code>Create Project</code> in the lower right-hand corner.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-new-project-click-create-project.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The Unity Editor may take a few minutes to open the new project.</p>
</section>
<section id="import-assets" class="level2">
<h2 class="anchored" data-anchor-id="import-assets">Import Assets</h2>
<p>Inside the editor window, we will first import any class labels, test images, and TensorFlow.js models into the <code>Assets</code> folder.</p>
<p><strong>Import class labels</strong></p>
<p>Right-click a space in the <code>Assets</code> section and select <code>Create → Folder</code> from the popup menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Name the new folder <code>ClassLabels</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-classlabels-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Drag and drop any JSON class label files from the operating system’s file explorer into the <code>ClassLabels</code> folder. Sample files are available in the Google Drive link below.</p>
<ul>
<li><strong>Google Drive:</strong> <a href="https://drive.google.com/drive/folders/1PzdlGfKMScGKhvnIlSPZ1EQDbErkXxkR?usp=sharing">ClassLabels</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-import-classlabels.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Import sample images</strong></p>
<p>Next, create an <code>Images</code> folder and drop any test images into it. Sample files are available in the Google Drive link below.</p>
<p><strong>Google Drive:</strong> <a href="https://drive.google.com/drive/folders/1T8C_22m7Rwd6S1FlJG5NdZ2TVMMB_WpB?usp=sharing">Images</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-import-image-assets.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Unity automatically imports images as a Sprite (2D and UI) <a href="https://docs.unity3d.com/Manual/TextureTypes.html">texture type</a>. We don’t need to change it for our purposes.</p>
<p><strong>Import TFJS models</strong></p>
<p>We need to place the TensorFlow.js models in a <a href="https://docs.unity3d.com/Manual/StreamingAssets.html">StreamingAssets</a> folder to include them in the final application. Create a new folder named <code>StreamingAssets</code>. Let’s put the folders for each model in a new subfolder called <code>TFJSModels</code> to keep things organized.</p>
<ul>
<li><strong>Google Drive:</strong> <a href="https://drive.google.com/drive/folders/1H86x7jrS7Bj-4305NclBTHO7VANgm4PG?usp=sharing">TFJSModels</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-tfjs-models-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Inside each subfolder are the JSON and BIN files for a TensorFlow.js model.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-inspect-tfjs-models-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="create-javascript-utility-file" class="level2">
<h2 class="anchored" data-anchor-id="create-javascript-utility-file">Create JavaScript Utility File</h2>
<p>Before creating the jslib plugin, we’ll add a JavaScript file with a utility function to the <code>StreamingAssets</code> folder. Open the <code>StreamingAssets</code> folder in a code editor and create a new JavaScript file called <code>utils.js</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/vscode-create-javascript-utility-file.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Define function to perform inference asynchronously</strong></p>
<p>This function will take in the model, input data, and shape for the input tensor as input.</p>
<p>We can use the <a href="https://js.tensorflow.org/api/latest/#tidy"><code>tf. tidy()</code></a> method included with TensorFlow.js for automatic memory cleanup. TensorFlow.js also provides a built-in <a href="https://js.tensorflow.org/api/latest/#argMax">ArgMax</a> to extract the predicted class index.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Perform inference with the provided model and input data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">PerformInferenceAsync</span>(model<span class="op">,</span> float32Data<span class="op">,</span> shape) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> outputData <span class="op">=</span> tf<span class="op">.</span><span class="fu">tidy</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialize the input tensor</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> input_tensor <span class="op">=</span> tf<span class="op">.</span><span class="fu">tensor</span>(float32Data<span class="op">,</span> shape<span class="op">,</span> <span class="st">'float32'</span>)<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Make a prediction.</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> model<span class="op">.</span><span class="fu">predict</span>(input_tensor)<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pass raw output through a SoftMax function</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> results <span class="op">=</span> <span class="cf">await</span> outputData<span class="op">.</span><span class="fu">data</span>()<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Extract the predicted class from the model output</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> index <span class="op">=</span> <span class="cf">await</span> tf<span class="op">.</span><span class="fu">argMax</span>(results)<span class="op">.</span><span class="fu">data</span>()<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [index<span class="op">,</span> results[index]]<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-jslib-plugin" class="level2">
<h2 class="anchored" data-anchor-id="create-jslib-plugin">Create jslib Plugin</h2>
<p>Now we can create the jslib <a href="https://docs.unity3d.com/Manual/webgl-interactingwithbrowserscripting.html">plugin</a> to use the TensorFlow.js models. In the <code>Assets</code> section, create a new folder called <code>Plugins</code>. Then create a subfolder called <code>WebGL</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-webgl-plugins-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Open the <code>WebGL</code> folder in a code editor and create a new file called <code>WebGLPlugin.jslib</code>. For formatting purposes, we can set the jslib file as JavaScript.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/vscode-create-jslib-file-and-set-language-format.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Basic plugin format</strong></p>
<p>Here is the basic format for the jslib plugin. We’ll place any functions we want accessible from Unity inside the <code>plugin</code> variable.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Define plugin functions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> plugin <span class="op">=</span> {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Add plugin functions</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mergeInto</span>(LibraryManager<span class="op">.</span><span class="at">library</span><span class="op">,</span> plugin)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define function to add external JavaScript dependencies</strong></p>
<p>We first need to add the script tag for the TensorFlow.js <a href="https://www.npmjs.com/package/@tensorflow/tfjs">npm package</a> and the <code>utils.js</code> script in the <code>StreamingAssets</code> folder.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Add additional JavaScript dependencies to the html page</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>GetExternalJS<span class="op">:</span> <span class="kw">function</span> () {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add base TensorFlow.js dependencies</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> tfjs_script <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"script"</span>)<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    tfjs_script<span class="op">.</span><span class="at">src</span> <span class="op">=</span> <span class="st">"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0/dist/tf.min.js"</span><span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">head</span><span class="op">.</span><span class="fu">appendChild</span>(tfjs_script)<span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add custom utility functions</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> script <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"script"</span>)<span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    script<span class="op">.</span><span class="at">src</span> <span class="op">=</span> <span class="st">"./StreamingAssets/utils.js"</span><span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">head</span><span class="op">.</span><span class="fu">appendChild</span>(script)<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define function to set the TensorFlow.js compute backend</strong></p>
<p>Next, we’ll add a function to update the compute backend. At the time of writing, I only recommend using the <a href="https://github.com/tensorflow/tfjs/tree/master/tfjs-backend-webgl">WebGL backend</a>. The base <a href="https://github.com/tensorflow/tfjs/tree/master/tfjs-backend-cpu">CPU backend</a> is not suitable for real-time applications. The <a href="https://github.com/tensorflow/tfjs/tree/master/tfjs-backend-wasm">WASM backend</a> enables multi-threaded CPU inference but does not have full operator support. Lastly, the <a href="https://github.com/tensorflow/tfjs/tree/master/tfjs-backend-webgpu">WebGPU backend</a> is not yet officially supported by browsers.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Set the TFJS inference backend</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>SetTFJSBackend<span class="op">:</span> <span class="kw">function</span> (backend) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> backend_str <span class="op">=</span> <span class="fu">UTF8ToString</span>(backend)<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>     tf<span class="op">.</span><span class="fu">setBackend</span>(backend_str)<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> { })<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>     <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Successfully set </span><span class="sc">${</span>backend_str<span class="sc">}</span><span class="vs"> backend.`</span>)<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>     <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Error occurred. Falling back to WebGL backend."</span>)<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>     tf<span class="op">.</span><span class="fu">setBackend</span>(<span class="st">'webgl'</span>)<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define function to Initialize a TensorFlow.js model</strong></p>
<p>We’ll pass a file path for a <code>model.json</code> file and an array to store the predicted class index and the corresponding confidence score. We’ll be able to access the updated array values in Unity.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Load a TFJS model</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>InitTFJSModel<span class="op">:</span> <span class="kw">async</span> <span class="kw">function</span> (model_path<span class="op">,</span> output_data) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert bytes to the text</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> model_path_str <span class="op">=</span> <span class="fu">UTF8ToString</span>(model_path)<span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load the TensorFlow.js model at the provided file path</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">model</span> <span class="op">=</span> <span class="cf">await</span> tf<span class="op">.</span><span class="fu">loadGraphModel</span>(model_path_str<span class="op">,</span> { <span class="dt">fromTFHub</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check the model input shape</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> input_shape <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">.</span><span class="at">inputs</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">shape</span><span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Input Shape: </span><span class="sc">${</span>input_shape<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize an array to store the predicted class index and confidence score</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">prediction</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(buffer<span class="op">,</span> output_data<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define function to perform inference with a input image</strong></p>
<p>Loading the model can take several seconds, depending on the user’s internet connection. We don’t want to perform inference until after it initializes.</p>
<p>Due to the way Unity reads texture data from the GPU to the CPU, we need to read the image data from the bottom up to make the image correctly oriented.</p>
<p>After populating the input array, we’ll wait for the asynchronous inference function to finish before updating the prediction array.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Perform inference with the provided image data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>PerformInference<span class="op">:</span> <span class="kw">function</span> (image_data<span class="op">,</span> size<span class="op">,</span> width<span class="op">,</span> height) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Only perform inference after loading a model</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">typeof</span> <span class="kw">this</span><span class="op">.</span><span class="at">model</span> <span class="op">==</span> <span class="st">'undefined'</span>) {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Model not defined yet"</span>)<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize an array with the raw image data</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> uintArray <span class="op">=</span> <span class="kw">new</span> <span class="bu">Uint8ClampedArray</span>(buffer<span class="op">,</span> image_data<span class="op">,</span> size<span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Channels-last order</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [input_array] <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(<span class="kw">new</span> <span class="bu">Array</span>())<span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Flip input image from Unity</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> row <span class="op">=</span> height <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> row <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> row<span class="op">--</span>) {</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> slice <span class="op">=</span> uintArray<span class="op">.</span><span class="fu">slice</span>(row <span class="op">*</span> width <span class="op">*</span> <span class="dv">3</span><span class="op">,</span> (row <span class="op">*</span> width <span class="op">*</span> <span class="dv">3</span>) <span class="op">+</span> (width <span class="op">*</span> <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Scale color values from [0,255] to [0,1]</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">let</span> col <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> col <span class="op">&lt;</span> slice<span class="op">.</span><span class="at">length</span><span class="op">;</span> col <span class="op">+=</span> <span class="dv">3</span>) {</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>            input_array<span class="op">.</span><span class="fu">push</span>(slice[col <span class="op">+</span> <span class="dv">0</span>]<span class="op">/</span><span class="dv">255</span>)<span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            input_array<span class="op">.</span><span class="fu">push</span>(slice[col <span class="op">+</span> <span class="dv">1</span>]<span class="op">/</span><span class="dv">255</span>)<span class="op">;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            input_array<span class="op">.</span><span class="fu">push</span>(slice[col <span class="op">+</span> <span class="dv">2</span>]<span class="op">/</span><span class="dv">255</span>)<span class="op">;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the input array with the preprocessed input data</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> float32Data <span class="op">=</span> <span class="bu">Float32Array</span><span class="op">.</span><span class="fu">from</span>(input_array)<span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> shape <span class="op">=</span> [<span class="dv">1</span><span class="op">,</span> height<span class="op">,</span> width<span class="op">,</span> <span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pass preprocessed input to the model</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">PerformInferenceAsync</span>(<span class="kw">this</span><span class="op">.</span><span class="at">model</span><span class="op">,</span> float32Data<span class="op">,</span> shape)<span class="op">.</span><span class="fu">then</span>(output <span class="kw">=&gt;</span> {</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Store class index and confidence value</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">prediction</span>[<span class="dv">0</span>] <span class="op">=</span> output[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">prediction</span>[<span class="dv">1</span>] <span class="op">=</span> output[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That’s it for the plugin code. Next, we need to import the functions in Unity.</p>
</section>
<section id="import-plugin-functions" class="level2">
<h2 class="anchored" data-anchor-id="import-plugin-functions">Import Plugin Functions</h2>
<p>We’ll import the plugin functions in a dedicated C# script and make them accessible as a static class. Right-click a space inside the <code>WebGL</code> folder and select <code>Create → C# Script</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-c-sharp-script.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Name the new script WebGLPlugin.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-webgl-plugin-script.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Default script code</strong></p>
<p>By default, C# scripts contain the following code. We don’t need any of it in this case.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ImageClassifier <span class="op">:</span> MonoBehaviour</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start is called before the first frame update</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update is called once per frame</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">Update</span><span class="op">()</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We need the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices?view=net-5.0">System.Runtime.InteropServices</a> namespace to handle interactions with the jslib plugin.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Runtime</span><span class="op">.</span><span class="fu">InteropServices</span><span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// Class with JavaScript plugin functions for WebGL.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> WebGLPlugin</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Import "GetExternalJS" plugin function</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span><span class="st">"__Internal"</span><span class="op">)]</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">GetExternalJS</span><span class="op">();</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Import "SetTFJSBackend" plugin function</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span><span class="st">"__Internal"</span><span class="op">)]</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">SetTFJSBackend</span><span class="op">(</span><span class="dt">string</span> backend<span class="op">);</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Import "InitTFJSModel" plugin function</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span><span class="st">"__Internal"</span><span class="op">)]</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">InitTFJSModel</span><span class="op">(</span><span class="dt">string</span> model_path<span class="op">,</span> <span class="dt">float</span><span class="op">[]</span> output_data<span class="op">,</span> <span class="dt">int</span> output_size<span class="op">);</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Import "PerformInference" plugin function</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span><span class="st">"__Internal"</span><span class="op">)]</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">bool</span> <span class="fu">PerformInference</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> image_data<span class="op">,</span> <span class="dt">int</span> size<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">);</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-image-classifier-script" class="level2">
<h2 class="anchored" data-anchor-id="create-image-classifier-script">Create Image Classifier Script</h2>
<p>Now we can create the main script for the Unity project. This script will handle getting input images, sending them to the model, and using the returned predictions to update on-screen readouts. We’ll store it in a new <code>Scripts</code> folder and name it <code>ImageClassifier</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/create-image-classifier-script.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Add required namespaces</strong></p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system?view=net-5.0">System</a>: Contains fundamental classes and base classes that define commonly-used value and reference data types, events and event handlers, interfaces, attributes, and processing exceptions.</li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.ugui@1.0/api/UnityEngine.UI.html">UnityEngine.UI</a>: Provides access to UI elements.</li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.core@5.9/api/UnityEngine.Rendering.html">UnityEngine.Rendering</a>: Provides access to the elements of the rendering pipeline.</li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.io?view=net-7.0">System.IO</a>: Contains types that allow reading and writing to files and data streams, and types that provide basic file and directory support.</li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.multiplayer-hlapi@1.0/api/UnityEngine.Networking.html">UnityEngine.Networking</a>: Provides access to the <a href="https://docs.unity3d.com/ScriptReference/Networking.UnityWebRequest.html">UnityWebRequest</a> module to communicate with http services.</li>
</ul>
<hr>
<div class="sourceCode" id="cb9"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">.</span><span class="fu">UI</span><span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">IO</span><span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">.</span><span class="fu">Networking</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Add code to create a list of available TFJS models</strong></p>
<p>We can’t browse for available TFJS models while running the Unity application in the browser, so we need to create a list of model names and file paths to check at runtime. We can do this automatically within the Unity Editor.</p>
<p>Unity provides an <a href="https://docs.unity3d.com/Manual/RunningEditorCodeOnLaunch.html">InitializeOnLoad</a> attribute to run code in the Unity Editor without requiring action from the user. This attribute requires the <a href="https://docs.unity3d.com/ScriptReference/UnityEditor.html">UnityEditor</a> namespace. We can only use this while in the Editor, so we need to wrap the code in <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/preprocessor-directives#conditional-compilation">Conditional compilation</a> preprocessor directives. This code will go right below the namespaces.</p>
<p>We use the <code>UNITY_EDITOR</code> <a href="https://docs.unity3d.com/Manual/PlatformDependentCompilation.html">scripting symbol</a> to check whether we are in the Unity Editor. When we are in the Editor, it returns true, and the code executes.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">#if</span> UNITY_EDITOR</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEditor<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>InitializeOnLoad<span class="op">]</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Startup</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// A helper class that stores the name and file path for a TensorFlow.js model</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span>System<span class="op">.</span><span class="fu">Serializable</span><span class="op">]</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ModelData</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">string</span> name<span class="op">;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">string</span> path<span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">ModelData</span><span class="op">(</span><span class="dt">string</span> name<span class="op">,</span> <span class="dt">string</span> path<span class="op">)</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">name</span> <span class="op">=</span> name<span class="op">;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">path</span> <span class="op">=</span> path<span class="op">;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// A helper class that stores a list of TensorFlow.js model names and file paths</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span>System<span class="op">.</span><span class="fu">Serializable</span><span class="op">]</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ModelList</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> List<span class="op">&lt;</span>ModelData<span class="op">&gt;</span> models<span class="op">;</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">ModelList</span><span class="op">(</span>List<span class="op">&lt;</span>ModelData<span class="op">&gt;</span> models<span class="op">)</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">models</span> <span class="op">=</span> models<span class="op">;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="fu">Startup</span><span class="op">()</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> tfjsModelsDir <span class="op">=</span> <span class="st">"TFJSModels"</span><span class="op">;</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>        List<span class="op">&lt;</span>ModelData<span class="op">&gt;</span> models <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>ModelData<span class="op">&gt;();</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Available models"</span><span class="op">);</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the paths for each model folder</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> dir <span class="kw">in</span> Directory<span class="op">.</span><span class="fu">GetDirectories</span><span class="op">(</span>$<span class="st">"{Application.streamingAssetsPath}/{tfjsModelsDir}"</span><span class="op">))</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>            <span class="dt">string</span> dirStr <span class="op">=</span> dir<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"</span><span class="sc">\\</span><span class="st">"</span><span class="op">,</span> <span class="st">"/"</span><span class="op">);</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Extract the model folder name</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>            <span class="dt">string</span><span class="op">[]</span> splits <span class="op">=</span> dirStr<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="ch">'/'</span><span class="op">);</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>            <span class="dt">string</span> modelName <span class="op">=</span> splits<span class="op">[</span>splits<span class="op">.</span><span class="fu">Length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Get the paths for the model.json file for each model</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> file <span class="kw">in</span> Directory<span class="op">.</span><span class="fu">GetFiles</span><span class="op">(</span>dirStr<span class="op">))</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>file<span class="op">.</span><span class="fu">EndsWith</span><span class="op">(</span><span class="st">"model.json"</span><span class="op">))</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">string</span> fileStr <span class="op">=</span> file<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"</span><span class="sc">\\</span><span class="st">"</span><span class="op">,</span> <span class="st">"/"</span><span class="op">).</span><span class="fu">Replace</span><span class="op">(</span>Application<span class="op">.</span><span class="fu">streamingAssetsPath</span><span class="op">,</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>                    models<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ModelData</span><span class="op">(</span>modelName<span class="op">,</span> fileStr<span class="op">));</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>        ModelList modelList <span class="op">=</span> <span class="kw">new</span> <span class="fu">ModelList</span><span class="op">(</span>models<span class="op">);</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Format the list of available models as a string in JSON format</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> json <span class="op">=</span> JsonUtility<span class="op">.</span><span class="fu">ToJson</span><span class="op">(</span>modelList<span class="op">);</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Model List JSON: {json}"</span><span class="op">);</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Write the list of available TensorFlow.js models to a JSON file</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> StreamWriter writer <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamWriter</span><span class="op">(</span>$<span class="st">"{Application.streamingAssetsPath}/models.json"</span><span class="op">);</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>        writer<span class="op">.</span><span class="fu">Write</span><span class="op">(</span>json<span class="op">);</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="kw">#endif</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code runs after opening the project in the Unity Editor or saving changes to this script. We can verify the code works by saving the script and going to the <code>StreamingAssets</code> folder in the Editor. The <code>models.json</code> file should be present.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-verify-initializeonload.png" class="img-fluid figure-img"></p>
</figure>
</div>
<section id="define-public-variables" class="level3">
<h3 class="anchored" data-anchor-id="define-public-variables">Define public variables</h3>
<p>We’ll add the required public variables above the Start method. We will be able to access these variables in the Inspector tab. We can add <a href="https://docs.unity3d.com/ScriptReference/HeaderAttribute.html">Header</a> attributes to organize the public variables in the Inspector tab and use <a href="https://docs.unity3d.com/ScriptReference/TooltipAttribute.html">Tooltip</a> attributes to provide information about variables.</p>
<p><strong>Define scene object variables</strong></p>
<p>First, we need a variable to access the screen object that displays either a test image or webcam input.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"Scene Objects"</span><span class="op">)]</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The Screen object for the scene"</span><span class="op">)]</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Transform screen<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define data processing variables</strong></p>
<p>We can set the default target input resolution to 216 and use it to scale the source resolution while maintaining the original aspect ratio.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"Data Processing"</span><span class="op">)]</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The target minimum model input dimensions"</span><span class="op">)]</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> targetDim <span class="op">=</span> <span class="dv">216</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define output processing variables</strong></p>
<p>We pass in the JSON file containing the class labels as a <a href="https://docs.unity3d.com/ScriptReference/TextAsset.html">TextAsset</a>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"Output Processing"</span><span class="op">)]</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"A json file containing the class labels"</span><span class="op">)]</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> TextAsset classLabels<span class="op">;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Minimum confidence score for keeping predictions"</span><span class="op">)]</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Range</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> 1f<span class="op">)]</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">float</span> minConfidence <span class="op">=</span> <span class="fl">0.5f</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define variables for debugging</strong></p>
<p>Next, we’ll add a Boolean variable to toggle printing debug messages to the console. These messages get printed to the console in the browser as well.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"Debugging"</span><span class="op">)]</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Print debugging messages to the console"</span><span class="op">)]</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">bool</span> printDebugMessages <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define webcam variables</strong></p>
<p>We need to specify a desired resolution and framerate when using a webcam as input.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"Webcam"</span><span class="op">)]</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Use a webcam as input"</span><span class="op">)]</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">bool</span> useWebcam <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The requested webcam dimensions"</span><span class="op">)]</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Vector2Int webcamDims <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">(</span><span class="dv">1280</span><span class="op">,</span> <span class="dv">720</span><span class="op">);</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The requested webcam framerate"</span><span class="op">)]</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Range</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">60</span><span class="op">)]</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> webcamFPS <span class="op">=</span> <span class="dv">60</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define variables for user interface</strong></p>
<p>We’ll make a simple GUI that displays the predicted class, the current framerate, and controls for selecting webcam devices, models, and backends.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"GUI"</span><span class="op">)]</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Display predicted class"</span><span class="op">)]</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">bool</span> displayPredictedClass <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Display fps"</span><span class="op">)]</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">bool</span> displayFPS <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The on-screen text color"</span><span class="op">)]</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Color textColor <span class="op">=</span> Color<span class="op">.</span><span class="fu">yellow</span><span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The scale value for the on-screen font size"</span><span class="op">)]</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Range</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">99</span><span class="op">)]</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> fontScale <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The number of seconds to wait between refreshing the fps value"</span><span class="op">)]</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Range</span><span class="op">(</span><span class="fl">0.01f</span><span class="op">,</span> <span class="fl">1.0f</span><span class="op">)]</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">float</span> fpsRefreshRate <span class="op">=</span> <span class="fl">0.1f</span><span class="op">;</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The toggle for using a webcam as the input source"</span><span class="op">)]</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Toggle useWebcamToggle<span class="op">;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The dropdown menu that lists available webcam devices"</span><span class="op">)]</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Dropdown webcamDropdown<span class="op">;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The dropdown menu that lists available TFJS models"</span><span class="op">)]</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Dropdown modelDropdown<span class="op">;</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The dropdown menu that lists available TFJS backends"</span><span class="op">)]</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Dropdown backendDropdown<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define TensorFlow.js variables</strong></p>
<p>We’ll store the path to the <code>StreamingAssets</code> sub-folder containing the TensorFlow.js models in a string variable.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"TFJS"</span><span class="op">)]</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The name of the TFJS models folder"</span><span class="op">)]</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">string</span> tfjsModelsDir <span class="op">=</span> <span class="st">"TFJSModels"</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-private-variables" class="level3">
<h3 class="anchored" data-anchor-id="define-private-variables">Define private variables</h3>
<p>We’ll add the required private variables right below the public variables.</p>
<p><strong>Define private webcam variables</strong></p>
<p>We’ll keep a list of available webcam devices so users can switch between them. Unity renders webcam input to a <a href="https://docs.unity3d.com/ScriptReference/WebCamTexture.html">WebcamTexture</a>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// List of available webcam devices</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> WebCamDevice<span class="op">[]</span> webcamDevices<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Live video input from a webcam</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> WebCamTexture webcamTexture<span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">// The name of the current webcam  device</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span> currentWebcam<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define input variables</strong></p>
<p>We’ll update the dimensions and content of the screen object based on the test image or webcam.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// The test image dimensions</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Vector2Int imageDims<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">// The test image texture</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>Texture imageTexture<span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">// The current screen object dimensions</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>Vector2Int screenDims<span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">// The model GPU input texture</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>RenderTexture inputTextureGPU<span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">// The model CPU input texture</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>Texture2D inputTextureCPU<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define variables for class labels</strong></p>
<p>We need to create a little class that indicates the structure of the JSON content. Our JSON file only contains a single array of strings. We can store this array in a dedicated variable.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// A class for reading in class labels from a JSON file</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ClassLabels <span class="op">{</span> <span class="kw">public</span> <span class="dt">string</span><span class="op">[]</span> classes<span class="op">;</span> <span class="op">}</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">// The ordered list of class names</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span><span class="op">[]</span> classes<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define variable to track whether a model is initialized</strong></p>
<p>We’ll track whether a model is ready for inference so we can tell the user if a model is still loading.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores whether the TensorFlow.js model is ready for inference</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> modelInitialized<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define variables for tracking the framerate</strong></p>
<p>Lastly, we need to define a couple of variables for the custom fps counter.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// The current frame rate value</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> fps <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Controls when the frame rate value updates</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">float</span> fpsTimer <span class="op">=</span> 0f<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define variables to store values for GUI dropdowns</strong></p>
<p>We’ll update the lists of model paths and names at runtime using the <code>models.json</code> file in the <code>StreamingAssets</code> folder.</p>
<p>As mentioned previously, I only recommend using the WebGL backend at the time of writing, so we’ll hardcode that option here. In the future, we can check if each backend type is available in the jslib plugin and update the list in Unity.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// File paths for the available TFJS models</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> modelPaths <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Names of the available TFJS models</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> modelNames <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Names of the available TFJS backends</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> tfjsBackends <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> <span class="op">{</span> <span class="st">"webgl"</span> <span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define variable to store the current inference output</strong></p>
<p>We’ll share the memory for this array with the jslib plugin. We’ll update the values in the plugin and access them in this script.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the latest model prediction and confidence score</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span><span class="op">[]</span> output_data <span class="op">=</span> <span class="kw">new</span> <span class="dt">float</span><span class="op">[</span><span class="dv">2</span><span class="op">];</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define variables for reading the <code>models.json</code> file</strong></p>
<p>We need to create a couple of helper classes that indicate the structure of the <code>models.json</code> file.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// A helper class to store the name and file path of a TensorFlow.js model</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>System<span class="op">.</span><span class="fu">Serializable</span><span class="op">]</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ModelData <span class="op">{</span> <span class="kw">public</span> <span class="dt">string</span> name<span class="op">;</span> <span class="kw">public</span> <span class="dt">string</span> path<span class="op">;</span> <span class="op">}</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">// A helper class to store a read a list of available TensorFlow.js models from a JSON file</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>System<span class="op">.</span><span class="fu">Serializable</span><span class="op">]</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ModelList <span class="op">{</span> <span class="kw">public</span> List<span class="op">&lt;</span>ModelData<span class="op">&gt;</span> models<span class="op">;</span> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-initialization-methods" class="level3">
<h3 class="anchored" data-anchor-id="define-initialization-methods">Define Initialization Methods</h3>
<p>We first need to define some methods to initialize webcams, the screen object, any GUI dropdown menus, and the in-game camera.</p>
<p><strong>Define method to initialize a webcam device</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Initialize the selected webcam device</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"deviceName"</span><span class="kw">&gt;</span><span class="co">The name of the selected webcam device</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">InitializeWebcam</span><span class="op">(</span><span class="dt">string</span> deviceName<span class="op">)</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stop any webcams already playing</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>webcamTexture <span class="op">&amp;&amp;</span> webcamTexture<span class="op">.</span><span class="fu">isPlaying</span><span class="op">)</span> webcamTexture<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a new WebCamTexture</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    webcamTexture <span class="op">=</span> <span class="kw">new</span> <span class="fu">WebCamTexture</span><span class="op">(</span>deviceName<span class="op">,</span> webcamDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> webcamDims<span class="op">.</span><span class="fu">y</span><span class="op">,</span> webcamFPS<span class="op">);</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start the webcam</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    webcamTexture<span class="op">.</span><span class="fu">Play</span><span class="op">();</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if webcam is playing</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    useWebcam <span class="op">=</span> webcamTexture<span class="op">.</span><span class="fu">isPlaying</span><span class="op">;</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update toggle value</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    useWebcamToggle<span class="op">.</span><span class="fu">SetIsOnWithoutNotify</span><span class="op">(</span>useWebcam<span class="op">);</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>useWebcam <span class="op">?</span> <span class="st">"Webcam is playing"</span> <span class="op">:</span> <span class="st">"Webcam not playing, option disabled"</span><span class="op">);</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to initialize the in-scene screen object</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Resize and position an in-scene screen object</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">InitializeScreen</span><span class="op">()</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the texture for the screen object</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    screen<span class="op">.</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>MeshRenderer<span class="op">&gt;().</span><span class="fu">material</span><span class="op">.</span><span class="fu">mainTexture</span> <span class="op">=</span> useWebcam <span class="op">?</span> webcamTexture <span class="op">:</span> imageTexture<span class="op">;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the screen dimensions</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    screenDims <span class="op">=</span> useWebcam <span class="op">?</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">(</span>webcamTexture<span class="op">.</span><span class="fu">width</span><span class="op">,</span> webcamTexture<span class="op">.</span><span class="fu">height</span><span class="op">)</span> <span class="op">:</span> imageDims<span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Flip the screen around the Y-Axis when using webcam</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> yRotation <span class="op">=</span> useWebcam <span class="op">?</span> 180f <span class="op">:</span> 0f<span class="op">;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Invert the scale value for the Z-Axis when using webcam</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> zScale <span class="op">=</span> useWebcam <span class="op">?</span> <span class="op">-</span>1f <span class="op">:</span> 1f<span class="op">;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set screen rotation</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    screen<span class="op">.</span><span class="fu">rotation</span> <span class="op">=</span> Quaternion<span class="op">.</span><span class="fu">Euler</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> yRotation<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the screen dimensions</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    screen<span class="op">.</span><span class="fu">localScale</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>screenDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> screenDims<span class="op">.</span><span class="fu">y</span><span class="op">,</span> zScale<span class="op">);</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the screen position</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    screen<span class="op">.</span><span class="fu">position</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>screenDims<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> screenDims<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to switch TensorFlow.js models</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Load a TensorFlow.js model</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateTFJSModel</span><span class="op">()</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load TensorFlow.js model in JavaScript plugin</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    WebGLPlugin<span class="op">.</span><span class="fu">InitTFJSModel</span><span class="op">(</span>modelPaths<span class="op">[</span>modelDropdown<span class="op">.</span><span class="fu">value</span><span class="op">],</span> output_data<span class="op">,</span> output_data<span class="op">.</span><span class="fu">Length</span><span class="op">);</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to read the list of available TensorFlow.js models</strong></p>
<p>We can parse the raw JSON content from the <code>models.json</code> file using the <a href="https://docs.unity3d.com/ScriptReference/JsonUtility.FromJson.html"><code>JsonUtility.FromJson()</code></a> method. We’ll then update the associated GUI dropdown with the available model names.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Get the names and paths of the available TensorFlow.js models</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"json"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">GetTFJSModels</span><span class="op">(</span><span class="dt">string</span> json<span class="op">)</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    ModelList modelList <span class="op">=</span> JsonUtility<span class="op">.</span><span class="fu">FromJson</span><span class="op">&lt;</span>ModelList<span class="op">&gt;(</span>json<span class="op">);</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>ModelData model <span class="kw">in</span> modelList<span class="op">.</span><span class="fu">models</span><span class="op">)</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Debug.Log($"{model.name}: {model.path}");</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        modelNames<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>model<span class="op">.</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> path <span class="op">=</span> $<span class="st">"{Application.streamingAssetsPath}{model.path}"</span><span class="op">;</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        modelPaths<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>path<span class="op">);</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove default dropdown options</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    modelDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add TFJS model names to menu</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    modelDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>modelNames<span class="op">);</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the first option in the dropdown</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    modelDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to download the list of available TensorFlow.js models</strong></p>
<p>At runtime, we must fetch the <code>models.json</code> file from the hosting server before parsing its content. Getting the file is an asynchronous operation, so we’ll use a <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.StartCoroutine.html">coroutine</a>. Once we have the file, we’ll pass it to the <code>GetTFJSModels</code> method.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Download the JSON file with the available TFJS model information</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"uri"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;&lt;/returns&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>IEnumerator <span class="fu">GetRequest</span><span class="op">(</span><span class="dt">string</span> uri<span class="op">)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="op">(</span>UnityWebRequest webRequest <span class="op">=</span> UnityWebRequest<span class="op">.</span><span class="fu">Get</span><span class="op">(</span>uri<span class="op">))</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Request and wait for the desired page.</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">yield</span> <span class="kw">return</span> webRequest<span class="op">.</span><span class="fu">SendWebRequest</span><span class="op">();</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span><span class="op">[]</span> pages <span class="op">=</span> uri<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="ch">'/'</span><span class="op">);</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> page <span class="op">=</span> pages<span class="op">.</span><span class="fu">Length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">switch</span> <span class="op">(</span>webRequest<span class="op">.</span><span class="fu">result</span><span class="op">)</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">case</span> UnityWebRequest<span class="op">.</span><span class="fu">Result</span><span class="op">.</span><span class="fu">ConnectionError</span><span class="op">:</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">case</span> UnityWebRequest<span class="op">.</span><span class="fu">Result</span><span class="op">.</span><span class="fu">DataProcessingError</span><span class="op">:</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">LogError</span><span class="op">(</span>pages<span class="op">[</span>page<span class="op">]</span> <span class="op">+</span> <span class="st">": Error: "</span> <span class="op">+</span> webRequest<span class="op">.</span><span class="fu">error</span><span class="op">);</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">break</span><span class="op">;</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">case</span> UnityWebRequest<span class="op">.</span><span class="fu">Result</span><span class="op">.</span><span class="fu">ProtocolError</span><span class="op">:</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">LogError</span><span class="op">(</span>pages<span class="op">[</span>page<span class="op">]</span> <span class="op">+</span> <span class="st">": HTTP Error: "</span> <span class="op">+</span> webRequest<span class="op">.</span><span class="fu">error</span><span class="op">);</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                <span class="kw">break</span><span class="op">;</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">case</span> UnityWebRequest<span class="op">.</span><span class="fu">Result</span><span class="op">.</span><span class="fu">Success</span><span class="op">:</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>pages<span class="op">[</span>page<span class="op">]</span> <span class="op">+</span> <span class="st">":</span><span class="sc">\n</span><span class="st">Received: "</span> <span class="op">+</span> webRequest<span class="op">.</span><span class="fu">downloadHandler</span><span class="op">.</span><span class="fu">text</span><span class="op">);</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Extract the available model names and file paths from the JSON string</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">GetTFJSModels</span><span class="op">(</span>webRequest<span class="op">.</span><span class="fu">downloadHandler</span><span class="op">.</span><span class="fu">text</span><span class="op">);</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Initialize one of the available TensorFlow.js models</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">UpdateTFJSModel</span><span class="op">();</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>                <span class="kw">break</span><span class="op">;</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to initialize GUI dropdown menu options</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Initialize the GUI dropdown list</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">InitializeDropdown</span><span class="op">()</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create list of webcam device names</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> webcamNames <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>WebCamDevice device <span class="kw">in</span> webcamDevices<span class="op">)</span> webcamNames<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>device<span class="op">.</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove default dropdown options</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    webcamDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add webcam device names to dropdown menu</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    webcamDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>webcamNames<span class="op">);</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the dropdown to the current webcam device</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    webcamDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span>webcamNames<span class="op">.</span><span class="fu">IndexOf</span><span class="op">(</span>currentWebcam<span class="op">));</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the available TensorFlow.js models</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> modelListPath <span class="op">=</span> $<span class="st">"{Application.streamingAssetsPath}/models.json"</span><span class="op">;</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">StartCoroutine</span><span class="op">(</span><span class="fu">GetRequest</span><span class="op">(</span>modelListPath<span class="op">));</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove default dropdown options</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    backendDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add TFJS backend names to menu</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    backendDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>tfjsBackends<span class="op">);</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the first option in the dropdown</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    backendDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to initialize the in-scene camera object</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Resize and position the main camera based on an in-scene screen object</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"screenDims"</span><span class="kw">&gt;</span><span class="co">The dimensions of an in-scene screen object</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">InitializeCamera</span><span class="op">(</span>Vector2Int screenDims<span class="op">,</span> <span class="dt">string</span> cameraName <span class="op">=</span> <span class="st">"Main Camera"</span><span class="op">)</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get a reference to the Main Camera GameObject</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    GameObject camera <span class="op">=</span> GameObject<span class="op">.</span><span class="fu">Find</span><span class="op">(</span>cameraName<span class="op">);</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the camera position to account for updates to the screenDims</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">position</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>screenDims<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> screenDims<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span>10f<span class="op">);</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Render objects with no perspective (i.e. 2D)</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>Camera<span class="op">&gt;().</span><span class="fu">orthographic</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the camera size to account for updates to the screenDims</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>Camera<span class="op">&gt;().</span><span class="fu">orthographicSize</span> <span class="op">=</span> screenDims<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-awake-method" class="level3">
<h3 class="anchored" data-anchor-id="define-awake-method">Define Awake method</h3>
<p>We’ll call the <code>GetExternalJS</code> function from the jslib plugin in the <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.Awake.html">Awake()</a> method.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Awake is called when the script instance is being loaded</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">Awake</span><span class="op">()</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    WebGLPlugin<span class="op">.</span><span class="fu">GetExternalJS</span><span class="op">();</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-start-method" class="level3">
<h3 class="anchored" data-anchor-id="define-start-method">Define Start method</h3>
<p>The <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.Start.html">Start</a> method is <a href="https://docs.unity3d.com/Manual/ExecutionOrder.html">called</a> once before the first frame update, so we’ll perform any required setup steps here.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Start is called before the first frame update</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the source image texture</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    imageTexture <span class="op">=</span> screen<span class="op">.</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>MeshRenderer<span class="op">&gt;().</span><span class="fu">material</span><span class="op">.</span><span class="fu">mainTexture</span><span class="op">;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the source image dimensions as a Vector2Int</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    imageDims <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">(</span>imageTexture<span class="op">.</span><span class="fu">width</span><span class="op">,</span> imageTexture<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize list of available webcam devices</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    webcamDevices <span class="op">=</span> WebCamTexture<span class="op">.</span><span class="fu">devices</span><span class="op">;</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>WebCamDevice device <span class="kw">in</span> webcamDevices<span class="op">)</span> Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>device<span class="op">.</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    currentWebcam <span class="op">=</span> webcamDevices<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">name</span><span class="op">;</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    useWebcam <span class="op">=</span> webcamDevices<span class="op">.</span><span class="fu">Length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> useWebcam <span class="op">:</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize webcam</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>useWebcam<span class="op">)</span> <span class="fu">InitializeWebcam</span><span class="op">(</span>currentWebcam<span class="op">);</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Resize and position the screen object using the source image dimensions</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeScreen</span><span class="op">();</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Resize and position the main camera using the source image dimensions</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeCamera</span><span class="op">(</span>screenDims<span class="op">);</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize list of class labels from JSON file</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> JsonUtility<span class="op">.</span><span class="fu">FromJson</span><span class="op">&lt;</span>ClassLabels<span class="op">&gt;(</span>classLabels<span class="op">.</span><span class="fu">text</span><span class="op">).</span><span class="fu">classes</span><span class="op">;</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the webcam dropdown list</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeDropdown</span><span class="op">();</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the current TensorFlow.js compute backend</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    WebGLPlugin<span class="op">.</span><span class="fu">SetTFJSBackend</span><span class="op">(</span>tfjsBackends<span class="op">[</span>backendDropdown<span class="op">.</span><span class="fu">value</span><span class="op">]);</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-processing-methods" class="level3">
<h3 class="anchored" data-anchor-id="define-processing-methods">Define Processing Methods</h3>
<p>Next, we need to define a preprocessing method to calculate the input resolution.</p>
<p><strong>Define method to calculate input resolution</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Scale the source image resolution to the target input dimensions</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// while maintaing the source aspect ratio.</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"imageDims"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"targetDims"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;&lt;/returns&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>Vector2Int <span class="fu">CalculateInputDims</span><span class="op">(</span>Vector2Int imageDims<span class="op">,</span> <span class="dt">int</span> targetDim<span class="op">)</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clamp the minimum dimension value to 64px</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    targetDim <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Max</span><span class="op">(</span>targetDim<span class="op">,</span> <span class="dv">64</span><span class="op">);</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    Vector2Int inputDims <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">();</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the input dimensions using the target minimum dimension</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>imageDims<span class="op">.</span><span class="fu">x</span> <span class="op">&gt;=</span> imageDims<span class="op">.</span><span class="fu">y</span><span class="op">)</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        inputDims<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>imageDims<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> <span class="op">((</span><span class="dt">float</span><span class="op">)</span>imageDims<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>targetDim<span class="op">));</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        inputDims<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> targetDim<span class="op">;</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>        inputDims<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> targetDim<span class="op">;</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>        inputDims<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>imageDims<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="op">((</span><span class="dt">float</span><span class="op">)</span>imageDims<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>targetDim<span class="op">));</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> inputDims<span class="op">;</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-update-method" class="level3">
<h3 class="anchored" data-anchor-id="define-update-method">Define Update method</h3>
<p>We’ll place anything we want to run every frame in the <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.Update.html">Update</a> method.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Update is called once per frame</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">Update</span><span class="op">()</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    useWebcam <span class="op">=</span> webcamDevices<span class="op">.</span><span class="fu">Length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> useWebcam <span class="op">:</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>useWebcam<span class="op">)</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialize webcam if it is not already playing</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(!</span>webcamTexture <span class="op">||</span> <span class="op">!</span>webcamTexture<span class="op">.</span><span class="fu">isPlaying</span><span class="op">)</span> <span class="fu">InitializeWebcam</span><span class="op">(</span>currentWebcam<span class="op">);</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Skip the rest of the method if the webcam is not initialized</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>webcamTexture<span class="op">.</span><span class="fu">width</span> <span class="op">&lt;=</span> <span class="dv">16</span><span class="op">)</span> <span class="kw">return</span><span class="op">;</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Make sure screen dimensions match webcam resolution when using webcam</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>screenDims<span class="op">.</span><span class="fu">x</span> <span class="op">!=</span> webcamTexture<span class="op">.</span><span class="fu">width</span><span class="op">)</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Resize and position the screen object using the source image dimensions</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">InitializeScreen</span><span class="op">();</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Resize and position the main camera using the source image dimensions</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">InitializeCamera</span><span class="op">(</span>screenDims<span class="op">);</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span>webcamTexture <span class="op">&amp;&amp;</span> webcamTexture<span class="op">.</span><span class="fu">isPlaying</span><span class="op">)</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Stop the current webcam</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        webcamTexture<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Resize and position the screen object using the source image dimensions</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">InitializeScreen</span><span class="op">();</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Resize and position the main camera using the source image dimensions</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">InitializeCamera</span><span class="op">(</span>screenDims<span class="op">);</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Scale the source image resolution</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    Vector2Int inputDims <span class="op">=</span> <span class="fu">CalculateInputDims</span><span class="op">(</span>screenDims<span class="op">,</span> targetDim<span class="op">);</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the input texture with the calculated input dimensions</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    inputTextureGPU <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>inputDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> inputDims<span class="op">.</span><span class="fu">y</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">ARGB32</span><span class="op">);</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(!</span>inputTextureCPU <span class="op">||</span> inputTextureCPU<span class="op">.</span><span class="fu">width</span> <span class="op">!=</span> inputTextureGPU<span class="op">.</span><span class="fu">width</span><span class="op">)</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>        inputTextureCPU <span class="op">=</span> <span class="kw">new</span> <span class="fu">Texture2D</span><span class="op">(</span>inputDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> inputDims<span class="op">.</span><span class="fu">y</span><span class="op">,</span> TextureFormat<span class="op">.</span><span class="fu">RGB24</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>printDebugMessages<span class="op">)</span> Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Input Dims: {inputTextureGPU.width}x{inputTextureGPU.height}"</span><span class="op">);</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Copy the source texture into model input texture</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>    Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">((</span>useWebcam <span class="op">?</span> webcamTexture <span class="op">:</span> imageTexture<span class="op">),</span> inputTextureGPU<span class="op">);</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Download pixel data from GPU to CPU</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    RenderTexture<span class="op">.</span><span class="fu">active</span> <span class="op">=</span> inputTextureGPU<span class="op">;</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    inputTextureCPU<span class="op">.</span><span class="fu">ReadPixels</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Rect</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> inputTextureGPU<span class="op">.</span><span class="fu">width</span><span class="op">,</span> inputTextureGPU<span class="op">.</span><span class="fu">height</span><span class="op">),</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    inputTextureCPU<span class="op">.</span><span class="fu">Apply</span><span class="op">();</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the current input dimensions</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width <span class="op">=</span> inputTextureCPU<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> height <span class="op">=</span> inputTextureCPU<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size <span class="op">=</span> width <span class="op">*</span> height <span class="op">*</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pass the input data to the plugin to perform inference</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    modelInitialized <span class="op">=</span> WebGLPlugin<span class="op">.</span><span class="fu">PerformInference</span><span class="op">(</span>inputTextureCPU<span class="op">.</span><span class="fu">GetRawTextureData</span><span class="op">(),</span> size<span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if index is valid</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>printDebugMessages<span class="op">)</span> Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>modelInitialized <span class="op">?</span> $<span class="st">"Predicted Class: {classes[(int)output_data[0]]}"</span> <span class="op">:</span> <span class="st">"Not Initialized"</span><span class="op">);</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Release the input texture</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>    RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>inputTextureGPU<span class="op">);</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-gui-methods" class="level3">
<h3 class="anchored" data-anchor-id="define-gui-methods">Define GUI Methods</h3>
<p>We need some methods to handle user interactions with the GUI and display the predicted class and current framerate.</p>
<p><strong>Define method to update webcam usage from GUI</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// This method is called when the value for the webcam toggle changes</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"useWebcam"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateWebcamToggle</span><span class="op">(</span><span class="dt">bool</span> useWebcam<span class="op">)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">useWebcam</span> <span class="op">=</span> useWebcam<span class="op">;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to update webcam device from GUI</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// The method is called when the selected value for the webcam dropdown changes</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateWebcamDevice</span><span class="op">()</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    currentWebcam <span class="op">=</span> webcamDevices<span class="op">[</span>webcamDropdown<span class="op">.</span><span class="fu">value</span><span class="op">].</span><span class="fu">name</span><span class="op">;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Selected Webcam: {currentWebcam}"</span><span class="op">);</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize webcam if it is not already playing</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>useWebcam<span class="op">)</span> <span class="fu">InitializeWebcam</span><span class="op">(</span>currentWebcam<span class="op">);</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Resize and position the screen object using the source image dimensions</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeScreen</span><span class="op">();</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Resize and position the main camera using the source image dimensions</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeCamera</span><span class="op">(</span>screenDims<span class="op">);</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to update the TensorFlow.js backend</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Update the TensorFlow.js compute backend</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateTFJSBackend</span><span class="op">()</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    WebGLPlugin<span class="op">.</span><span class="fu">SetTFJSBackend</span><span class="op">(</span>tfjsBackends<span class="op">[</span>backendDropdown<span class="op">.</span><span class="fu">value</span><span class="op">]);</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define method to update the confidence threshold</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Update the minimum confidence score for keeping predictions</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"slider"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateConfidenceThreshold</span><span class="op">(</span>Slider slider<span class="op">)</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    minConfidence <span class="op">=</span> slider<span class="op">.</span><span class="fu">value</span><span class="op">;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Define OnGUI method</strong></p>
<p>We’ll display the predicted class and current frame rate in the <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnGUI.html">OnGUI</a> method. We’ll show a different message while the model is still loading.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OnGUI is called for rendering and handling GUI events.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">OnGUI</span><span class="op">()</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define styling information for GUI elements</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    GUIStyle style <span class="op">=</span> <span class="kw">new</span> GUIStyle</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>        fontSize <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>Screen<span class="op">.</span><span class="fu">width</span> <span class="op">*</span> <span class="op">(</span>1f <span class="op">/</span> <span class="op">(</span>100f <span class="op">-</span> fontScale<span class="op">)))</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    style<span class="op">.</span><span class="fu">normal</span><span class="op">.</span><span class="fu">textColor</span> <span class="op">=</span> textColor<span class="op">;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define screen spaces for GUI elements</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    Rect slot1 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Rect</span><span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">500</span><span class="op">);</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    Rect slot2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Rect</span><span class="op">(</span><span class="dv">10</span><span class="op">,</span> style<span class="op">.</span><span class="fu">fontSize</span> <span class="op">*</span> <span class="fl">1.5f</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">500</span><span class="op">);</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Verify predicted class index is valid</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> labelText <span class="op">=</span> $<span class="st">"{classes[(int)output_data[0]]} {(output_data[1] * 100).ToString("</span><span class="fl">0.</span>##<span class="st">")}%"</span><span class="op">;</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>output_data<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">&lt;</span> minConfidence<span class="op">)</span> labelText <span class="op">=</span> <span class="st">"None"</span><span class="op">;</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> content <span class="op">=</span> modelInitialized <span class="op">?</span> $<span class="st">"Predicted Class: {labelText}"</span> <span class="op">:</span> <span class="st">"Loading Model..."</span><span class="op">;</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>displayPredictedClass<span class="op">)</span> GUI<span class="op">.</span><span class="fu">Label</span><span class="op">(</span>slot1<span class="op">,</span> <span class="kw">new</span> <span class="fu">GUIContent</span><span class="op">(</span>content<span class="op">),</span> style<span class="op">);</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update framerate value</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>Time<span class="op">.</span><span class="fu">unscaledTime</span> <span class="op">&gt;</span> fpsTimer<span class="op">)</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        fps <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>1f <span class="op">/</span> Time<span class="op">.</span><span class="fu">unscaledDeltaTime</span><span class="op">);</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        fpsTimer <span class="op">=</span> Time<span class="op">.</span><span class="fu">unscaledTime</span> <span class="op">+</span> fpsRefreshRate<span class="op">;</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust screen position when not showing predicted class</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    Rect fpsRect <span class="op">=</span> displayPredictedClass <span class="op">?</span> slot2 <span class="op">:</span> slot1<span class="op">;</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>displayFPS<span class="op">)</span> GUI<span class="op">.</span><span class="fu">Label</span><span class="op">(</span>fpsRect<span class="op">,</span> <span class="kw">new</span> <span class="fu">GUIContent</span><span class="op">(</span>$<span class="st">"FPS: {fps}"</span><span class="op">),</span> style<span class="op">);</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That’s it for the code.</p>
</section>
</section>
<section id="set-up-unity-scene" class="level2">
<h2 class="anchored" data-anchor-id="set-up-unity-scene">Set up Unity Scene</h2>
<p>We can, at last, start setting up our Unity scene. We need a screen to display the webcam feed, an empty object to attach the <code>ImageClassifier</code> script, a dropdown menu for selecting webcam devices, and a toggle to switch between the test image and a webcam feed.</p>
<p><strong>Create Screen object</strong></p>
<p>Right-click a space in the Hierarchy tab and select <code>3D Object → Quad</code>. We can name the new object <code>Screen</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-quad.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Next, drag and drop a test image from the <code>Assets → Images</code> folder onto the <code>Screen</code> object in the Scene view. Note that the Screen looks a bit dim. We need to change the shader for the Screen’s Material so that it does not require an external light source.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-attach-image-to-screen.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Select the Screen in the Hierarchy tab and open the Shader dropdown menu in the Inspector tab. Type <code>Unlit/Texture</code> into the search box and press enter.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-update-screen-material-shader.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Create Inference Manager object</strong></p>
<p>Right-click a space in the Hierarchy tab and select Create Empty. Name the empty object <code>InferenceManager</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-empty-gameobject.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>With the <code>InferenceManager</code> object selected, drag the <code>ImageClassifier</code> script into the Inspector tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-attach-image-classifier-script.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Now we can assign the Screen and class labels file in the Inspector tab by dragging them into their respective fields.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-assign-image-classifier-script-assets.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Add GUI prefab</strong></p>
<p>We still need to create the GUI toggle and dropdown menu. To save time, I made a <a href="https://docs.unity3d.com/Manual/Prefabs.html">Prefab</a> that we can drop into the Scene.</p>
<ul>
<li><strong>Google Drive:</strong> <a href="https://drive.google.com/drive/folders/1K3tgzMmNavqamlHPsrQn26K6A0n1uinb?usp=sharing">Prefabs folder</a></li>
</ul>
<p>Drag and drop the <code>Prefabs</code> folder into the <code>Assets</code> section.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-import-prefabs-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Open the <code>Prefabs</code> folder and drag the Canvas prefab into the Hierarchy tab. We can see the GUI by switching to the Game view.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-add-canvas-to-hierarchy-tab.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Configure Webcam Toggle On Value Changed function</strong></p>
<p>Next, we need to pair the <code>WebcamToggle</code> with the <code>UpdateWebcamToggle</code> function in the <code>ImageClassifier</code> script. Expand the Canvas object and select the <code>WebcamToggle</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-select-webcamtoggle.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Click and drag the <code>InferenceManager</code> into the <code>On Value Changed</code> field.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-webcamtoggle-assign-inference-manager.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Open the <code>No Function</code> dropdown menu and select <code>ImageClassifier → UpdateWebcamToggle</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-webcamtoggle-assign-inference-manager-function.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Configure Webcam Dropdown On Value Changed function</strong></p>
<p>We can follow the same steps to pair the <code>WebcamDropdown</code> with the <code>UpdateWebcamDevice</code> function in the <code>ImageClassifier</code> script.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-webcamdropdown-assign-inference-manager.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>This time select <code>ImageClassifier → UpdateWebcamDevice</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-webcamdropdown-assign-inference-manager-function.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Configure <code>TFJSModelDropdown</code> On Value Changed function</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-update-tfjs-model-dropdown-on-value-changed.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Configure <code>TFJSBackendDropdown</code> On Value Changed function</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-update-tfjs-backend-dropdown-on-value-changed.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Configure <code>ConfidenceThresholdSlider</code> On Value Changed Event</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-update-confidence-threshold-slider-on-value-changed.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Assign GUI objects to Inference Manager</strong></p>
<p>We can now assign the <code>WebcamToggle</code> and <code>WebcamDropdown</code> objects to their respective fields for the <code>ImageClassifier</code> script.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-inference-manager-assign-gui-objects.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Add Event System</strong></p>
<p>Before we can use the GUI, we need to add an Event System. Right-click a space in the Hierarchy tab and select <code>UI → Event System</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-add-eventsystem.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="test-in-browser" class="level2">
<h2 class="anchored" data-anchor-id="test-in-browser">Test in Browser</h2>
<p>Now, we can build the project and test it in a web browser. In the Unity project, select <code>File → Build Settings...</code> in the top menu bar to open the Build Settings window.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-open-build-settings.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Select <code>WebGL</code> from the list of platforms and click Switch Platform.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-build-settings-switch-to-webgl.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Unity enables compression by default for WebGL builds, which GitHub Pages does not support. We can disable compression in the Player Settings. Click the <code>Player Settings...</code> button in the bottom-left corner of the Build Settings window.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-build-settings-open-player-settings.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Select <code>Disabled</code> from the Compression Format dropdown menu and close the Project Settings window.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-player-settings-disable-webgl-compression.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>We can test the WebGL build locally by clicking <code>Build and Run</code> in the Build Settings window.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-build-settings-build-and-run.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Unity will prompt us to select a folder to store the build files. Create a new folder called <code>Build</code>. Open the folder and click <code>Select Folder</code> to start the build process.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-select-build-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Unity caps the framerate to the default <a href="https://docs.unity3d.com/ScriptReference/Application-targetFrameRate.html">target framerate</a> for the platform. My desktop display maxes out at 60fps.</p>
<p><strong>Test ConvNeXt nano performance</strong></p>
<p>Performance for the ConvNeXt nano model fluctuates in the mid to high 50s. That is significantly lower than native inference options like OpenVINO or DirectML but still usable. GPU utilization seems to max out around 34% on my desktop.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/in-browser-test-convnext.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Test ResNet18 performance</strong></p>
<p>The smaller ResNet18 model reaches the display’s 60fps max refresh rate but likely also falls far short of native inference options.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/in-browser-test-resnet.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this post, we installed Unity Hub, downloaded a Unity Editor, and created a new Unity project. We then imported the required assets and added a JavaScript utility file and jslib plugin. Next, we created an image classifier script to use our trained model in Unity and set up the Unity scene to use it. Finally, we tested our project in a browser. With this completed, we are ready to move on to Part 3 of this tutorial series, where we will host our Unity project as a live demo on <a href="https://pages.github.com/">GitHub Pages</a>.</p>
<p><strong>Previous:</strong> <a href="../part-1/">In-Browser Hand Gesture Recognition for Unity with Fastai and TensorFlow.js Pt. 1</a></p>
<p><strong>Next:</strong> <a href="../part-3/">In-Browser Hand Gesture Recognition for Unity with Fastai and TensorFlow.js Pt. 3</a></p>
<p><strong>Project Resources:</strong> <a href="https://github.com/cj-mills/tensorflow-js-unity-tutorial">GitHub Repository</a></p>
<!-- Cloudflare Web Analytics -->
<script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;56b8d2f624604c4891327b3c0d9f6703&quot;}"></script>
<!-- End Cloudflare Web Analytics -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="cj-mills/christianjmills" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright 2023, Christian J. Mills
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>