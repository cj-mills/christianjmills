<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian Mills">
<meta name="dcterms.date" content="2023-05-07">
<meta name="description" content="Walk through the code for the Unity Barracuda Inference PoseNet package, which extends the functionality of unity-barracuda-inference-base to perform 2D human pose estimation using PoseNet models.">

<title>Christian Mills - Code Walkthrough: Unity Barracuda Inference PoseNet Package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Christian Mills - Code Walkthrough: Unity Barracuda Inference PoseNet Package">
<meta property="og:description" content="Walk through the code for the Unity Barracuda Inference PoseNet package, which extends the functionality of unity-barracuda-inference-base to perform 2D human pose estimation using PoseNet models.">
<meta property="og:image" content="https://christianjmills.com/images/default-preview-image-black.png">
<meta property="og:site_name" content="Christian Mills">
<meta property="og:image:height" content="284">
<meta property="og:image:width" content="526">
<meta name="twitter:title" content="Christian Mills - Code Walkthrough: Unity Barracuda Inference PoseNet Package">
<meta name="twitter:description" content="Walk through the code for the Unity Barracuda Inference PoseNet package, which extends the functionality of unity-barracuda-inference-base to perform 2D human pose estimation using PoseNet models.">
<meta name="twitter:image" content="https://christianjmills.com/images/default-preview-image-black.png">
<meta name="twitter:creator" content="@cdotjdotmills">
<meta name="twitter:site" content="@cdotjdotmills">
<meta name="twitter:image-height" content="284">
<meta name="twitter:image-width" content="526">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Christian Mills</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../series/tutorials/index.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../series/notes/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:christian@christianjmills.com"> <i class="bi bi-envelope-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cj-mills"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/cdotjdotmills"> <i class="bi bi-twitter-x" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/christianjmills"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#package-overview" id="toc-package-overview" class="nav-link" data-scroll-target="#package-overview">Package Overview</a></li>
  <li><a href="#code-explanation" id="toc-code-explanation" class="nav-link" data-scroll-target="#code-explanation">Code Explanation</a>
  <ul>
  <li><a href="#posenetposeestimator.cs" id="toc-posenetposeestimator.cs" class="nav-link" data-scroll-target="#posenetposeestimator.cs"><code>PoseNetPoseEstimator.cs</code></a>
  <ul class="collapse">
  <li><a href="#serialized-fields" id="toc-serialized-fields" class="nav-link" data-scroll-target="#serialized-fields">Serialized Fields</a></li>
  <li><a href="#private-variables" id="toc-private-variables" class="nav-link" data-scroll-target="#private-variables">Private Variables</a></li>
  <li><a href="#start" id="toc-start" class="nav-link" data-scroll-target="#start"><code>Start</code></a></li>
  <li><a href="#loadandpreparemodel" id="toc-loadandpreparemodel" class="nav-link" data-scroll-target="#loadandpreparemodel"><code>LoadAndPrepareModel</code></a></li>
  <li><a href="#findlayerbyname" id="toc-findlayerbyname" class="nav-link" data-scroll-target="#findlayerbyname"><code>FindLayerByName</code></a></li>
  <li><a href="#loadclasslabels" id="toc-loadclasslabels" class="nav-link" data-scroll-target="#loadclasslabels"><code>LoadClassLabels</code></a></li>
  <li><a href="#isclasslabelsjsonnullorempty" id="toc-isclasslabelsjsonnullorempty" class="nav-link" data-scroll-target="#isclasslabelsjsonnullorempty"><code>IsClassLabelsJsonNullOrEmpty</code></a></li>
  <li><a href="#deserializeclasslabels" id="toc-deserializeclasslabels" class="nav-link" data-scroll-target="#deserializeclasslabels"><code>DeserializeClassLabels</code></a></li>
  <li><a href="#updateclasslabels" id="toc-updateclasslabels" class="nav-link" data-scroll-target="#updateclasslabels"><code>UpdateClassLabels</code></a></li>
  <li><a href="#executemodel" id="toc-executemodel" class="nav-link" data-scroll-target="#executemodel"><code>ExecuteModel</code></a></li>
  <li><a href="#processoutput" id="toc-processoutput" class="nav-link" data-scroll-target="#processoutput"><code>ProcessOutput</code></a></li>
  <li><a href="#unloadunusedassetsifneeded" id="toc-unloadunusedassetsifneeded" class="nav-link" data-scroll-target="#unloadunusedassetsifneeded"><code>UnloadUnusedAssetsIfNeeded</code></a></li>
  <li><a href="#decodesinglepose" id="toc-decodesinglepose" class="nav-link" data-scroll-target="#decodesinglepose"><code>DecodeSinglePose</code></a></li>
  <li><a href="#findhighestconfidencebodypart" id="toc-findhighestconfidencebodypart" class="nav-link" data-scroll-target="#findhighestconfidencebodypart"><code>FindHighestConfidenceBodyPart</code></a></li>
  <li><a href="#getoffsetvector" id="toc-getoffsetvector" class="nav-link" data-scroll-target="#getoffsetvector"><code>GetOffsetVector</code></a></li>
  <li><a href="#getimagecoords" id="toc-getimagecoords" class="nav-link" data-scroll-target="#getimagecoords"><code>GetImageCoords</code></a></li>
  <li><a href="#getstridedindexnearpoint" id="toc-getstridedindexnearpoint" class="nav-link" data-scroll-target="#getstridedindexnearpoint"><code>GetStridedIndexNearPoint</code></a></li>
  <li><a href="#getdisplacement" id="toc-getdisplacement" class="nav-link" data-scroll-target="#getdisplacement"><code>GetDisplacement</code></a></li>
  <li><a href="#traversetotargetbodypart2d" id="toc-traversetotargetbodypart2d" class="nav-link" data-scroll-target="#traversetotargetbodypart2d"><code>TraverseToTargetBodyPart2D</code></a></li>
  <li><a href="#decodepose" id="toc-decodepose" class="nav-link" data-scroll-target="#decodepose"><code>DecodePose</code></a></li>
  <li><a href="#traverseedges" id="toc-traverseedges" class="nav-link" data-scroll-target="#traverseedges"><code>TraverseEdges</code></a></li>
  <li><a href="#scoreismaximuminlocalwindow" id="toc-scoreismaximuminlocalwindow" class="nav-link" data-scroll-target="#scoreismaximuminlocalwindow"><code>ScoreIsMaximumInLocalWindow</code></a></li>
  <li><a href="#buildpartlist" id="toc-buildpartlist" class="nav-link" data-scroll-target="#buildpartlist"><code>BuildPartList</code></a></li>
  <li><a href="#withinnmsradiusofcorrespondingpoint" id="toc-withinnmsradiusofcorrespondingpoint" class="nav-link" data-scroll-target="#withinnmsradiusofcorrespondingpoint"><code>WithinNmsRadiusOfCorrespondingPoint</code></a></li>
  <li><a href="#decodemultipleposes" id="toc-decodemultipleposes" class="nav-link" data-scroll-target="#decodemultipleposes"><code>DecodeMultiplePoses</code></a></li>
  <li><a href="#cropinputdims" id="toc-cropinputdims" class="nav-link" data-scroll-target="#cropinputdims"><code>CropInputDims</code></a></li>
  </ul></li>
  <li><a href="#packageinstaller.cs" id="toc-packageinstaller.cs" class="nav-link" data-scroll-target="#packageinstaller.cs"><code>PackageInstaller.cs</code></a>
  <ul class="collapse">
  <li><a href="#serializable-classes" id="toc-serializable-classes" class="nav-link" data-scroll-target="#serializable-classes">Serializable Classes</a></li>
  <li><a href="#packageinstaller-class-variables" id="toc-packageinstaller-class-variables" class="nav-link" data-scroll-target="#packageinstaller-class-variables"><code>PackageInstaller</code> Class Variables</a></li>
  <li><a href="#installdependencies" id="toc-installdependencies" class="nav-link" data-scroll-target="#installdependencies"><code>InstallDependencies</code></a></li>
  <li><a href="#installnextpackage" id="toc-installnextpackage" class="nav-link" data-scroll-target="#installnextpackage"><code>InstallNextPackage</code></a></li>
  <li><a href="#packageinstallationprogress" id="toc-packageinstallationprogress" class="nav-link" data-scroll-target="#packageinstallationprogress"><code>PackageInstallationProgress</code></a></li>
  <li><a href="#ispackageinstalled" id="toc-ispackageinstalled" class="nav-link" data-scroll-target="#ispackageinstalled"><code>IsPackageInstalled</code></a></li>
  <li><a href="#readpackagejson" id="toc-readpackagejson" class="nav-link" data-scroll-target="#readpackagejson"><code>ReadPackageJson</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Code Walkthrough: Unity Barracuda Inference PoseNet Package</h1>
  <div class="quarto-categories">
    <div class="quarto-category">unity</div>
    <div class="quarto-category">walkthrough</div>
  </div>
  </div>

<div>
  <div class="description">
    Walk through the code for the Unity Barracuda Inference PoseNet package, which extends the functionality of <code>unity-barracuda-inference-base</code> to perform 2D human pose estimation using PoseNet models.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian Mills </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 7, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#package-overview">Package Overview</a></li>
<li><a href="#code-explanation">Code Explanation</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The <a href="https://github.com/cj-mills/unity-barracuda-inference-posenet">Barracuda Inference PoseNet</a> package extends the functionality of <a href="https://github.com/cj-mills/unity-barracuda-inference-base"><code>unity-barracuda-inference-base</code></a> to perform 2D human pose estimation using PoseNet models.</p>
<p>Pose estimation has numerous potential uses in Unity applications, including motion capture and animation, educational apps, and augmented reality, to name a few. Here is a demo video from a project that uses this package.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><video src="./videos/barracuda-inference-posenet-demo.mp4" class="img-fluid quarto-figure quarto-figure-center" controls=""><a href="./videos/barracuda-inference-posenet-demo.mp4">Video</a></video></p>
</figure>
</div>
<p>In this post, I’ll walk through the package code, providing a solid understanding of its components and their roles.</p>
</section>
<section id="package-overview" class="level2">
<h2 class="anchored" data-anchor-id="package-overview">Package Overview</h2>
<p>The package contains two C# scripts.</p>
<ol type="1">
<li><code>PoseNetPoseEstimator.cs</code>: This script provides functionality to perform 2D human pose estimation with PoseNet models using the Barracuda inference engine.</li>
<li><code>PackageInstaller.cs</code>: An Editor utility script for automatically installing a list of dependency packages defined in a JSON file.</li>
</ol>
</section>
<section id="code-explanation" class="level2">
<h2 class="anchored" data-anchor-id="code-explanation">Code Explanation</h2>
<p>In this section, we will delve deeper into the Barracuda Inference PoseNet package by examining the purpose and functionality of each C# script.</p>
<section id="posenetposeestimator.cs" class="level3">
<h3 class="anchored" data-anchor-id="posenetposeestimator.cs"><code>PoseNetPoseEstimator.cs</code></h3>
<p>This script defines the PoseNetPoseEstimator class, which extends the BarracudaModelRunner class from the Barracuda Inference Base package to perform 2D human pose estimation using PoseNet models. This class also depends on the <code>human-pose-2d-toolkit</code> package. The complete code is available on GitHub at the link below.</p>
<ul>
<li><a href="https://github.com/cj-mills/unity-barracuda-inference-posenet/blob/main/Runtime/Scripts/PoseNetPoseEstimator.cs">PoseNetPoseEstimator.cs</a></li>
</ul>
<section id="serialized-fields" class="level4">
<h4 class="anchored" data-anchor-id="serialized-fields">Serialized Fields</h4>
<p>The class has several serialized fields for configuring the model, and processing output.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"PoseNet Model Configuration"</span><span class="op">)]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>SerializeField<span class="op">,</span> <span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Index of the heatmap layer in the neural network"</span><span class="op">)]</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> heatmapLayerIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>SerializeField<span class="op">,</span> <span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Index of the offsets layer in the neural network"</span><span class="op">)]</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> offsetsLayerIndex <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>SerializeField<span class="op">,</span> <span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Index of the forward displacement layer in the neural network"</span><span class="op">)]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> displacementFWDLayerIndex <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>SerializeField<span class="op">,</span> <span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Index of the backward displacement layer in the neural network"</span><span class="op">)]</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> displacementBWDLayerIndex <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"Output Processing"</span><span class="op">)]</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>SerializeField<span class="op">,</span> <span class="fu">Tooltip</span><span class="op">(</span><span class="st">"TextAsset containing the class labels for pose estimation"</span><span class="op">)]</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> TextAsset classLabels<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It also includes a field to control how often to unload memory assets when using Barracuda’s Pixel Shader backend. The Pixel Shader backend enables GPU inference on platforms that don’t support Compute Shaders. However, there seems to be a bug in the current version of Barracuda, which does not release unused assets when using this backend. Left unchecked, this can fill up both system and GPU memory. We can address this by manually freeing memory. Doing that every frame can hurt performance, so we’ll only do it at set intervals.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Header</span><span class="op">(</span><span class="st">"Settings"</span><span class="op">)]</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>SerializeField<span class="op">,</span> <span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Interval at which pixel shaders are unloaded"</span><span class="op">)]</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> pixelShaderUnloadInterval <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="private-variables" class="level4">
<h4 class="anchored" data-anchor-id="private-variables">Private Variables</h4>
<p>There are internal variables for handling class labels and parent-children relationships of pose skeleton points.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Internal Variables</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> frameCounter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">class</span> ClassLabels <span class="op">{</span> <span class="kw">public</span> <span class="dt">string</span><span class="op">[]</span> classes<span class="op">;</span> <span class="op">}</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">const</span> <span class="dt">int</span> kLocalMaximumRadius <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Parent-children relationships of the pose keypoints</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">readonly</span> <span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">)[]</span> parentChildrenTuples <span class="op">=</span> <span class="op">{</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">),</span> <span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">),</span> <span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">),</span> <span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">4</span><span class="op">),</span> <span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">),</span> <span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">),</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="dv">7</span><span class="op">,</span> <span class="dv">9</span><span class="op">),</span> <span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">11</span><span class="op">),</span> <span class="op">(</span><span class="dv">11</span><span class="op">,</span> <span class="dv">13</span><span class="op">),</span> <span class="op">(</span><span class="dv">13</span><span class="op">,</span> <span class="dv">15</span><span class="op">),</span> <span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">6</span><span class="op">),</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="dv">6</span><span class="op">,</span> <span class="dv">8</span><span class="op">),</span> <span class="op">(</span><span class="dv">8</span><span class="op">,</span> <span class="dv">10</span><span class="op">),</span> <span class="op">(</span><span class="dv">6</span><span class="op">,</span> <span class="dv">12</span><span class="op">),</span> <span class="op">(</span><span class="dv">12</span><span class="op">,</span> <span class="dv">14</span><span class="op">),</span> <span class="op">(</span><span class="dv">14</span><span class="op">,</span> <span class="dv">16</span><span class="op">)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">const</span> <span class="dt">int</span> maxStride <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">const</span> <span class="dt">string</span> SigmoidLayer <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Layer names for the neural network</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span> offsetsLayer<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span> displacementFWDLayer<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span> displacementBWDLayer<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Class labels array</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span><span class="op">[]</span> classes<span class="op">;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Smallest dimension of the input image</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> minDim <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="start" class="level4">
<h4 class="anchored" data-anchor-id="start"><code>Start</code></h4>
<p>This method initializes the pose estimation component by calling the Start() method of the parent class and loading class labels.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Initializes the pose estimation component.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">base</span><span class="op">.</span><span class="fu">Start</span><span class="op">();</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LoadClassLabels</span><span class="op">();</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="loadandpreparemodel" class="level4">
<h4 class="anchored" data-anchor-id="loadandpreparemodel"><code>LoadAndPrepareModel</code></h4>
<p>This method loads and prepares the PoseNet model for pose estimation. It sets the worker type to PixelShader if running on WebGL, gets the output layers for the heatmap, offsets, forward displacement, and backward displacement, and adds a sigmoid layer if the last layer is not sigmoid.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Loads and prepares the model for pose estimation.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">LoadAndPrepareModel</span><span class="op">()</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">base</span><span class="op">.</span><span class="fu">LoadAndPrepareModel</span><span class="op">();</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set worker type to PixelShader if running on WebGL</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>Application<span class="op">.</span><span class="fu">platform</span> <span class="op">==</span> RuntimePlatform<span class="op">.</span><span class="fu">WebGLPlayer</span><span class="op">)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        workerType <span class="op">=</span> WorkerFactory<span class="op">.</span><span class="fu">Type</span><span class="op">.</span><span class="fu">PixelShader</span><span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the output layer of the heatmap</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> outputLayer <span class="op">=</span> modelBuilder<span class="op">.</span><span class="fu">model</span><span class="op">.</span><span class="fu">outputs</span><span class="op">[</span>heatmapLayerIndex<span class="op">];</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Find the heatmap layer in the model</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    Layer heatmapLayer <span class="op">=</span> <span class="fu">FindLayerByName</span><span class="op">(</span>modelBuilder<span class="op">.</span><span class="fu">model</span><span class="op">,</span> outputLayer<span class="op">);</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> lastLayerIsSigmoid <span class="op">=</span> heatmapLayer<span class="op">.</span><span class="fu">activation</span> <span class="op">==</span> Layer<span class="op">.</span><span class="fu">Activation</span><span class="op">.</span><span class="fu">Sigmoid</span><span class="op">;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add a sigmoid layer if the last layer is not sigmoid</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(!</span>lastLayerIsSigmoid<span class="op">)</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        modelBuilder<span class="op">.</span><span class="fu">Sigmoid</span><span class="op">(</span>SigmoidLayer<span class="op">,</span> outputLayer<span class="op">);</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the names of the output layers for offsets, forward, and backward displacements</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    offsetsLayer <span class="op">=</span> modelBuilder<span class="op">.</span><span class="fu">model</span><span class="op">.</span><span class="fu">outputs</span><span class="op">[</span>offsetsLayerIndex<span class="op">];</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    displacementFWDLayer <span class="op">=</span> modelBuilder<span class="op">.</span><span class="fu">model</span><span class="op">.</span><span class="fu">outputs</span><span class="op">[</span>displacementFWDLayerIndex<span class="op">];</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    displacementBWDLayer <span class="op">=</span> modelBuilder<span class="op">.</span><span class="fu">model</span><span class="op">.</span><span class="fu">outputs</span><span class="op">[</span>displacementBWDLayerIndex<span class="op">];</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="findlayerbyname" class="level4">
<h4 class="anchored" data-anchor-id="findlayerbyname"><code>FindLayerByName</code></h4>
<p>This method searches for a layer in the model by its name and returns the layer if found.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Finds a layer in the model by its name.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"model"</span><span class="kw">&gt;</span><span class="co">The model to search for the layer.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"layerName"</span><span class="kw">&gt;</span><span class="co">The name of the layer to find.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The layer with the given name or null if not found.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>Layer <span class="fu">FindLayerByName</span><span class="op">(</span>Model model<span class="op">,</span> <span class="dt">string</span> layerName<span class="op">)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>Layer layer <span class="kw">in</span> model<span class="op">.</span><span class="fu">layers</span><span class="op">)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>layer<span class="op">.</span><span class="fu">name</span> <span class="op">==</span> layerName<span class="op">)</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> layer<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="loadclasslabels" class="level4">
<h4 class="anchored" data-anchor-id="loadclasslabels"><code>LoadClassLabels</code></h4>
<p>This method loads the class labels from the TextAsset, deserializes the JSON, and updates the <code>classes</code> array.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Loads the class labels from the TextAsset and updates the classes array.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">LoadClassLabels</span><span class="op">()</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span><span class="fu">IsClassLabelsJsonNullOrEmpty</span><span class="op">())</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">LogError</span><span class="op">(</span><span class="st">"Class labels JSON is null or empty."</span><span class="op">);</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span><span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    ClassLabels classLabelsObj <span class="op">=</span> <span class="fu">DeserializeClassLabels</span><span class="op">(</span>classLabels<span class="op">.</span><span class="fu">text</span><span class="op">);</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">UpdateClassLabels</span><span class="op">(</span>classLabelsObj<span class="op">);</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="isclasslabelsjsonnullorempty" class="level4">
<h4 class="anchored" data-anchor-id="isclasslabelsjsonnullorempty"><code>IsClassLabelsJsonNullOrEmpty</code></h4>
<p>This method checks if the provided class label JSON file is null or empty.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Checks if the class labels JSON is null or empty.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">True if the JSON is null or empty, false otherwise.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">bool</span> <span class="fu">IsClassLabelsJsonNullOrEmpty</span><span class="op">()</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> classLabels <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> <span class="dt">string</span><span class="op">.</span><span class="fu">IsNullOrWhiteSpace</span><span class="op">(</span>classLabels<span class="op">.</span><span class="fu">text</span><span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="deserializeclasslabels" class="level4">
<h4 class="anchored" data-anchor-id="deserializeclasslabels"><code>DeserializeClassLabels</code></h4>
<p>This method deserializes the provided class label JSON string to a <code>ClassLabels</code> object.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Deserializes the class labels JSON into a ClassLabels object.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"json"</span><span class="kw">&gt;</span><span class="co">The class labels JSON string.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">A ClassLabels object, or null if deserialization fails.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> ClassLabels <span class="fu">DeserializeClassLabels</span><span class="op">(</span><span class="dt">string</span> json<span class="op">)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">try</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> JsonUtility<span class="op">.</span><span class="fu">FromJson</span><span class="op">&lt;</span>ClassLabels<span class="op">&gt;(</span>json<span class="op">);</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">catch</span> <span class="op">(</span>Exception ex<span class="op">)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">LogError</span><span class="op">(</span>$<span class="st">"Failed to deserialize class labels JSON: {ex.Message}"</span><span class="op">);</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="updateclasslabels" class="level4">
<h4 class="anchored" data-anchor-id="updateclasslabels"><code>UpdateClassLabels</code></h4>
<p>This method updates the <code>classes</code> array with the provided <code>ClassLabels</code> object.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Updates the classes array with the contents of the given ClassLabels object.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"classLabelsObj"</span><span class="kw">&gt;</span><span class="co">The ClassLabels object containing class labels.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">UpdateClassLabels</span><span class="op">(</span>ClassLabels classLabelsObj<span class="op">)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>classLabelsObj <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span><span class="op">;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> classLabelsObj<span class="op">.</span><span class="fu">classes</span><span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="executemodel" class="level4">
<h4 class="anchored" data-anchor-id="executemodel"><code>ExecuteModel</code></h4>
<p>This method executes the PoseNet model with the given input texture.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Executes the model with the given input texture.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"inputTexture"</span><span class="kw">&gt;</span><span class="co">The input texture to process.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">ExecuteModel</span><span class="op">(</span>RenderTexture inputTexture<span class="op">)</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    minDim <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>inputTexture<span class="op">.</span><span class="fu">width</span><span class="op">,</span> inputTexture<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="op">(</span>Tensor input <span class="op">=</span> <span class="kw">new</span> <span class="fu">Tensor</span><span class="op">(</span>inputTexture<span class="op">,</span> channels<span class="op">:</span> <span class="dv">3</span><span class="op">))</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">base</span><span class="op">.</span><span class="fu">ExecuteModel</span><span class="op">(</span>input<span class="op">);</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="processoutput" class="level4">
<h4 class="anchored" data-anchor-id="processoutput"><code>ProcessOutput</code></h4>
<p>This method processes the output tensors and returns an array of detected human poses. It can use either single-pose decoding or multiple-pose decoding.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Processes the output tensors and returns an array of detected human poses.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"useMultiPoseDecoding"</span><span class="kw">&gt;</span><span class="co">True to use multiple pose decoding, false to use single pose decoding.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"maxPoses"</span><span class="kw">&gt;</span><span class="co">The maximum number of poses to detect.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">An array of detected human poses.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> HumanPose2D<span class="op">[]</span> <span class="fu">ProcessOutput</span><span class="op">(</span><span class="dt">float</span> scoreThreshold<span class="op">,</span> <span class="dt">int</span> nmsRadius<span class="op">,</span> <span class="dt">int</span> maxPoses <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">bool</span> useMultiPoseDecoding <span class="op">=</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize a list to store the detected human poses</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    List<span class="op">&lt;</span>HumanPose2D<span class="op">&gt;</span> humanPoses <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>HumanPose2D<span class="op">&gt;();</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the output tensors from the neural network</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> Tensor heatmaps <span class="op">=</span> engine<span class="op">.</span><span class="fu">PeekOutput</span><span class="op">(</span>SigmoidLayer<span class="op">);</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> Tensor offsets <span class="op">=</span> engine<span class="op">.</span><span class="fu">PeekOutput</span><span class="op">(</span>offsetsLayer<span class="op">);</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> Tensor displacementFWD <span class="op">=</span> engine<span class="op">.</span><span class="fu">PeekOutput</span><span class="op">(</span>displacementFWDLayer<span class="op">);</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> Tensor displacementBWD <span class="op">=</span> engine<span class="op">.</span><span class="fu">PeekOutput</span><span class="op">(</span>displacementBWDLayer<span class="op">);</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the stride based on the dimensions of the heatmaps</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> minHeatMapDim <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>heatmaps<span class="op">.</span><span class="fu">width</span><span class="op">,</span> heatmaps<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> stride <span class="op">=</span> <span class="op">(</span>minDim <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span>minHeatMapDim <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    stride <span class="op">-=</span> <span class="op">(</span>stride <span class="op">%</span> <span class="dv">8</span><span class="op">);</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Decide whether to use single pose decoding or multiple pose decoding</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>useMultiPoseDecoding<span class="op">)</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Decode multiple poses and store them in the humanPoses list</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>        humanPoses <span class="op">=</span> <span class="fu">DecodeMultiplePoses</span><span class="op">(</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>            heatmaps<span class="op">,</span> offsets<span class="op">,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>            displacementFWD<span class="op">,</span> displacementBWD<span class="op">,</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>            stride<span class="op">,</span> maxPoses<span class="op">,</span> scoreThreshold<span class="op">,</span> nmsRadius<span class="op">);</span>   </span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Decode a single pose and add it to the humanPoses list</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        HumanPose2D pose <span class="op">=</span> <span class="kw">new</span> HumanPose2D</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>            index <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>            bodyParts <span class="op">=</span> <span class="fu">DecodeSinglePose</span><span class="op">(</span>heatmaps<span class="op">,</span> offsets<span class="op">,</span> stride<span class="op">)</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>        humanPoses<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>pose<span class="op">);</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Unload unused assets if needed</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">UnloadUnusedAssetsIfNeeded</span><span class="op">();</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert the list of human poses to an array and return it</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> humanPoses<span class="op">.</span><span class="fu">ToArray</span><span class="op">();</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="unloadunusedassetsifneeded" class="level4">
<h4 class="anchored" data-anchor-id="unloadunusedassetsifneeded"><code>UnloadUnusedAssetsIfNeeded</code></h4>
<p>This method unloads unused assets if needed based on the worker type and frame counter.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Unloads unused assets if needed based on the worker type and frame counter.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">UnloadUnusedAssetsIfNeeded</span><span class="op">()</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>workerType <span class="op">!=</span> WorkerFactory<span class="op">.</span><span class="fu">Type</span><span class="op">.</span><span class="fu">PixelShader</span><span class="op">)</span> <span class="kw">return</span><span class="op">;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    frameCounter<span class="op">++;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>frameCounter <span class="op">%</span> pixelShaderUnloadInterval <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        Resources<span class="op">.</span><span class="fu">UnloadUnusedAssets</span><span class="op">();</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        frameCounter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="decodesinglepose" class="level4">
<h4 class="anchored" data-anchor-id="decodesinglepose"><code>DecodeSinglePose</code></h4>
<p>This method decodes a single human pose from the given <code>heatmaps</code> and <code>offsets</code> tensors and returns an array of body parts.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Decodes a single human pose from the given heatmaps and offsets tensors.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"heatmaps"</span><span class="kw">&gt;</span><span class="co">The heatmaps tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"offsets"</span><span class="kw">&gt;</span><span class="co">The offsets tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stride"</span><span class="kw">&gt;</span><span class="co">The stride for decoding the pose.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">An array of body parts for the decoded pose.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> BodyPart2D<span class="op">[]</span> <span class="fu">DecodeSinglePose</span><span class="op">(</span>Tensor heatmaps<span class="op">,</span> Tensor offsets<span class="op">,</span> <span class="dt">int</span> stride<span class="op">)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numBodyParts <span class="op">=</span> heatmaps<span class="op">.</span><span class="fu">channels</span><span class="op">;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    BodyPart2D<span class="op">[]</span> bodyParts <span class="op">=</span> <span class="kw">new</span> BodyPart2D<span class="op">[</span>numBodyParts<span class="op">];</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> c <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> c <span class="op">&lt;</span> numBodyParts<span class="op">;</span> c<span class="op">++)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        BodyPart2D part <span class="op">=</span> <span class="fu">FindHighestConfidenceBodyPart</span><span class="op">(</span>heatmaps<span class="op">,</span> c<span class="op">);</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        part<span class="op">.</span><span class="fu">coordinates</span> <span class="op">=</span> <span class="fu">GetImageCoords</span><span class="op">(</span>part<span class="op">,</span> stride<span class="op">,</span> offsets<span class="op">);</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        bodyParts<span class="op">[</span>c<span class="op">]</span> <span class="op">=</span> part<span class="op">;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> bodyParts<span class="op">;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="findhighestconfidencebodypart" class="level4">
<h4 class="anchored" data-anchor-id="findhighestconfidencebodypart"><code>FindHighestConfidenceBodyPart</code></h4>
<p>This method finds the body part with the highest confidence for the given channel in the heatmaps tensor and returns the body part.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Finds the body part with the highest confidence for the given channel in the heatmaps tensor.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"heatmaps"</span><span class="kw">&gt;</span><span class="co">The heatmaps tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"channel"</span><span class="kw">&gt;</span><span class="co">The channel representing the body part to search for.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The body part with the highest confidence.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> BodyPart2D <span class="fu">FindHighestConfidenceBodyPart</span><span class="op">(</span>Tensor heatmaps<span class="op">,</span> <span class="dt">int</span> channel<span class="op">)</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    BodyPart2D part <span class="op">=</span> <span class="kw">new</span> BodyPart2D <span class="op">{</span> index <span class="op">=</span> channel<span class="op">,</span> prob <span class="op">=</span> <span class="dv">0</span> <span class="op">};</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> y <span class="op">&lt;</span> heatmaps<span class="op">.</span><span class="fu">height</span><span class="op">;</span> y<span class="op">++)</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x <span class="op">&lt;</span> heatmaps<span class="op">.</span><span class="fu">width</span><span class="op">;</span> x<span class="op">++)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> confidence <span class="op">=</span> heatmaps<span class="op">[</span><span class="dv">0</span><span class="op">,</span> y<span class="op">,</span> x<span class="op">,</span> channel<span class="op">];</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>confidence <span class="op">&gt;</span> part<span class="op">.</span><span class="fu">prob</span><span class="op">)</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                part<span class="op">.</span><span class="fu">prob</span> <span class="op">=</span> confidence<span class="op">;</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                part<span class="op">.</span><span class="fu">coordinates</span><span class="op">.</span><span class="fu">x</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                part<span class="op">.</span><span class="fu">coordinates</span><span class="op">.</span><span class="fu">y</span> <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> part<span class="op">;</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="getoffsetvector" class="level4">
<h4 class="anchored" data-anchor-id="getoffsetvector"><code>GetOffsetVector</code></h4>
<p>This method returns the offset vector for the given coordinates and keypoint in the offsets tensor.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Returns the offset vector for the given coordinates and keypoint in the offsets tensor.</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"y"</span><span class="kw">&gt;</span><span class="co">The y-coordinate.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"x"</span><span class="kw">&gt;</span><span class="co">The x-coordinate.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"keypoint"</span><span class="kw">&gt;</span><span class="co">The keypoint index.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"offsets"</span><span class="kw">&gt;</span><span class="co">The offsets tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The offset vector for the specified keypoint.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Vector2 <span class="fu">GetOffsetVector</span><span class="op">(</span><span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> keypoint<span class="op">,</span> Tensor offsets<span class="op">)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> channelOffset <span class="op">=</span> offsets<span class="op">.</span><span class="fu">channels</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span>offsets<span class="op">[</span><span class="dv">0</span><span class="op">,</span> y<span class="op">,</span> x<span class="op">,</span> keypoint <span class="op">+</span> channelOffset<span class="op">],</span> offsets<span class="op">[</span><span class="dv">0</span><span class="op">,</span> y<span class="op">,</span> x<span class="op">,</span> keypoint<span class="op">]);</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="getimagecoords" class="level4">
<h4 class="anchored" data-anchor-id="getimagecoords"><code>GetImageCoords</code></h4>
<p>This method converts body part coordinates to image coordinates using the given stride and offsets tensor.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Converts body part coordinates to image coordinates using the given stride and offsets tensor.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"part"</span><span class="kw">&gt;</span><span class="co">The body part with heatmap coordinates.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stride"</span><span class="kw">&gt;</span><span class="co">The stride for decoding the pose.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"offsets"</span><span class="kw">&gt;</span><span class="co">The offsets tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The image coordinates for the given body part.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Vector2 <span class="fu">GetImageCoords</span><span class="op">(</span>BodyPart2D part<span class="op">,</span> <span class="dt">int</span> stride<span class="op">,</span> Tensor offsets<span class="op">)</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    Vector2 offsetVector <span class="op">=</span> <span class="fu">GetOffsetVector</span><span class="op">((</span><span class="dt">int</span><span class="op">)</span>part<span class="op">.</span><span class="fu">coordinates</span><span class="op">.</span><span class="fu">y</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>part<span class="op">.</span><span class="fu">coordinates</span><span class="op">.</span><span class="fu">x</span><span class="op">,</span> part<span class="op">.</span><span class="fu">index</span><span class="op">,</span> offsets<span class="op">);</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="op">(</span>part<span class="op">.</span><span class="fu">coordinates</span> <span class="op">*</span> stride<span class="op">)</span> <span class="op">+</span> offsetVector<span class="op">;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="getstridedindexnearpoint" class="level4">
<h4 class="anchored" data-anchor-id="getstridedindexnearpoint"><code>GetStridedIndexNearPoint</code></h4>
<p>This method gets the stridden index near a given point, given the stride, tensor height, and tensor width.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Gets the strided index near a given point.</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"point"</span><span class="kw">&gt;</span><span class="co">The point for which the strided index is calculated.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stride"</span><span class="kw">&gt;</span><span class="co">The stride for decoding the pose.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"height"</span><span class="kw">&gt;</span><span class="co">The height of the tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"width"</span><span class="kw">&gt;</span><span class="co">The width of the tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The strided index as a Vector2Int.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Vector2Int <span class="fu">GetStridedIndexNearPoint</span><span class="op">(</span>Vector2 point<span class="op">,</span> <span class="dt">int</span> stride<span class="op">,</span> <span class="dt">int</span> height<span class="op">,</span> <span class="dt">int</span> width<span class="op">)</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">(</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        Mathf<span class="op">.</span><span class="fu">Clamp</span><span class="op">(</span>Mathf<span class="op">.</span><span class="fu">RoundToInt</span><span class="op">(</span>point<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> stride<span class="op">),</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">-</span> <span class="dv">1</span><span class="op">),</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        Mathf<span class="op">.</span><span class="fu">Clamp</span><span class="op">(</span>Mathf<span class="op">.</span><span class="fu">RoundToInt</span><span class="op">(</span>point<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> stride<span class="op">),</span> <span class="dv">0</span><span class="op">,</span> height <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="getdisplacement" class="level4">
<h4 class="anchored" data-anchor-id="getdisplacement"><code>GetDisplacement</code></h4>
<p>This method gets the displacement for the specified edge and point in the <code>displacements</code> tensor and returns it as a Vector2.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Gets the displacement for the specified edge and point in the displacements tensor.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"edgeId"</span><span class="kw">&gt;</span><span class="co">The edge index.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"point"</span><span class="kw">&gt;</span><span class="co">The point as a Vector2Int.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"displacements"</span><span class="kw">&gt;</span><span class="co">The displacements tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The displacement as a Vector2.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Vector2 <span class="fu">GetDisplacement</span><span class="op">(</span><span class="dt">int</span> edgeId<span class="op">,</span> Vector2Int point<span class="op">,</span> Tensor displacements<span class="op">)</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numEdges <span class="op">=</span> displacements<span class="op">.</span><span class="fu">channels</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        displacements<span class="op">[</span><span class="dv">0</span><span class="op">,</span> point<span class="op">.</span><span class="fu">y</span><span class="op">,</span> point<span class="op">.</span><span class="fu">x</span><span class="op">,</span> numEdges <span class="op">+</span> edgeId<span class="op">],</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        displacements<span class="op">[</span><span class="dv">0</span><span class="op">,</span> point<span class="op">.</span><span class="fu">y</span><span class="op">,</span> point<span class="op">.</span><span class="fu">x</span><span class="op">,</span> edgeId<span class="op">]</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="traversetotargetbodypart2d" class="level4">
<h4 class="anchored" data-anchor-id="traversetotargetbodypart2d"><code>TraverseToTargetBodyPart2D</code></h4>
<p>This method takes an edge index, a source body part, a target body part index, and tensors for scores, offsets, stride, and displacements. It calculates the displaced point by adding the displacement value to the source body part coordinates and returns the target body part as a <code>BodyPart2D</code> instance.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Traverses to the target body part from the source body part using the given edge.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"edgeId"</span><span class="kw">&gt;</span><span class="co">The edge index.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"sourceBodyPart2D"</span><span class="kw">&gt;</span><span class="co">The source body part.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"targetBodyPart2DId"</span><span class="kw">&gt;</span><span class="co">The target body part index.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"scores"</span><span class="kw">&gt;</span><span class="co">The scores tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"offsets"</span><span class="kw">&gt;</span><span class="co">The offsets tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stride"</span><span class="kw">&gt;</span><span class="co">The stride for decoding the pose.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"displacements"</span><span class="kw">&gt;</span><span class="co">The displacements tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The target body part as a BodyPart2D.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> BodyPart2D <span class="fu">TraverseToTargetBodyPart2D</span><span class="op">(</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> edgeId<span class="op">,</span> BodyPart2D sourceBodyPart2D<span class="op">,</span> <span class="dt">int</span> targetBodyPart2DId<span class="op">,</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    Tensor scores<span class="op">,</span> Tensor offsets<span class="op">,</span> <span class="dt">int</span> stride<span class="op">,</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    Tensor displacements<span class="op">)</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get height and width from the scores tensor</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> height <span class="op">=</span> scores<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width <span class="op">=</span> scores<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the source body part indices in the strided space</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    Vector2Int sourceBodyPart2DIndices <span class="op">=</span> <span class="fu">GetStridedIndexNearPoint</span><span class="op">(</span>sourceBodyPart2D<span class="op">.</span><span class="fu">coordinates</span><span class="op">,</span> stride<span class="op">,</span> height<span class="op">,</span> width<span class="op">);</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the displacement for the given edge</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    Vector2 displacement <span class="op">=</span> <span class="fu">GetDisplacement</span><span class="op">(</span>edgeId<span class="op">,</span> sourceBodyPart2DIndices<span class="op">,</span> displacements<span class="op">);</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the displaced point by adding the displacement to the source body part coordinates</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    Vector2 displacedPoint <span class="op">=</span> sourceBodyPart2D<span class="op">.</span><span class="fu">coordinates</span> <span class="op">+</span> displacement<span class="op">;</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the displaced point indices in the strided space</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    Vector2Int displacedPointIndices <span class="op">=</span> <span class="fu">GetStridedIndexNearPoint</span><span class="op">(</span>displacedPoint<span class="op">,</span> stride<span class="op">,</span> height<span class="op">,</span> width<span class="op">);</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the offset vector for the target body part</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    Vector2 offsetVector <span class="op">=</span> <span class="fu">GetOffsetVector</span><span class="op">(</span>displacedPointIndices<span class="op">.</span><span class="fu">y</span><span class="op">,</span> displacedPointIndices<span class="op">.</span><span class="fu">x</span><span class="op">,</span> targetBodyPart2DId<span class="op">,</span> offsets<span class="op">);</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the score for the target body part</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> score <span class="op">=</span> scores<span class="op">[</span><span class="dv">0</span><span class="op">,</span> displacedPointIndices<span class="op">.</span><span class="fu">y</span><span class="op">,</span> displacedPointIndices<span class="op">.</span><span class="fu">x</span><span class="op">,</span> targetBodyPart2DId<span class="op">];</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate the target body part coordinates by adding the offset vector to the displaced point indices</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    Vector2 targetBodyPart2D <span class="op">=</span> <span class="op">(</span>displacedPointIndices <span class="op">*</span> stride<span class="op">)</span> <span class="op">+</span> offsetVector<span class="op">;</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Return the target body part as a BodyPart2D instance</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">new</span> <span class="fu">BodyPart2D</span><span class="op">(</span>targetBodyPart2DId<span class="op">,</span> targetBodyPart2D<span class="op">,</span> score<span class="op">);</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="decodepose" class="level4">
<h4 class="anchored" data-anchor-id="decodepose"><code>DecodePose</code></h4>
<p>This method takes a root body part, tensors for scores, offsets, stride, the forward and backward displacements, and returns an array of BodyPart2D instances for the decoded pose.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Decodes the pose given a root body part, scores, offsets, stride, and displacements tensors.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"root"</span><span class="kw">&gt;</span><span class="co">The root BodyPart2D.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"scores"</span><span class="kw">&gt;</span><span class="co">The scores tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"offsets"</span><span class="kw">&gt;</span><span class="co">The offsets tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stride"</span><span class="kw">&gt;</span><span class="co">The stride for decoding the pose.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"displacementsFwd"</span><span class="kw">&gt;</span><span class="co">The forward displacements tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"displacementsBwd"</span><span class="kw">&gt;</span><span class="co">The backward displacements tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">An array of BodyPart2D for the decoded pose.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> BodyPart2D<span class="op">[]</span> <span class="fu">DecodePose</span><span class="op">(</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    BodyPart2D root<span class="op">,</span> Tensor scores<span class="op">,</span> Tensor offsets<span class="op">,</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> stride<span class="op">,</span> Tensor displacementsFwd<span class="op">,</span> Tensor displacementsBwd<span class="op">)</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the number of body parts from the scores tensor</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numBodyParts <span class="op">=</span> scores<span class="op">.</span><span class="fu">channels</span><span class="op">;</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize an array of BodyPart2D instances for storing the decoded pose</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    BodyPart2D<span class="op">[]</span> instanceBodyParts <span class="op">=</span> <span class="kw">new</span> BodyPart2D<span class="op">[</span>numBodyParts<span class="op">];</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Compute the root point coordinates in the image and store it in the array</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    Vector2 rootPoint <span class="op">=</span> <span class="fu">GetImageCoords</span><span class="op">(</span>root<span class="op">,</span> stride<span class="op">,</span> offsets<span class="op">);</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    instanceBodyParts<span class="op">[</span>root<span class="op">.</span><span class="fu">index</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">BodyPart2D</span><span class="op">(</span>root<span class="op">.</span><span class="fu">index</span><span class="op">,</span> rootPoint<span class="op">,</span> root<span class="op">.</span><span class="fu">prob</span><span class="op">);</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the number of edges from parentChildrenTuples</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numEdges <span class="op">=</span> parentChildrenTuples<span class="op">.</span><span class="fu">Length</span><span class="op">;</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Traverse the edges in both directions to decode the pose</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">TraverseEdges</span><span class="op">(</span>instanceBodyParts<span class="op">,</span> scores<span class="op">,</span> offsets<span class="op">,</span> stride<span class="op">,</span> displacementsBwd<span class="op">,</span> numEdges<span class="op">,</span> reverse<span class="op">:</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">TraverseEdges</span><span class="op">(</span>instanceBodyParts<span class="op">,</span> scores<span class="op">,</span> offsets<span class="op">,</span> stride<span class="op">,</span> displacementsFwd<span class="op">,</span> numEdges<span class="op">,</span> reverse<span class="op">:</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Return the decoded pose as an array of BodyPart2D instances</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> instanceBodyParts<span class="op">;</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="traverseedges" class="level4">
<h4 class="anchored" data-anchor-id="traverseedges"><code>TraverseEdges</code></h4>
<p>This method traverses edges from the source to the target body part, updating the position and probability of the target body part in the <code>instanceBodyParts</code> array.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Traverses edges from the source to the target body part.</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"instanceBodyParts"</span><span class="kw">&gt;</span><span class="co">An array of BodyPart2D instances.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"scores"</span><span class="kw">&gt;</span><span class="co">The scores tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"offsets"</span><span class="kw">&gt;</span><span class="co">The offsets tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stride"</span><span class="kw">&gt;</span><span class="co">The stride for decoding the pose.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"displacements"</span><span class="kw">&gt;</span><span class="co">The displacements tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"numEdges"</span><span class="kw">&gt;</span><span class="co">The number of edges.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"reverse"</span><span class="kw">&gt;</span><span class="co">Whether to reverse the traversal direction.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">TraverseEdges</span><span class="op">(</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    BodyPart2D<span class="op">[]</span> instanceBodyParts<span class="op">,</span> Tensor scores<span class="op">,</span> Tensor offsets<span class="op">,</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> stride<span class="op">,</span> Tensor displacements<span class="op">,</span> <span class="dt">int</span> numEdges<span class="op">,</span> <span class="dt">bool</span> reverse<span class="op">)</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the start, end, and step of the edge traversal based on the reverse flag</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> edgeStart <span class="op">=</span> reverse <span class="op">?</span> numEdges <span class="op">-</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> edgeEnd <span class="op">=</span> reverse <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> numEdges<span class="op">;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> edgeStep <span class="op">=</span> reverse <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Traverse the edges in the specified direction</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> edge <span class="op">=</span> edgeStart<span class="op">;</span> edge <span class="op">!=</span> edgeEnd<span class="op">;</span> edge <span class="op">+=</span> edgeStep<span class="op">)</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span><span class="dt">int</span> sourceBodyPartId<span class="op">,</span> <span class="dt">int</span> targetBodyPartId<span class="op">)</span> <span class="op">=</span> parentChildrenTuples<span class="op">[</span>edge<span class="op">];</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Swap source and target body part IDs if traversing in reverse</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>reverse<span class="op">)</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span>sourceBodyPartId<span class="op">,</span> targetBodyPartId<span class="op">)</span> <span class="op">=</span> <span class="op">(</span>targetBodyPartId<span class="op">,</span> sourceBodyPartId<span class="op">);</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If the source body part has a probability greater than 0 and the target body part has not been detected,</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// traverse to the target body part and update its position and probability in the instanceBodyParts array</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>instanceBodyParts<span class="op">[</span>sourceBodyPartId<span class="op">].</span><span class="fu">prob</span> <span class="op">&gt;</span> <span class="fl">0.0f</span> <span class="op">&amp;&amp;</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>            instanceBodyParts<span class="op">[</span>targetBodyPartId<span class="op">].</span><span class="fu">prob</span> <span class="op">==</span> <span class="fl">0.0f</span><span class="op">)</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>            instanceBodyParts<span class="op">[</span>targetBodyPartId<span class="op">]</span> <span class="op">=</span> <span class="fu">TraverseToTargetBodyPart2D</span><span class="op">(</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>                edge<span class="op">,</span> instanceBodyParts<span class="op">[</span>sourceBodyPartId<span class="op">],</span> targetBodyPartId<span class="op">,</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>                scores<span class="op">,</span> offsets<span class="op">,</span> stride<span class="op">,</span> displacements<span class="op">);</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="scoreismaximuminlocalwindow" class="level4">
<h4 class="anchored" data-anchor-id="scoreismaximuminlocalwindow"><code>ScoreIsMaximumInLocalWindow</code></h4>
<p>The <code>ScoreIsMaximumInLocalWindow</code> method checks if a given score is the maximum in a local window around the pose skeleton point.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Checks if a score is the maximum in a local window around the keypoint.</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"keypointId"</span><span class="kw">&gt;</span><span class="co">The keypoint index.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"score"</span><span class="kw">&gt;</span><span class="co">The score to check.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"heatmapY"</span><span class="kw">&gt;</span><span class="co">The y-coordinate of the keypoint in the heatmap.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"heatmapX"</span><span class="kw">&gt;</span><span class="co">The x-coordinate of the keypoint in the heatmap.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"localMaximumRadius"</span><span class="kw">&gt;</span><span class="co">The radius of the local window to search.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"heatmaps"</span><span class="kw">&gt;</span><span class="co">The heatmaps tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">True if the score is the maximum in the local window, false otherwise.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">bool</span> <span class="fu">ScoreIsMaximumInLocalWindow</span><span class="op">(</span><span class="dt">int</span> keypointId<span class="op">,</span> <span class="dt">float</span> score<span class="op">,</span> <span class="dt">int</span> heatmapY<span class="op">,</span> <span class="dt">int</span> heatmapX<span class="op">,</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> localMaximumRadius<span class="op">,</span> Tensor heatmaps<span class="op">)</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> yStart <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Max</span><span class="op">(</span>heatmapY <span class="op">-</span> localMaximumRadius<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> yEnd <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>heatmapY <span class="op">+</span> localMaximumRadius <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> heatmaps<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate through the local window around the keypoint</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> yCurrent <span class="op">=</span> yStart<span class="op">;</span> yCurrent <span class="op">&lt;</span> yEnd<span class="op">;</span> <span class="op">++</span>yCurrent<span class="op">)</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> xStart <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Max</span><span class="op">(</span>heatmapX <span class="op">-</span> localMaximumRadius<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> xEnd <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>heatmapX <span class="op">+</span> localMaximumRadius <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> heatmaps<span class="op">.</span><span class="fu">width</span><span class="op">);</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> xCurrent <span class="op">=</span> xStart<span class="op">;</span> xCurrent <span class="op">&lt;</span> xEnd<span class="op">;</span> <span class="op">++</span>xCurrent<span class="op">)</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>            <span class="co">// If any value in the local window is greater than the score,</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>            <span class="co">// it is not the maximum</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>heatmaps<span class="op">[</span><span class="dv">0</span><span class="op">,</span> yCurrent<span class="op">,</span> xCurrent<span class="op">,</span> keypointId<span class="op">]</span> <span class="op">&gt;</span> score<span class="op">)</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If none of the values in the local window are greater, the score is the maximum</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="buildpartlist" class="level4">
<h4 class="anchored" data-anchor-id="buildpartlist"><code>BuildPartList</code></h4>
<p>This method builds a list of BodyPart2D instances with scores above the specified threshold and which are the maximum in their local window.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Builds a list of BodyPart2D instances that have a score above the threshold and are the maximum in their local window.</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"scoreThreshold"</span><span class="kw">&gt;</span><span class="co">The minimum score threshold.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"localMaximumRadius"</span><span class="kw">&gt;</span><span class="co">The radius of the local window to search.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"heatmaps"</span><span class="kw">&gt;</span><span class="co">The heatmaps tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">A list of BodyPart2D instances that meet the conditions.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> List<span class="op">&lt;</span>BodyPart2D<span class="op">&gt;</span> <span class="fu">BuildPartList</span><span class="op">(</span><span class="dt">float</span> scoreThreshold<span class="op">,</span> <span class="dt">int</span> localMaximumRadius<span class="op">,</span> Tensor heatmaps<span class="op">)</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    List<span class="op">&lt;</span>BodyPart2D<span class="op">&gt;</span> list <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>BodyPart2D<span class="op">&gt;();</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate through the channels, height, and width of the heatmaps tensor</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> c <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> c <span class="op">&lt;</span> heatmaps<span class="op">.</span><span class="fu">channels</span><span class="op">;</span> c<span class="op">++)</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> y <span class="op">&lt;</span> heatmaps<span class="op">.</span><span class="fu">height</span><span class="op">;</span> y<span class="op">++)</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x <span class="op">&lt;</span> heatmaps<span class="op">.</span><span class="fu">width</span><span class="op">;</span> x<span class="op">++)</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> score <span class="op">=</span> heatmaps<span class="op">[</span><span class="dv">0</span><span class="op">,</span> y<span class="op">,</span> x<span class="op">,</span> c<span class="op">];</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                <span class="co">// If the score is greater or equal to the threshold and is the maximum in the local window,</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                <span class="co">// add it to the list</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>score <span class="op">&gt;=</span> scoreThreshold <span class="op">&amp;&amp;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ScoreIsMaximumInLocalWindow</span><span class="op">(</span>c<span class="op">,</span> score<span class="op">,</span> y<span class="op">,</span> x<span class="op">,</span> localMaximumRadius<span class="op">,</span> heatmaps<span class="op">))</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>                    list<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">BodyPart2D</span><span class="op">(</span>c<span class="op">,</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span>x<span class="op">,</span> y<span class="op">),</span> score<span class="op">));</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> list<span class="op">;</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="withinnmsradiusofcorrespondingpoint" class="level4">
<h4 class="anchored" data-anchor-id="withinnmsradiusofcorrespondingpoint"><code>WithinNmsRadiusOfCorrespondingPoint</code></h4>
<p>This method checks if a given vector is within the non-maximum suppression radius of a corresponding point in any pose.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Checks if a given vector is within the non-maximum suppression radius of a corresponding point in any pose.</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"poses"</span><span class="kw">&gt;</span><span class="co">A list of HumanPose2D instances.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"squaredNmsRadius"</span><span class="kw">&gt;</span><span class="co">The squared non-maximum suppression radius.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"vec"</span><span class="kw">&gt;</span><span class="co">The vector to be checked.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"keypointId"</span><span class="kw">&gt;</span><span class="co">The keypoint index.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">True if the vector is within the radius of a corresponding point in any pose, false otherwise.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">bool</span> <span class="fu">WithinNmsRadiusOfCorrespondingPoint</span><span class="op">(</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    List<span class="op">&lt;</span>HumanPose2D<span class="op">&gt;</span> poses<span class="op">,</span> <span class="dt">float</span> squaredNmsRadius<span class="op">,</span> Vector2 vec<span class="op">,</span> <span class="dt">int</span> keypointId<span class="op">)</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> poses<span class="op">.</span><span class="fu">Any</span><span class="op">(</span>pose <span class="op">=&gt;</span> <span class="op">(</span>vec <span class="op">-</span> pose<span class="op">.</span><span class="fu">bodyParts</span><span class="op">[</span>keypointId<span class="op">].</span><span class="fu">coordinates</span><span class="op">).</span><span class="fu">sqrMagnitude</span> <span class="op">&lt;=</span> squaredNmsRadius<span class="op">);</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="decodemultipleposes" class="level4">
<h4 class="anchored" data-anchor-id="decodemultipleposes"><code>DecodeMultiplePoses</code></h4>
<p>This method decodes multiple human poses from the model output.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Decodes multiple human poses from the given heatmaps, offsets, and displacements tensors.</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"heatmaps"</span><span class="kw">&gt;</span><span class="co">The heatmaps tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"offsets"</span><span class="kw">&gt;</span><span class="co">The offsets tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"displacementsFwd"</span><span class="kw">&gt;</span><span class="co">The forward displacements tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"displacementBwd"</span><span class="kw">&gt;</span><span class="co">The backward displacements tensor.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stride"</span><span class="kw">&gt;</span><span class="co">The stride for decoding the pose.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"maxPoseDetections"</span><span class="kw">&gt;</span><span class="co">The maximum number of pose detections.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"scoreThreshold"</span><span class="kw">&gt;</span><span class="co">The minimum score threshold for a part to be considered.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"nmsRadius"</span><span class="kw">&gt;</span><span class="co">The non-maximum suppression radius.</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">A list of decoded HumanPose2D instances.</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> List<span class="op">&lt;</span>HumanPose2D<span class="op">&gt;</span> <span class="fu">DecodeMultiplePoses</span><span class="op">(</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    Tensor heatmaps<span class="op">,</span> Tensor offsets<span class="op">,</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    Tensor displacementsFwd<span class="op">,</span> Tensor displacementBwd<span class="op">,</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> stride<span class="op">,</span> <span class="dt">int</span> maxPoseDetections<span class="op">,</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> scoreThreshold <span class="op">=</span> <span class="fl">0.5f</span><span class="op">,</span> <span class="dt">int</span> nmsRadius <span class="op">=</span> <span class="dv">20</span><span class="op">)</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    List<span class="op">&lt;</span>HumanPose2D<span class="op">&gt;</span> humanPoses <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>HumanPose2D<span class="op">&gt;();</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> squaredNmsRadius <span class="op">=</span> nmsRadius <span class="op">*</span> nmsRadius<span class="op">;</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    List<span class="op">&lt;</span>BodyPart2D<span class="op">&gt;</span> bodyPartList <span class="op">=</span> <span class="fu">BuildPartList</span><span class="op">(</span>scoreThreshold<span class="op">,</span> kLocalMaximumRadius<span class="op">,</span> heatmaps<span class="op">);</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    bodyPartList<span class="op">.</span><span class="fu">Sort</span><span class="op">((</span>a<span class="op">,</span> b<span class="op">)</span> <span class="op">=&gt;</span> b<span class="op">.</span><span class="fu">prob</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>a<span class="op">.</span><span class="fu">prob</span><span class="op">));</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Continue decoding poses until the maximum number of detections is reached or the body part list is empty</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="op">(</span>humanPoses<span class="op">.</span><span class="fu">Count</span> <span class="op">&lt;</span> maxPoseDetections <span class="op">&amp;&amp;</span> bodyPartList<span class="op">.</span><span class="fu">Count</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>        BodyPart2D root <span class="op">=</span> bodyPartList<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        bodyPartList<span class="op">.</span><span class="fu">RemoveAt</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        Vector2 rootImageCoords <span class="op">=</span> <span class="fu">GetImageCoords</span><span class="op">(</span>root<span class="op">,</span> stride<span class="op">,</span> offsets<span class="op">);</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If the root is not within the non-maximum suppression radius of any existing pose,</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// decode the pose and add it to the list of human poses</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(!</span><span class="fu">WithinNmsRadiusOfCorrespondingPoint</span><span class="op">(</span>humanPoses<span class="op">,</span> squaredNmsRadius<span class="op">,</span> rootImageCoords<span class="op">,</span> root<span class="op">.</span><span class="fu">index</span><span class="op">))</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>            HumanPose2D pose <span class="op">=</span> <span class="kw">new</span> HumanPose2D</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>                index <span class="op">=</span> humanPoses<span class="op">.</span><span class="fu">Count</span><span class="op">,</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>                bodyParts <span class="op">=</span> <span class="fu">DecodePose</span><span class="op">(</span>root<span class="op">,</span> heatmaps<span class="op">,</span> offsets<span class="op">,</span> stride<span class="op">,</span> displacementsFwd<span class="op">,</span> displacementBwd<span class="op">)</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>            humanPoses<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>pose<span class="op">);</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> humanPoses<span class="op">;</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cropinputdims" class="level4">
<h4 class="anchored" data-anchor-id="cropinputdims"><code>CropInputDims</code></h4>
<p>This method crops input dimensions to be divisible by the maximum stride.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Crop input dimensions to be divisible by the maximum stride.</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Vector2Int <span class="fu">CropInputDims</span><span class="op">(</span>Vector2Int inputDims<span class="op">)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    inputDims<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">-=</span> inputDims<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">%</span> maxStride<span class="op">;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    inputDims<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">-=</span> inputDims<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">%</span> maxStride<span class="op">;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> inputDims<span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="packageinstaller.cs" class="level3">
<h3 class="anchored" data-anchor-id="packageinstaller.cs"><code>PackageInstaller.cs</code></h3>
<p>In this section, we will go through the <code>PackageInstaller.cs</code> script and explain how each part of the code works to install the required packages. The complete code is available on GitHub at the link below.</p>
<ul>
<li><a href="https://github.com/cj-mills/unity-barracuda-inference-posenet/blob/main/Editor/PackageInstaller.cs">PackageInstaller.cs</a></li>
</ul>
<section id="serializable-classes" class="level4">
<h4 class="anchored" data-anchor-id="serializable-classes">Serializable Classes</h4>
<p>The script defines two serializable classes to hold package data.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Serializable class to hold package data</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>System<span class="op">.</span><span class="fu">Serializable</span><span class="op">]</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PackageData</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> packageName<span class="op">;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> packageUrl<span class="op">;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Serializable class to hold a list of PackageData objects</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>System<span class="op">.</span><span class="fu">Serializable</span><span class="op">]</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PackageList</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> List<span class="op">&lt;</span>PackageData<span class="op">&gt;</span> packages<span class="op">;</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These classes are for deserializing the JSON file containing the list of packages to install.</p>
</section>
<section id="packageinstaller-class-variables" class="level4">
<h4 class="anchored" data-anchor-id="packageinstaller-class-variables"><code>PackageInstaller</code> Class Variables</h4>
<p>The <code>PackageInstaller</code> class contains several private static fields.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the AddRequest object for the current package to install.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> AddRequest addRequest<span class="op">;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">// A list of PackageData objects to install.</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> List<span class="op">&lt;</span>PackageData<span class="op">&gt;</span> packagesToInstall<span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">// The index of the current package to install.</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="dt">int</span> currentPackageIndex<span class="op">;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">// GUID of the JSON file containing the list of packages to install</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">const</span> <span class="dt">string</span> PackagesJSONGUID <span class="op">=</span> <span class="st">"0d78f4ab62d44aba8a8e95e6a8abfe8a"</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="installdependencies" class="level4">
<h4 class="anchored" data-anchor-id="installdependencies"><code>InstallDependencies</code></h4>
<p>The <code>InstallDependencies()</code> method executes when Unity loads without action from the user. It reads the package JSON file and calls the <code>InstallNextPackage()</code> method to install the packages.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Method called on load to install packages from the JSON file</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>InitializeOnLoadMethod<span class="op">]</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">InstallDependencies</span><span class="op">()</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Read the package JSON file</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    packagesToInstall <span class="op">=</span> <span class="fu">ReadPackageJson</span><span class="op">().</span><span class="fu">packages</span><span class="op">;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the current package index</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    currentPackageIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start installing the packages</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InstallNextPackage</span><span class="op">();</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="installnextpackage" class="level4">
<h4 class="anchored" data-anchor-id="installnextpackage"><code>InstallNextPackage</code></h4>
<p>This method installs the next package in the list.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Method to install the next package in the list</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">InstallNextPackage</span><span class="op">()</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate through package list</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>currentPackageIndex <span class="op">&lt;</span> packagesToInstall<span class="op">.</span><span class="fu">Count</span><span class="op">)</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        PackageData packageData <span class="op">=</span> packagesToInstall<span class="op">[</span>currentPackageIndex<span class="op">];</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if the package is already installed</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(!</span><span class="fu">IsPackageInstalled</span><span class="op">(</span>packageData<span class="op">.</span><span class="fu">packageName</span><span class="op">))</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Attempt to install package</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>            addRequest <span class="op">=</span> Client<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>packageData<span class="op">.</span><span class="fu">packageUrl</span><span class="op">);</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>            EditorApplication<span class="op">.</span><span class="fu">update</span> <span class="op">+=</span> PackageInstallationProgress<span class="op">;</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Increment the current package index</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>            currentPackageIndex<span class="op">++;</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Recursively call InstallNextPackage</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">InstallNextPackage</span><span class="op">();</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="packageinstallationprogress" class="level4">
<h4 class="anchored" data-anchor-id="packageinstallationprogress"><code>PackageInstallationProgress</code></h4>
<p>This method monitors the progress of the package installation and logs whether it was successful. It then triggers the installation process for the next package in the list.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Method to monitor the progress of package installation</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">PackageInstallationProgress</span><span class="op">()</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>addRequest<span class="op">.</span><span class="fu">IsCompleted</span><span class="op">)</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Log whether the package installation was successful</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>addRequest<span class="op">.</span><span class="fu">Status</span> <span class="op">==</span> StatusCode<span class="op">.</span><span class="fu">Success</span><span class="op">)</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>            UnityEngine<span class="op">.</span><span class="fu">Debug</span><span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Successfully installed: {addRequest.Result.packageId}"</span><span class="op">);</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span>addRequest<span class="op">.</span><span class="fu">Status</span> <span class="op">&gt;=</span> StatusCode<span class="op">.</span><span class="fu">Failure</span><span class="op">)</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>            UnityEngine<span class="op">.</span><span class="fu">Debug</span><span class="op">.</span><span class="fu">LogError</span><span class="op">(</span>$<span class="st">"Failed to install package: {addRequest.Error.message}"</span><span class="op">);</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Unregister the method from the EditorApplication.update </span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        EditorApplication<span class="op">.</span><span class="fu">update</span> <span class="op">-=</span> PackageInstallationProgress<span class="op">;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Increment the current package index</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        currentPackageIndex<span class="op">++;</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Install the next package in the list</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">InstallNextPackage</span><span class="op">();</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ispackageinstalled" class="level4">
<h4 class="anchored" data-anchor-id="ispackageinstalled"><code>IsPackageInstalled</code></h4>
<p>This method verifies whether a package has already been installed or not.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Method to check if a package is already installed</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="dt">bool</span> <span class="fu">IsPackageInstalled</span><span class="op">(</span><span class="dt">string</span> packageName<span class="op">)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// List the installed packages</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> listRequest <span class="op">=</span> Client<span class="op">.</span><span class="fu">List</span><span class="op">(</span><span class="kw">true</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="op">(!</span>listRequest<span class="op">.</span><span class="fu">IsCompleted</span><span class="op">)</span> <span class="op">{</span> <span class="op">}</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>listRequest<span class="op">.</span><span class="fu">Status</span> <span class="op">==</span> StatusCode<span class="op">.</span><span class="fu">Success</span><span class="op">)</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if the package is already installed</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> listRequest<span class="op">.</span><span class="fu">Result</span><span class="op">.</span><span class="fu">Any</span><span class="op">(</span>package <span class="op">=&gt;</span> package<span class="op">.</span><span class="fu">name</span> <span class="op">==</span> packageName<span class="op">);</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        UnityEngine<span class="op">.</span><span class="fu">Debug</span><span class="op">.</span><span class="fu">LogError</span><span class="op">(</span>$<span class="st">"Failed to list packages: {listRequest.Error.message}"</span><span class="op">);</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="readpackagejson" class="level4">
<h4 class="anchored" data-anchor-id="readpackagejson"><code>ReadPackageJson</code></h4>
<p>This method reads the JSON file containing the list of packages to install and returns a <code>PackageList</code> object.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Method to read the JSON file and return a PackageList object</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> PackageList <span class="fu">ReadPackageJson</span><span class="op">()</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert the PackagesJSONGUID to an asset path</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> assetPath <span class="op">=</span> AssetDatabase<span class="op">.</span><span class="fu">GUIDToAssetPath</span><span class="op">(</span>PackagesJSONGUID<span class="op">);</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Read the JSON file content as a string</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> jsonString <span class="op">=</span> File<span class="op">.</span><span class="fu">ReadAllText</span><span class="op">(</span>assetPath<span class="op">);</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Deserialize the JSON string into a PackageList object</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> JsonUtility<span class="op">.</span><span class="fu">FromJson</span><span class="op">&lt;</span>PackageList<span class="op">&gt;(</span>jsonString<span class="op">);</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This post provided an in-depth walkthrough of the code for the Barracuda Inference PoseNet package. The package extends the functionality of <a href="https://github.com/cj-mills/unity-barracuda-inference-base"><code>unity-barracuda-inference-base</code></a> to perform 2D human pose estimation using PoseNet models.</p>
<p>You can continue to explore the package by going to its GitHub repository linked below, where you will also find instructions for installing it using the Unity Package Manager.</p>
<ul>
<li>GitHub Repository: <a href="https://github.com/cj-mills/unity-barracuda-inference-posenet">unity-barracuda-inference-posenet</a></li>
</ul>
<p>You can find the code for the demo project shown in the video at the beginning of this post linked below.</p>
<ul>
<li><a href="https://github.com/cj-mills/barracuda-inference-posenet-demo">Barracuda Inference PoseNet Demo</a>: A simple Unity project demonstrating how to perform 2D human pose estimation with the <code>barracuda-inference-posenet</code> package.</li>
</ul>
<hr>
<div class="callout callout-style-default callout-tip callout-titled" title="About Me:">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About Me:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>I’m Christian Mills, a deep learning consultant specializing in computer vision and practical AI implementations.</li>
<li>I help clients leverage cutting-edge AI technologies to solve real-world problems.</li>
<li>Learn more <a href="../../about.html">about me</a> or reach out via email at <a href="mailto:christian@christianjmills.com">christian@christianjmills.com</a> to discuss your project.</li>
</ul>
</div>
</div>


</section>

</main> <!-- /main -->
<!-- Cloudflare Web Analytics --><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;56b8d2f624604c4891327b3c0d9f6703&quot;}"></script><!-- End Cloudflare Web Analytics -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/christianjmills\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="cj-mills/christianjmills" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<p>Content licensed under CC BY-NC-SA 4.0</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../about.html">
<p>© 2024 Christian J. Mills</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://opensource.org/licenses/MIT">
<p>Code samples licensed under the MIT License</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>