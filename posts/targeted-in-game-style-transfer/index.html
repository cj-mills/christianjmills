<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian Mills">
<meta name="dcterms.date" content="2021-07-04">
<meta name="description" content="This post covers how to select which game objects get stylized in the Unity scene.">

<title>Christian Mills - Targeted In-Game Style Transfer Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Christian Mills - Targeted In-Game Style Transfer Tutorial">
<meta property="og:description" content="This post covers how to select which game objects get stylized in the Unity scene.">
<meta property="og:image" content="christianjmills.com/posts/targeted-in-game-style-transfer/images/logo.png">
<meta property="og:site_name" content="Christian Mills">
<meta name="twitter:title" content="Christian Mills - Targeted In-Game Style Transfer Tutorial">
<meta name="twitter:description" content="This post covers how to select which game objects get stylized in the Unity scene.">
<meta name="twitter:image" content="christianjmills.com/posts/targeted-in-game-style-transfer/images/logo.png">
<meta name="twitter:creator" content="@cdotjdotmills">
<meta name="twitter:site" content="@cdotjdotmills">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Christian Mills</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../series/tutorials/index.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../series/notes/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:christian@christianjmills.com"> <i class="bi bi-envelope-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cj-mills"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/christianjmills"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#download-unity-project" id="toc-download-unity-project" class="nav-link" data-scroll-target="#download-unity-project">Download Unity Project</a>
  <ul>
  <li><a href="#fix-assetimporter-error" id="toc-fix-assetimporter-error" class="nav-link" data-scroll-target="#fix-assetimporter-error">Fix <code>AssetImporter</code> Error</a></li>
  </ul></li>
  <li><a href="#method" id="toc-method" class="nav-link" data-scroll-target="#method">Method</a>
  <ul>
  <li><a href="#standard-scene" id="toc-standard-scene" class="nav-link" data-scroll-target="#standard-scene">Standard Scene</a></li>
  <li><a href="#character-only" id="toc-character-only" class="nav-link" data-scroll-target="#character-only">Character Only</a></li>
  </ul></li>
  <li><a href="#create-depth-cameras" id="toc-create-depth-cameras" class="nav-link" data-scroll-target="#create-depth-cameras">Create Depth Cameras</a>
  <ul>
  <li><a href="#create-stylize-layer" id="toc-create-stylize-layer" class="nav-link" data-scroll-target="#create-stylize-layer">Create Stylize Layer</a>
  <ul class="collapse">
  <li><a href="#set-style-depth-culling-mask" id="toc-set-style-depth-culling-mask" class="nav-link" data-scroll-target="#set-style-depth-culling-mask">Set Style Depth Culling Mask</a></li>
  </ul></li>
  <li><a href="#assign-stylize-layer" id="toc-assign-stylize-layer" class="nav-link" data-scroll-target="#assign-stylize-layer">Assign Stylize Layer</a></li>
  </ul></li>
  <li><a href="#update-styletransfershader" id="toc-update-styletransfershader" class="nav-link" data-scroll-target="#update-styletransfershader">Update StyleTransferShader</a></li>
  <li><a href="#update-styletransfer-script" id="toc-update-styletransfer-script" class="nav-link" data-scroll-target="#update-styletransfer-script">Update StyleTransfer Script</a>
  <ul>
  <li><a href="#add-depth-camera-variables" id="toc-add-depth-camera-variables" class="nav-link" data-scroll-target="#add-depth-camera-variables">Add Depth Camera Variables</a></li>
  <li><a href="#assign-depth-textures" id="toc-assign-depth-textures" class="nav-link" data-scroll-target="#assign-depth-textures">Assign Depth Textures</a></li>
  <li><a href="#update-depth-texture-dimensions" id="toc-update-depth-texture-dimensions" class="nav-link" data-scroll-target="#update-depth-texture-dimensions">Update Depth Texture Dimensions</a></li>
  <li><a href="#release-depth-textures" id="toc-release-depth-textures" class="nav-link" data-scroll-target="#release-depth-textures">Release Depth Textures</a></li>
  <li><a href="#create-merge-method" id="toc-create-merge-method" class="nav-link" data-scroll-target="#create-merge-method">Create <code>Merge()</code> Method</a></li>
  <li><a href="#update-onrenderimage-method" id="toc-update-onrenderimage-method" class="nav-link" data-scroll-target="#update-onrenderimage-method">Update <code>OnRenderImage()</code> Method</a></li>
  </ul></li>
  <li><a href="#assign-depth-cameras" id="toc-assign-depth-cameras" class="nav-link" data-scroll-target="#assign-depth-cameras">Assign Depth Cameras</a>
  <ul>
  <li><a href="#test-it-out" id="toc-test-it-out" class="nav-link" data-scroll-target="#test-it-out">Test it Out</a></li>
  </ul></li>
  <li><a href="#assign-stylize-layer-with-code" id="toc-assign-stylize-layer-with-code" class="nav-link" data-scroll-target="#assign-stylize-layer-with-code">Assign Stylize Layer With Code</a>
  <ul>
  <li><a href="#method-1" id="toc-method-1" class="nav-link" data-scroll-target="#method-1">Method</a></li>
  <li><a href="#steps" id="toc-steps" class="nav-link" data-scroll-target="#steps">Steps</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Targeted In-Game Style Transfer Tutorial</h1>
  <div class="quarto-categories">
    <div class="quarto-category">style-transfer</div>
    <div class="quarto-category">unity</div>
    <div class="quarto-category">tutorial</div>
  </div>
  </div>

<div>
  <div class="description">
    This post covers how to select which game objects get stylized in the Unity scene.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian Mills </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 4, 2021</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#download-unity-project">Download Unity Project</a></li>
<li><a href="#method">Method</a></li>
<li><a href="#create-depth-cameras">Create Depth Cameras</a></li>
<li><a href="#update-styletransfershader">Update StyleTransferShader</a></li>
<li><a href="#update-styleTransfer-script">Update StyleTransfer Script</a></li>
<li><a href="#assign-depth-cameras">Assign Depth Cameras</a></li>
<li><a href="#assign-stylize-layer-with-code">Assign Stylize Layer With Code</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/mesh_shader_test_1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In this follow up to the in-game style transfer <a href="../end-to-end-in-game-style-transfer-tutorial/part-1/">tutorial</a>, we’ll cover a method to stylize specific GameObjects in a Unity. This tutorial builds on the project from the previous tutorial. If you did not follow that tutorial, you can follow the steps to download the project below.</p>
</section>
<section id="download-unity-project" class="level2">
<h2 class="anchored" data-anchor-id="download-unity-project">Download Unity Project</h2>
<p><strong>Note:</strong> You can skip this section If you followed the previous tutorial and already have the project.</p>
<p>You can download the project from the previous tutorial by clicking on the link below.</p>
<ul>
<li>GitHub Repository: (<a href="https://github.com/cj-mills/End-to-End-In-Game-Style-Transfer-Tutorial/archive/refs/heads/main.zip">download</a>)</li>
</ul>
<p>Once the download is complete, extract the project folder.</p>
<p>Open Unity Hub and click the <code>Add</code> button.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-select-add.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Navigate to the extracted <code>End-to-End-In-Game-Style-Transfer-Tutorial-Intel-main</code> folder and select the <code>Kinematica_Demo_0.8.0-preview</code> folder.</p>
<p>We’ll be working in Unity 2019.4.20, but later versions are also supported.</p>
<p>The project will take several minutes to open the first time as it imports the project assets.</p>
<section id="fix-assetimporter-error" class="level3">
<h3 class="anchored" data-anchor-id="fix-assetimporter-error">Fix <code>AssetImporter</code> Error</h3>
<p>You might get an error like the one below after opening the project in Unity.</p>
<p><code>AssetImporter is referencing an asset from the previous import. This should not happen.</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/previous_import_error.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>You can fix this issue by rebuilding the Unit asset. Open the <code>Kinematica</code> folder in the Assets section and double-click on the <code>Unit</code> asset. This will open the <code>Kinematica Asset Builder</code> window.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unit_asset.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Click <code>Build</code> in the pop-up window. You can close the pop-up window once the build is complete.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/kinematica_asset_builder.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Back in the <code>Assets</code> section, open the <code>Biped</code> scene in the <code>Scenes</code> folder. The project should run normally now. However, there might be some stuttering the first time it is run.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/biped_scene.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="method" class="level2">
<h2 class="anchored" data-anchor-id="method">Method</h2>
<p>For this method, we’ll still be using the entire camera frame as the input for the style transfer model. However, we can use <a href="https://docs.unity3d.com/Manual/Layers.html">Layers</a> to identify what parts of the final image will be from the stylized version of the current frame.</p>
<p>We’ll need to capture depth data from the scene to determine what needs to be stylized at runtime. We can’t use the regular color data because the lighting is different when a camera only renders certain parts of the scene.</p>
<section id="standard-scene" class="level4">
<h4 class="anchored" data-anchor-id="standard-scene">Standard Scene</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/standard-scene-lighting.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="character-only" class="level4">
<h4 class="anchored" data-anchor-id="character-only">Character Only</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/style_camera_1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Here is an example of depth data captured from the camera that has been edited to be more easily viewable. Depth data is stored in the red color channel and can be difficult to see.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/styleDepth-view-edited-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="create-depth-cameras" class="level2">
<h2 class="anchored" data-anchor-id="create-depth-cameras">Create Depth Cameras</h2>
<p>In the <code>Hierarchy</code> tab, select the <code>Main Camera</code> object and press Ctrl-d twice to create two copies.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/duplicate_main_camera.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Hold Ctrl and select both of the camera copies. Drag them onto the original <code>Main Camera</code> object to make them child objects.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/parent_camera_duplicates.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>With the duplicates still selected, we will remove every component except the <code>Camera</code> component. You can remove components by right-clicking on the component name and selecting <code>Remove Component</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/remove_component.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/removed_duplicate_camera_components.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Also, make sure that the position and rotation values for the Transform component for each of the depth cameras are set to to zero. We need to make sure they are in exactly the same position as the Main Camera, or the depth values will be off.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/verify-depth-camera-transform-values.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>One of the duplicate cameras will capture the depth data for the GameObjects we want to stylize. We’ll call this one <code>Style Depth</code>. The second duplicate will capture the depth data for the standard scene, and be called <code>Source Depth</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/name-depth-cameras.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<section id="create-stylize-layer" class="level3">
<h3 class="anchored" data-anchor-id="create-stylize-layer">Create Stylize Layer</h3>
<p>We’ll identify the GameObjects we want to stylize by assigning a new Layer to these objects. Select the <code>Layers</code> drop-down menu and click <code>Edit Layers...</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/select_edit_layers.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>In the Inspector tab open the <code>Layers</code> drop-down and enter <code>Stylize</code> in the <code>User Layer 12</code> slot.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/add_stylize_layer.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<section id="set-style-depth-culling-mask" class="level4">
<h4 class="anchored" data-anchor-id="set-style-depth-culling-mask">Set Style Depth Culling Mask</h4>
<p>Lastly, with the <code>Stylize Depth</code> camera selected, set the <code>Culling Mask</code> to <code>Stylize</code> only in the Inspector tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/style_depth_set_culling_mask.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="assign-stylize-layer" class="level3">
<h3 class="anchored" data-anchor-id="assign-stylize-layer">Assign Stylize Layer</h3>
<p>We can assign the Stylize layer to just about any GameObject we wish. To start, let’s assign it to the <code>Unit</code> parent object in the <code>Hierarchy</code> tab which contains the GameObjects for the character model. With the Unit object selected in the Hierarchy tab, select the <code>Stylize</code> layer from the Layer drop-down in the Inspector tab.</p>
<p><strong>Note:</strong> You might get a bunch of errors in the console when you select the Unit object. You can ignore these.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/assign_stylize_layer.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>You will be prompted to chose whether to set the layer for the child objects as well. Select <code>Yes, change children</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/change_layer_popup.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="update-styletransfershader" class="level2">
<h2 class="anchored" data-anchor-id="update-styletransfershader">Update StyleTransferShader</h2>
<p>Next, we will add a new function to our compute shader that will select what parts of the stylize frame to keep. In the Assets section, open the <code>Shaders</code> subfolder located inside the <code>Style_Transfer</code> folder. Open the <code>StyleTransferShader</code> in your code editor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/open_styleTransferShader.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>First, we need to add three new Texture2D variables. Two of these will store the depth data from the <code>Style Depth</code> and <code>Source Depth</code> cameras. The third will store the original image for the current frame.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Each #kernel tells which function to compile; you can have many kernels</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessInput</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessOutput</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a RenderTexture with enableRandomWrite flag and set it</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">// with cs.SetTexture</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>RWTexture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> Result<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the input image and is set with cs.SetTexture</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> InputImage<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the depth data from the StyleDepth camera</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> StyleDepth<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the depth data from the SourceDepth camera</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> SrcDepth<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Store the original image from the current frame</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> SrcImage<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">8</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">ProcessInput</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">half4</span><span class="op">((</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">y</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">z</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span> <span class="fl">1.0</span>h<span class="op">);</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we can add the new function. We’ll call it <code>Merge</code> since it merges the original and stylized frame. This function compares the pixel values from the StyleDepth and SrcDepth textures. If they match, that means a target GameObject is present and there is nothing in front of it. However, this does not account for parts of the scene with infinite depth like the sky. We can add another check to see if the current pixel value for the StyleDepth texture is greater than zero.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">8</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">Merge</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> match <span class="op">=</span> StyleDepth<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span> <span class="op">==</span> SrcDepth<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>match <span class="op">&amp;&amp;</span> <span class="op">(</span>StyleDepth<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">half4</span><span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">r</span><span class="op">,</span> InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">g</span><span class="op">,</span> InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">b</span><span class="op">,</span> InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">a</span><span class="op">);</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">half4</span><span class="op">(</span>SrcImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">r</span><span class="op">,</span> SrcImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">g</span><span class="op">,</span> SrcImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">b</span><span class="op">,</span> SrcImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">a</span><span class="op">);</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we just need to add the <code>#pragma kernel Merge</code> line at the top of the file.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Each #kernel tells which function to compile; you can have many kernels</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessInput</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessOutput</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>#pragma kernel Merge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="update-styletransfer-script" class="level2">
<h2 class="anchored" data-anchor-id="update-styletransfer-script">Update StyleTransfer Script</h2>
<p>The next step is to modify the <code>StyleTransfer</code> script. The script is located in the Scripts subfolder inside the Style_Transfer folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/open_styleTransfer_script.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<section id="add-depth-camera-variables" class="level4">
<h4 class="anchored" data-anchor-id="add-depth-camera-variables">Add Depth Camera Variables</h4>
<p>The only new variables we need to add are for the two depth cameras. We’ll name them <code>styleDepth</code> and <code>sourceDepth</code> respectively. We can also add another <code>bool</code> variable to toggle the targeted stylization.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StyleTransfer <span class="op">:</span> MonoBehaviour</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Performs the preprocessing and postprocessing steps"</span><span class="op">)]</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> ComputeShader styleTransferShader<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Stylize the camera feed"</span><span class="op">)]</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> stylizeImage <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Stylize only specified GameObjects"</span><span class="op">)]</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> targetedStylization <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The height of the image being fed to the model"</span><span class="op">)]</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> targetHeight <span class="op">=</span> <span class="dv">540</span><span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The model asset file that will be used when performing inference"</span><span class="op">)]</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> NNModel modelAsset<span class="op">;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The backend used when performing inference"</span><span class="op">)]</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> WorkerFactory<span class="op">.</span><span class="fu">Type</span> workerType <span class="op">=</span> WorkerFactory<span class="op">.</span><span class="fu">Type</span><span class="op">.</span><span class="fu">Auto</span><span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Captures the depth data for the target GameObjects"</span><span class="op">)]</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Camera styleDepth<span class="op">;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Captures the depth data for the entire scene"</span><span class="op">)]</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Camera sourceDepth<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="assign-depth-textures" class="level4">
<h4 class="anchored" data-anchor-id="assign-depth-textures">Assign Depth Textures</h4>
<p>Currently, the depth cameras are just capturing standard color data. We need to manually assign <code>Depth</code> textures to the <code>targetTexture</code> property for both of the cameras. We’ll do this at the top of the <code>Start()</code> method. The textures need to have the same dimensions as target screen. We can access this in <code>Screen.width</code> and <code>Screen.height</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Start is called before the first frame update</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the screen dimensions</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width <span class="op">=</span> Screen<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> height <span class="op">=</span> Screen<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Force the StyleDepth Camera to render to a Depth texture</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    styleDepth<span class="op">.</span><span class="fu">targetTexture</span> <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">Depth</span><span class="op">);</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    styleDepth<span class="op">.</span><span class="fu">forceIntoRenderTexture</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Force the SourceDepth Camera to render to a Depth texture</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    sourceDepth<span class="op">.</span><span class="fu">targetTexture</span> <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">Depth</span><span class="op">);</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    sourceDepth<span class="op">.</span><span class="fu">forceIntoRenderTexture</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Compile the model asset into an object oriented representation</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    m_RuntimeModel <span class="op">=</span> ModelLoader<span class="op">.</span><span class="fu">Load</span><span class="op">(</span>modelAsset<span class="op">);</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a worker that will execute the model with the selected backend</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    engine <span class="op">=</span> WorkerFactory<span class="op">.</span><span class="fu">CreateWorker</span><span class="op">(</span>workerType<span class="op">,</span> m_RuntimeModel<span class="op">);</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="update-depth-texture-dimensions" class="level4">
<h4 class="anchored" data-anchor-id="update-depth-texture-dimensions">Update Depth Texture Dimensions</h4>
<p>If the screen resolution changes while the project is running, the resolution for the depth textures will need to be updated as well. We can check if the screen resolution has changed in the <code>Update()</code> method.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">Update</span><span class="op">()</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>styleDepth<span class="op">.</span><span class="fu">targetTexture</span><span class="op">.</span><span class="fu">width</span> <span class="op">!=</span> Screen<span class="op">.</span><span class="fu">width</span> <span class="op">||</span> styleDepth<span class="op">.</span><span class="fu">targetTexture</span><span class="op">.</span><span class="fu">height</span> <span class="op">!=</span> Screen<span class="op">.</span><span class="fu">height</span><span class="op">)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the screen dimensions</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> width <span class="op">=</span> Screen<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> height <span class="op">=</span> Screen<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Assign depth textures with the new dimensions</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        styleDepth<span class="op">.</span><span class="fu">targetTexture</span> <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">Depth</span><span class="op">);</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        sourceDepth<span class="op">.</span><span class="fu">targetTexture</span> <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">Depth</span><span class="op">);</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="release-depth-textures" class="level4">
<h4 class="anchored" data-anchor-id="release-depth-textures">Release Depth Textures</h4>
<p>We will release the temporary Depth textures in the <code>OnDisable()</code> method.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OnDisable is called when the MonoBehavior becomes disabled or inactive</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">OnDisable</span><span class="op">()</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Release the resources allocated for the inference engine</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    engine<span class="op">.</span><span class="fu">Dispose</span><span class="op">();</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Release the Depth texture for the StyleDepth camera</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>styleDepth<span class="op">.</span><span class="fu">targetTexture</span><span class="op">);</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Release the Depth texture for the SourceDepth camera</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>sourceDepth<span class="op">.</span><span class="fu">targetTexture</span><span class="op">);</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-merge-method" class="level4">
<h4 class="anchored" data-anchor-id="create-merge-method">Create <code>Merge()</code> Method</h4>
<p>Next, we need to add a new method to dispatch the Merge function in the compute shader. This method will be nearly identical to the existing <code>ProcessImage()</code> method except that it will also set the values for the <code>StyleDepth</code>, <code>SrcDepth</code>, and <code>SrcImage</code> variables.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Merge the stylized frame and the original frame on the GPU</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"styleImage"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"sourceImage"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The merged image</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">Merge</span><span class="op">(</span>RenderTexture styleImage<span class="op">,</span> RenderTexture sourceImage<span class="op">)</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Specify the number of threads on the GPU</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numthreads <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the index for the specified function in the ComputeShader</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> kernelHandle <span class="op">=</span> styleTransferShader<span class="op">.</span><span class="fu">FindKernel</span><span class="op">(</span><span class="st">"Merge"</span><span class="op">);</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define a temporary HDR RenderTexture</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width <span class="op">=</span> styleImage<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> height <span class="op">=</span> styleImage<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    RenderTexture result <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">ARGBHalf</span><span class="op">);</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Enable random write access</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    result<span class="op">.</span><span class="fu">enableRandomWrite</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create the HDR RenderTexture</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    result<span class="op">.</span><span class="fu">Create</span><span class="op">();</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the Result variable in the ComputeShader</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    styleTransferShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"Result"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the InputImage variable in the ComputeShader</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    styleTransferShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"InputImage"</span><span class="op">,</span> styleImage<span class="op">);</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the StyleDepth variable in the ComputeShader</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    styleTransferShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"StyleDepth"</span><span class="op">,</span> styleDepth<span class="op">.</span><span class="fu">activeTexture</span><span class="op">);</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the SrcDepth variable in the ComputeShader</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    styleTransferShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"SrcDepth"</span><span class="op">,</span> sourceDepth<span class="op">.</span><span class="fu">activeTexture</span><span class="op">);</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the SrcImage variable in the ComputeShader</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    styleTransferShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"SrcImage"</span><span class="op">,</span> sourceImage<span class="op">);</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Execute the ComputeShader</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    styleTransferShader<span class="op">.</span><span class="fu">Dispatch</span><span class="op">(</span>kernelHandle<span class="op">,</span> result<span class="op">.</span><span class="fu">width</span> <span class="op">/</span> numthreads<span class="op">,</span> result<span class="op">.</span><span class="fu">height</span> <span class="op">/</span> numthreads<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Copy the result into the source RenderTexture</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>result<span class="op">,</span> styleImage<span class="op">);</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Release the temporary RenderTexture</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>result<span class="op">);</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="update-onrenderimage-method" class="level4">
<h4 class="anchored" data-anchor-id="update-onrenderimage-method">Update <code>OnRenderImage()</code> Method</h4>
<p>We’ll call the <code>Merge()</code> method inside the <code>OnRenderImage()</code> method. First, we need to create a copy of the current frame before it gets stylized. The <code>Merge()</code> method will only be called when <code>targetedStylization</code> is set to <code>true</code> and <code>stylizeImage</code> is set to <code>true</code>. Lastly, we need to release the temporary <code>RenderTexture</code> for the copy of the current frame.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// OnRenderImage is called after the Camera had finished rendering </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"src"</span><span class="kw">&gt;</span><span class="co">Input from the Camera</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"dest"</span><span class="kw">&gt;</span><span class="co">The texture for the targer display</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">OnRenderImage</span><span class="op">(</span>RenderTexture src<span class="op">,</span> RenderTexture dest<span class="op">)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a temporary RenderTexture to store copy of the current frame</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    RenderTexture sourceImage <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>src<span class="op">.</span><span class="fu">width</span><span class="op">,</span> src<span class="op">.</span><span class="fu">height</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> src<span class="op">.</span><span class="fu">format</span><span class="op">);</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Copyt the current frame</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>src<span class="op">,</span> sourceImage<span class="op">);</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>stylizeImage<span class="op">)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">StylizeImage</span><span class="op">(</span>src<span class="op">);</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>targetedStylization<span class="op">)</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Merge the stylized frame and origina frame</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">Merge</span><span class="op">(</span>src<span class="op">,</span> sourceImage<span class="op">);</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>src<span class="op">,</span> dest<span class="op">);</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Release the temporary RenderTexture</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>sourceImage<span class="op">);</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="assign-depth-cameras" class="level2">
<h2 class="anchored" data-anchor-id="assign-depth-cameras">Assign Depth Cameras</h2>
<p>The last step is to assign the depth cameras to the <code>StyleTransfer</code> script in the Inspector tab. Select the Main Camera object in the Hierarchy tab. Drag and drop each of the depth cameras into their respective spots in the Inspector tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/assign-depth-cameras.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<section id="test-it-out" class="level3">
<h3 class="anchored" data-anchor-id="test-it-out">Test it Out</h3>
<p>If you hit the play button, you should see that only the GameObjects with the Stylize layer are stylized.</p>
</section>
</section>
<section id="assign-stylize-layer-with-code" class="level2">
<h2 class="anchored" data-anchor-id="assign-stylize-layer-with-code">Assign Stylize Layer With Code</h2>
<p>You might want to change which objects are stylized depending on certain conditions. As an example, we’ll demonstrate how to toggle stylization on and off for a GameObject when they are clicked on with the mouse at runtime.</p>
<section id="method-1" class="level3">
<h3 class="anchored" data-anchor-id="method-1">Method</h3>
<p>A common method to select GameObjects with the mouse is to use the <code>Physics.Raycast()</code> method. This approach involves casting a ray (i.e.&nbsp;a line) from the camera to the current mouse position. If that ray makes contact with a GameObject that has a collider component, we can identify that object and manipulate it in code.</p>
<p>This method will not work if the GameObject does not have a collider, so keep that in mind when using this approach in other projects.</p>
<p>The Kinematica Demo is not ideally structured for selecting individual GameObjects with the mouse. For example, the colliders for the level boundaries are not directly attached to the GameObjects like the one outlined below. That means we can’t click on any of the four level boundaries without adding new collider components.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/editor-wall-panel.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>The floor panels already have their own colliders attached and will work out of the box.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/editor-floor-panel.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>The obstacles that we can climb over are actually children of GameObjects that have a collider. That means every child object will be stylized rather than the specific child object we click on.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/editor-wall-obstacle.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="steps" class="level3">
<h3 class="anchored" data-anchor-id="steps">Steps</h3>
<p>We’ll implement the following steps in the <code>Update()</code> method.</p>
<ol type="1">
<li>Check if the mouse button has been clicked with <code>Input.GetMouseButtonUp()</code> method.</li>
<li>Create a new <code>Ray</code> variable that contains a ray going from the main camera to the current mouse position</li>
<li>Create a new <code>RaycastHit</code> variable.</li>
<li>Check if the ray has hit any colliders with the <code>Physics.Raycast()</code> method.
<ol type="1">
<li>Get a list of the child objects of the GameObject with the collider, including GameObject itself.</li>
<li>Iterate through the list of child objects.
<ol type="1">
<li>Check if the child object has a <code>MeshRenderer</code> component that is enabled.
<ol type="1">
<li>Toggle the objects layer between <code>Default</code> and <code>Stylize</code>.</li>
</ol></li>
</ol></li>
</ol></li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>styleDepth<span class="op">.</span><span class="fu">targetTexture</span><span class="op">.</span><span class="fu">width</span> <span class="op">!=</span> Screen<span class="op">.</span><span class="fu">width</span> <span class="op">||</span> styleDepth<span class="op">.</span><span class="fu">targetTexture</span><span class="op">.</span><span class="fu">height</span> <span class="op">!=</span> Screen<span class="op">.</span><span class="fu">height</span><span class="op">)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the screen dimensions</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width <span class="op">=</span> Screen<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> height <span class="op">=</span> Screen<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Assign depth textures with the new dimensions</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    styleDepth<span class="op">.</span><span class="fu">targetTexture</span> <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">Depth</span><span class="op">);</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    sourceDepth<span class="op">.</span><span class="fu">targetTexture</span> <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">Depth</span><span class="op">);</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>Input<span class="op">.</span><span class="fu">GetMouseButtonUp</span><span class="op">(</span><span class="dv">0</span><span class="op">))</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    Ray ray <span class="op">=</span> Camera<span class="op">.</span><span class="fu">main</span><span class="op">.</span><span class="fu">ScreenPointToRay</span><span class="op">(</span>Input<span class="op">.</span><span class="fu">mousePosition</span><span class="op">);</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    RaycastHit hit<span class="op">;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>Physics<span class="op">.</span><span class="fu">Raycast</span><span class="op">(</span>ray<span class="op">,</span> <span class="kw">out</span> hit<span class="op">))</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        Transform<span class="op">[]</span> allChildren <span class="op">=</span> hit<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">GetComponentsInChildren</span><span class="op">&lt;</span>Transform<span class="op">&gt;();</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> allChildren<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>            MeshRenderer meshRenderer <span class="op">=</span> allChildren<span class="op">[</span>i<span class="op">].</span><span class="fu">GetComponent</span><span class="op">&lt;</span>MeshRenderer<span class="op">&gt;();</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>meshRenderer <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> meshRenderer<span class="op">.</span><span class="fu">enabled</span><span class="op">)</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>allChildren<span class="op">[</span>i<span class="op">].</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">layer</span> <span class="op">==</span> <span class="dv">12</span><span class="op">)</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                    allChildren<span class="op">[</span>i<span class="op">].</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">layer</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                <span class="kw">else</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>                    allChildren<span class="op">[</span>i<span class="op">].</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">layer</span> <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we run the game now, we can click on GameObjects with colliders to toggle the stylization effect.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/targeted-stylization-test.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>


</section>
</section>

</main> <!-- /main -->
<!-- Cloudflare Web Analytics --><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;56b8d2f624604c4891327b3c0d9f6703&quot;}"></script><!-- End Cloudflare Web Analytics -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("christianjmills\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="cj-mills/christianjmills" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright 2024, Christian J. Mills
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>