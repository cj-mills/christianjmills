<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.543">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian Mills">
<meta name="dcterms.date" content="2021-07-06">
<meta name="description" content="This post demonstrates how to access the DLL as a plugin inside a Unity project.">

<title>Christian Mills - OpenVINO Plugin for Unity Tutorial Pt.3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Christian Mills - OpenVINO Plugin for Unity Tutorial Pt.3">
<meta property="og:description" content="This post demonstrates how to access the DLL as a plugin inside a Unity project.">
<meta property="og:image" content="christianjmills.com/images/empty.gif">
<meta property="og:site_name" content="Christian Mills">
<meta name="twitter:title" content="Christian Mills - OpenVINO Plugin for Unity Tutorial Pt.3">
<meta name="twitter:description" content="This post demonstrates how to access the DLL as a plugin inside a Unity project.">
<meta name="twitter:image" content="christianjmills.com/images/empty.gif">
<meta name="twitter:creator" content="@cdotjdotmills">
<meta name="twitter:site" content="@cdotjdotmills">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Christian Mills</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../series/tutorials/index.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../series/notes/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../services.html"> 
<span class="menu-text">Services</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:christian@christianjmills.com"> <i class="bi bi-envelope-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cj-mills"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/cdotjdotmills"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#previous-part-2" id="toc-previous-part-2" class="nav-link active" data-scroll-target="#previous-part-2">Previous: Part 2</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#create-new-project" id="toc-create-new-project" class="nav-link" data-scroll-target="#create-new-project">Create New Project</a></li>
  <li><a href="#install-barracuda-package" id="toc-install-barracuda-package" class="nav-link" data-scroll-target="#install-barracuda-package">Install Barracuda Package</a></li>
  <li><a href="#add-gui" id="toc-add-gui" class="nav-link" data-scroll-target="#add-gui">Add GUI</a>
  <ul>
  <li><a href="#import-canvas-prefab" id="toc-import-canvas-prefab" class="nav-link" data-scroll-target="#import-canvas-prefab">Import Canvas Prefab</a></li>
  <li><a href="#add-graphy-package" id="toc-add-graphy-package" class="nav-link" data-scroll-target="#add-graphy-package">Add Graphy Package</a></li>
  <li><a href="#add-event-system" id="toc-add-event-system" class="nav-link" data-scroll-target="#add-event-system">Add Event System</a></li>
  <li><a href="#make-a-test-build" id="toc-make-a-test-build" class="nav-link" data-scroll-target="#make-a-test-build">Make a Test Build</a></li>
  </ul></li>
  <li><a href="#create-video-player" id="toc-create-video-player" class="nav-link" data-scroll-target="#create-video-player">Create Video Player</a>
  <ul>
  <li><a href="#import-video-files" id="toc-import-video-files" class="nav-link" data-scroll-target="#import-video-files">Import Video Files</a></li>
  <li><a href="#create-the-videos-folder" id="toc-create-the-videos-folder" class="nav-link" data-scroll-target="#create-the-videos-folder">Create the Videos Folder</a></li>
  <li><a href="#add-video-files" id="toc-add-video-files" class="nav-link" data-scroll-target="#add-video-files">Add Video Files</a></li>
  <li><a href="#create-the-screen-gameobject" id="toc-create-the-screen-gameobject" class="nav-link" data-scroll-target="#create-the-screen-gameobject">Create the Screen GameObject</a></li>
  <li><a href="#resize-the-screen" id="toc-resize-the-screen" class="nav-link" data-scroll-target="#resize-the-screen">Resize the Screen</a></li>
  <li><a href="#update-screen-material" id="toc-update-screen-material" class="nav-link" data-scroll-target="#update-screen-material">Update Screen Material</a></li>
  <li><a href="#create-the-video-player" id="toc-create-the-video-player" class="nav-link" data-scroll-target="#create-the-video-player">Create the Video Player</a></li>
  <li><a href="#set-video-clip" id="toc-set-video-clip" class="nav-link" data-scroll-target="#set-video-clip">Set Video Clip</a></li>
  <li><a href="#make-the-video-loop" id="toc-make-the-video-loop" class="nav-link" data-scroll-target="#make-the-video-loop">Make the Video Loop</a></li>
  <li><a href="#set-render-mode" id="toc-set-render-mode" class="nav-link" data-scroll-target="#set-render-mode">Set Render Mode</a></li>
  <li><a href="#specify-renderer" id="toc-specify-renderer" class="nav-link" data-scroll-target="#specify-renderer">Specify Renderer</a></li>
  <li><a href="#adjust-the-camera" id="toc-adjust-the-camera" class="nav-link" data-scroll-target="#adjust-the-camera">Adjust the Camera</a></li>
  </ul></li>
  <li><a href="#set-up-style-transfer-code" id="toc-set-up-style-transfer-code" class="nav-link" data-scroll-target="#set-up-style-transfer-code">Set Up Style Transfer Code</a>
  <ul>
  <li><a href="#create-style-transfer-folder" id="toc-create-style-transfer-folder" class="nav-link" data-scroll-target="#create-style-transfer-folder">Create Style Transfer Folder</a></li>
  <li><a href="#import-onnx-files-to-assets" id="toc-import-onnx-files-to-assets" class="nav-link" data-scroll-target="#import-onnx-files-to-assets">Import ONNX Files to Assets</a></li>
  <li><a href="#styletransfershader-compute-shader" id="toc-styletransfershader-compute-shader" class="nav-link" data-scroll-target="#styletransfershader-compute-shader">StyleTransferShader Compute Shader</a>
  <ul class="collapse">
  <li><a href="#create-the-asset-file" id="toc-create-the-asset-file" class="nav-link" data-scroll-target="#create-the-asset-file">Create the Asset File</a></li>
  <li><a href="#remove-the-default-code" id="toc-remove-the-default-code" class="nav-link" data-scroll-target="#remove-the-default-code">Remove the Default Code</a></li>
  <li><a href="#create-processinput-function" id="toc-create-processinput-function" class="nav-link" data-scroll-target="#create-processinput-function">Create <code>ProcessInput</code> Function</a></li>
  <li><a href="#create-processoutput-function" id="toc-create-processoutput-function" class="nav-link" data-scroll-target="#create-processoutput-function">Create <code>ProcessOutput</code> Function</a></li>
  <li><a href="#create-flipxaxis-function" id="toc-create-flipxaxis-function" class="nav-link" data-scroll-target="#create-flipxaxis-function">Create <code>FlipXAxis()</code> Function</a></li>
  </ul></li>
  <li><a href="#create-styletransfer-script" id="toc-create-styletransfer-script" class="nav-link" data-scroll-target="#create-styletransfer-script">Create <code>StyleTransfer</code> Script</a>
  <ul class="collapse">
  <li><a href="#create-the-asset-file-1" id="toc-create-the-asset-file-1" class="nav-link" data-scroll-target="#create-the-asset-file-1">Create the Asset File</a></li>
  <li><a href="#add-required-namespaces" id="toc-add-required-namespaces" class="nav-link" data-scroll-target="#add-required-namespaces">Add Required Namespaces</a></li>
  <li><a href="#add-public-variables" id="toc-add-public-variables" class="nav-link" data-scroll-target="#add-public-variables">Add Public Variables</a></li>
  <li><a href="#create-dll-method-declarations" id="toc-create-dll-method-declarations" class="nav-link" data-scroll-target="#create-dll-method-declarations">Create DLL Method Declarations</a></li>
  <li><a href="#add-private-variables" id="toc-add-private-variables" class="nav-link" data-scroll-target="#add-private-variables">Add Private Variables</a></li>
  <li><a href="#define-start-method" id="toc-define-start-method" class="nav-link" data-scroll-target="#define-start-method">Define <code>Start()</code> Method</a></li>
  <li><a href="#method-steps" id="toc-method-steps" class="nav-link" data-scroll-target="#method-steps">Method Steps</a></li>
  <li><a href="#create-processimage-method" id="toc-create-processimage-method" class="nav-link" data-scroll-target="#create-processimage-method">Create <code>ProcessImage()</code> Method</a></li>
  <li><a href="#create-stylizeimage-method" id="toc-create-stylizeimage-method" class="nav-link" data-scroll-target="#create-stylizeimage-method">Create <code>StylizeImage()</code> Method</a></li>
  <li><a href="#create-setinferenceengine-method" id="toc-create-setinferenceengine-method" class="nav-link" data-scroll-target="#create-setinferenceengine-method">Create <code>SetInferenceEngine()</code> Method</a></li>
  <li><a href="#create-setdevice-method" id="toc-create-setdevice-method" class="nav-link" data-scroll-target="#create-setdevice-method">Create <code>SetDevice()</code> Method</a></li>
  <li><a href="#create-updateinputdims-method" id="toc-create-updateinputdims-method" class="nav-link" data-scroll-target="#create-updateinputdims-method">Create <code>UpdateInputDims()</code> Method</a></li>
  <li><a href="#create-updatemodel-method" id="toc-create-updatemodel-method" class="nav-link" data-scroll-target="#create-updatemodel-method">Create <code>UpdateModel()</code> Method</a></li>
  <li><a href="#create-updatetexture-method" id="toc-create-updatetexture-method" class="nav-link" data-scroll-target="#create-updatetexture-method">Create <code>UpdateTexture()</code> Method</a></li>
  <li><a href="#create-oncompletereadback-callback" id="toc-create-oncompletereadback-callback" class="nav-link" data-scroll-target="#create-oncompletereadback-callback">Create <code>OnCompleteReadback()</code> Callback</a></li>
  <li><a href="#define-onrenderimage-method" id="toc-define-onrenderimage-method" class="nav-link" data-scroll-target="#define-onrenderimage-method">Define <code>OnRenderImage()</code> Method</a></li>
  <li><a href="#create-log-method" id="toc-create-log-method" class="nav-link" data-scroll-target="#create-log-method">Create <code>Log()</code> Method</a></li>
  <li><a href="#define-onenable-method" id="toc-define-onenable-method" class="nav-link" data-scroll-target="#define-onenable-method">Define <code>OnEnable()</code> Method</a></li>
  <li><a href="#define-ondestroy-method" id="toc-define-ondestroy-method" class="nav-link" data-scroll-target="#define-ondestroy-method">Define <code>OnDestroy()</code> Method</a></li>
  <li><a href="#create-quit-method" id="toc-create-quit-method" class="nav-link" data-scroll-target="#create-quit-method">Create <code>Quit()</code> Method</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#enable-unsafe-code" id="toc-enable-unsafe-code" class="nav-link" data-scroll-target="#enable-unsafe-code">Enable Unsafe Code</a></li>
  <li><a href="#attach-script-to-camera" id="toc-attach-script-to-camera" class="nav-link" data-scroll-target="#attach-script-to-camera">Attach Script to Camera</a></li>
  <li><a href="#assign-ui-events" id="toc-assign-ui-events" class="nav-link" data-scroll-target="#assign-ui-events">Assign UI Events</a>
  <ul>
  <li><a href="#update-button" id="toc-update-button" class="nav-link" data-scroll-target="#update-button">Update Button</a></li>
  <li><a href="#inference-engine-dropdown" id="toc-inference-engine-dropdown" class="nav-link" data-scroll-target="#inference-engine-dropdown">Inference Engine Dropdown</a></li>
  <li><a href="#device-dropdown" id="toc-device-dropdown" class="nav-link" data-scroll-target="#device-dropdown">Device Dropdown</a></li>
  <li><a href="#model-dropdown" id="toc-model-dropdown" class="nav-link" data-scroll-target="#model-dropdown">Model Dropdown</a></li>
  <li><a href="#quit-button" id="toc-quit-button" class="nav-link" data-scroll-target="#quit-button">Quit Button</a></li>
  </ul></li>
  <li><a href="#build-the-project" id="toc-build-the-project" class="nav-link" data-scroll-target="#build-the-project">Build the Project</a></li>
  <li><a href="#add-models-folder" id="toc-add-models-folder" class="nav-link" data-scroll-target="#add-models-folder">Add Models Folder</a></li>
  <li><a href="#add-plugins-folder" id="toc-add-plugins-folder" class="nav-link" data-scroll-target="#add-plugins-folder">Add Plugins folder</a></li>
  <li><a href="#run-the-application" id="toc-run-the-application" class="nav-link" data-scroll-target="#run-the-application">Run the Application</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">OpenVINO Plugin for Unity Tutorial Pt.3</h1>
  <div class="quarto-categories">
    <div class="quarto-category">openvino</div>
    <div class="quarto-category">style-transfer</div>
    <div class="quarto-category">tutorial</div>
    <div class="quarto-category">unity</div>
  </div>
  </div>

<div>
  <div class="description">
    This post demonstrates how to access the DLL as a plugin inside a Unity project.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian Mills </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 6, 2021</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="previous-part-2" class="level3">
<h3 class="anchored" data-anchor-id="previous-part-2">Previous: <a href="../part-2/">Part 2</a></h3>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#create-new-project">Create New Project</a></li>
<li><a href="#install-barracuda-package">Install Barracuda Package</a></li>
<li><a href="#add-gui">Add GUI</a></li>
<li><a href="#create-video-player">Create Video Player</a></li>
<li><a href="#set-up-style-transfer-code">Set Up Style Transfer Code</a></li>
<li><a href="#enable-unsafe-code">Enable Unsafe Code</a></li>
<li><a href="#attach-script-to-camera">Attach Script to Camera</a></li>
<li><a href="#assign-ui-events">Assign UI Events</a></li>
<li><a href="#build-the-project">Build the Project</a></li>
<li><a href="#add-models-folder">Add Models Folder</a></li>
<li><a href="#add-plugins-folder">Add Plugins folder</a></li>
<li><a href="#run-the-application">Run the Application</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In <a href="../part-1/">Part 1</a> of the tutorial, we first installed Unity, OpenVINO, and its prerequisite software. We then demonstrated how to use the python conversion script included with the OpenVINO™ Toolkit to convert a pretrained model from <a href="https://onnx.ai/">ONNX</a> format to the OpenVINO <a href="https://docs.openvinotoolkit.org/latest/openvino_docs_MO_DG_IR_and_opsets.html">Intermediate Representation</a> format. In <a href="../part-2/">Part 2</a>, we walked through the steps needed to create a <a href="https://docs.microsoft.com/en-us/troubleshoot/windows-client/deployment/dynamic-link-library">Dynamic link library (DLL)</a> in Visual Studio to perform <a href="https://www.intel.com/content/www/us/en/artificial-intelligence/posts/deep-learning-training-and-inference.html">inference</a> with the pretrained deep learning model. In this part, we will demonstrate how to access the DLL as a plugin inside a Unity project.</p>
</section>
<section id="create-new-project" class="level2">
<h2 class="anchored" data-anchor-id="create-new-project">Create New Project</h2>
<p>Open Unity Hub and click the <code>New</code> button.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-click-new.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Stick with the default <code>3D</code> template and name the project <code>OpenVINO_Plugin_Demo</code>. There appears to be some compatibility issues with the Barracuda library and some of the packages included with the 2D template.</p>
<p>Take note of where the project will be generated and click <code>Create</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-create-project.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="install-barracuda-package" class="level2">
<h2 class="anchored" data-anchor-id="install-barracuda-package">Install Barracuda Package</h2>
<p>To benchmark our plugin’s performance, we’ll be comparing the Intel-focused OpenVINO inference engine to Unity’s cross-platform <a href="https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/manual/index.html">Barracuda inference engine</a>.</p>
<p>Open the <code>Window</code> menu at the top of the Unity Editor and select <code>Package Manager</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-select-package-manager.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>In the Package Manager window, open the small dropdown menu in the left corner and select <code>Add package from git URL...</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/package-manager-add-git-url.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Type <code>com.unity.barracuda</code> into the text box and click <code>Add</code>. This will install Barracuda version <code>1.0.4</code>. Go ahead and close the Package manager window once Barracuda finishes installing.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/package-manager-add-barracuda.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="add-gui" class="level2">
<h2 class="anchored" data-anchor-id="add-gui">Add GUI</h2>
<p>At the moment, we cannot use our OpenVINO plugin inside the Unity editor. There appears to be a dependency conflict between one of the dependencies for OpenVINO and the Unity editor. If we look in the folder where the Unit editor executable is located, we can see that the editor also uses <code>tbb.dll</code>. However, it is a different version than the one required for OpenVINO.</p>
<p>We will need to build our Unity project without the plugin files, and then add them to the build folder where the project executable file is located.</p>
<p>Since we can’t use the performance metrics and controls inside the editor, we will need to add our own.</p>
<p>The user interface will contain the following:</p>
<ul>
<li>Input fields for updating the height and width dimensions for the model input</li>
<li>A dropdown menu for switching between the OpenVINO and Barracuda inference engines</li>
<li>A dropdown menu for switching between style transfer models</li>
<li>A toggle to turn image stylization on and off</li>
<li>A toggle to turn asynchronous GPU readback on and off (more on this later)</li>
<li>A button to exit the application</li>
<li>A console readout for debugging</li>
<li>A frame rate counter to measure performance</li>
</ul>
<p>We will be using the free <a href="https://assetstore.unity.com/packages/tools/gui/graphy-ultimate-fps-counter-stats-monitor-debugger-105778">Graphy</a> asset to display frame rate and other performance metrics. Everything else is already set up in the <a href="https://docs.unity3d.com/Manual/Prefabs.html">prefab</a> linked below.</p>
<ul>
<li><a href="https://drive.google.com/file/d/12ca8Mc2Oi9BhT8m8xbKnOGKev0MQTNzx/view?usp=sharing">Canvas Prefab</a></li>
</ul>
<section id="import-canvas-prefab" class="level3">
<h3 class="anchored" data-anchor-id="import-canvas-prefab">Import Canvas Prefab</h3>
<p>Download the <code>Canvas.prefab</code> file from the above link and drop it into the assets folder in the Unity editor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-add-canvas-prefab.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Drag and drop the prefab from the <code>Assets</code> folder into the <code>Hierarchy</code> tab. A <code>TMP Importer</code> popup window will appear. Click <code>Import TMP Essentials</code>. Close the popup window once the import is complete.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-import-tmp-essentials.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>If we select the <code>Game</code> tab, we can see the interface we just added. Don’t worry if it looks squished.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-view-canvas.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="add-graphy-package" class="level3">
<h3 class="anchored" data-anchor-id="add-graphy-package">Add Graphy Package</h3>
<p>Open the link to the Grapy Unity Store page below and click <code>Add to My Assets</code>. You will need to be signed in to your Unity account.</p>
<ul>
<li>Graphy Asset Store Page: (<a href="https://assetstore.unity.com/packages/tools/gui/graphy-ultimate-fps-counter-stats-monitor-debugger-105778">link</a>)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-store-add-graphy.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Back in Unity, open the Package Manager again and select the <code>Packages: In Project</code> dropdown. Switch the selection to <code>My Assets</code>. You will need to be signed in to view your assets.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/package-manager-open-my-assets.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Type <code>Graphy</code> into the search bar and click download.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/package-manager-download-graphy.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Click <code>Import</code> once the package finished downloading. An <code>Import Unity Package</code> popup window will appear.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/package-manager-import-graphy.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Click <code>Import</code> in the popup window. Close the Package Manager window once the import is complete. There should now be a new folder called <code>Graphy - Ultimate Stats Monitor</code> in the <code>Assets</code> folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/import-unity-package-graphy.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Inside the new folder, open the <code>Prefab</code> folder and drag the <code>[Graphy]</code> prefab into the Hierarchy tab. You will see that our game scene gets updated.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-assets-graphy-prefab.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>With the <code>[Graphy]</code> object still selected in the Hierarchy tab. Scroll down in the <code>Inspector</code> tab to <code>Graphy Manager (Script)</code> section. Open the <code>Graph modules position</code> dropdown and select <code>TOP_LEFT</code>. Nothing will change in the game view, but the position will be updated when we build the project.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/graphy-set-module-position.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="add-event-system" class="level3">
<h3 class="anchored" data-anchor-id="add-event-system">Add Event System</h3>
<p>We need to add an <a href="https://docs.unity3d.com/Packages/com.unity.ugui@1.0/manual/EventSystem.html"><code>Event System</code></a> so that we can send events to <a href="https://docs.unity3d.com/ScriptReference/GameObject.html">GameObjects</a> and their scripts based on user input. Right click an empty space in the Hierarchy tab. Open the <code>UI</code> submenu and select <code>Event System</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/add-event-system.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="make-a-test-build" class="level3">
<h3 class="anchored" data-anchor-id="make-a-test-build">Make a Test Build</h3>
<p>Before continuing, let’s make a test build to confirm our GUI looks correct. First, press <code>Ctrl+s</code> to save the project.</p>
<p>Open the <code>File</code> menu and select <code>Build Settings...</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-open-build-settings.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Click build in the popup window. You will be prompted to select a folder to store the files generated during the build.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/build-settings-build-project.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Create a new folder in the default location and name it <code>Build</code>. Click select folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/create-build-folder.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Once the build is complete, a File Explorer window will open with the project executable selected. Double-click the executable to run it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/run-project.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>You should get output similar to below. The buttons are not connected to any code just yet, so you will need to press <code>Alt+F4</code> to exit the application.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/test-run-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="create-video-player" class="level2">
<h2 class="anchored" data-anchor-id="create-video-player">Create Video Player</h2>
<p>For this demo we’ll just have a video file play in the background. While this demo can run on older integrated graphics, the frame rate would not be high enough to interact with a game environment. The newer discrete GPUs from Intel would be needed for playable frame rates. Since those are not widely available at the time of writing, we’ll stick with a video.</p>
<section id="import-video-files" class="level3">
<h3 class="anchored" data-anchor-id="import-video-files">Import Video Files</h3>
<p>We’ll be using this video available on <a href="https://www.pexels.com/">Pexels</a>, a free stock photos &amp; videos site. Download the video in <code>Full HD</code> resolution.</p>
<ol type="1">
<li><p><a href="https://www.pexels.com/video/woman-dancing-2873755/">Woman Dancing</a></p>
<p><strong>Note:</strong> Renamed to <code>pexels_woman_dancing</code></p></li>
</ol>
</section>
<section id="create-the-videos-folder" class="level3">
<h3 class="anchored" data-anchor-id="create-the-videos-folder">Create the Videos Folder</h3>
<p>In the <code>Assets</code> window, right-click an empty space, select the <code>Create</code> option, and click <code>Folder</code>. Name the folder <code>Videos</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-create-folder.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Double-click the <code>Videos</code> folder to open it.</p>
</section>
<section id="add-video-files" class="level3">
<h3 class="anchored" data-anchor-id="add-video-files">Add Video Files</h3>
<p>Drag and drop the video file from the file explorer into the <code>Videos</code> folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-add-video-file.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="create-the-screen-gameobject" class="level3">
<h3 class="anchored" data-anchor-id="create-the-screen-gameobject">Create the Screen GameObject</h3>
<p>We need to make a “screen” in Unity to watch the video. We’ll use a <a href="https://docs.unity3d.com/Manual/PrimitiveObjects.html"><code>Quad</code></a> object for the screen. Right click an empty space in the <code>Hierarchy</code> tab, select the <code>3D Object</code> section and click <code>Quad</code>. We can just name it <code>VideoScreen</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-create-quad.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="resize-the-screen" class="level3">
<h3 class="anchored" data-anchor-id="resize-the-screen">Resize the Screen</h3>
<p>With the <code>VideoScreen</code> object selected, we need to adjust the <code>Scale</code> parameter in the <code>Inspector</code> tab. Set the <code>X</code> value to 16 and the <code>Y</code> value to 9. Leave the <code>Z</code> value at 1.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-resize-screen.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="update-screen-material" class="level3">
<h3 class="anchored" data-anchor-id="update-screen-material">Update Screen Material</h3>
<p>Create a new folder in the <code>Assets</code> section named <code>Materials</code>. Inside the Materials folder, right-click an empty space and select <code>Material</code> from the popup menu. We’ll name the new material <code>video</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/create-material.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>With the <code>VideoScreen</code> object selected in the Hierarchy tab, open the <code>Materials</code> dropdown in the <code>Inspector</code> tab. Drag and drop the <code>video</code> material into the <code>Element 0</code> slot.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/videoscreen-open-material-dropdown.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>With the <code>VideoScreen</code> object still selected, scroll down to the bottom of the Inspector tab and open the <code>Shader</code> dropdown menu. Select the <code>Unlit</code> option.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/videoscreen-shader-menu.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Select <code>Texture</code> from the submenu. The video screen should now be white.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/videoscreen-shader-menu-unlit-texture.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="create-the-video-player" class="level3">
<h3 class="anchored" data-anchor-id="create-the-video-player">Create the Video Player</h3>
<p>In the <code>Hierarchy</code> tab, right-click an empty area, select the <code>Video</code> section, and click <code>Video Player</code>. This will create a new <code>GameObject</code> called <code>Video Player</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-create-video-player.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="set-video-clip" class="level3">
<h3 class="anchored" data-anchor-id="set-video-clip">Set Video Clip</h3>
<p>Select the <code>Video Player</code> object in the <code>Hierarchy</code> tab. Then, drag and drop the <code>pexels_woman_dancing</code> file into the <code>Video Clip</code> parameter in the <code>Inspector</code> tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-assign-video.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="make-the-video-loop" class="level3">
<h3 class="anchored" data-anchor-id="make-the-video-loop">Make the Video Loop</h3>
<p>Tick the <code>Loop</code> checkbox in the <code>Inspector</code> tab to make the video repeat when the project is running.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-loop-video.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="set-render-mode" class="level3">
<h3 class="anchored" data-anchor-id="set-render-mode">Set Render Mode</h3>
<p>Open the <code>Render Mode</code> dropdown and <code>Material Override</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/video-player-set-render-mode.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="specify-renderer" class="level3">
<h3 class="anchored" data-anchor-id="specify-renderer">Specify Renderer</h3>
<p>With the <code>Video Player</code> object still selected, drag and drop the <code>VideoScreen</code> object from the Hierarchy tab into the <code>Render</code> slot in the Inspector tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/video-player-set-renderer.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="adjust-the-camera" class="level3">
<h3 class="anchored" data-anchor-id="adjust-the-camera">Adjust the Camera</h3>
<p>Before playing the video, we need to reposition and resize the <code>Main Camera</code> object.</p>
<p>Select the <code>Main Camera</code> object in the <code>Hierarchy</code> tab. Set the <code>Y</code> value for the <code>Position</code> to <code>Y</code> and the <code>Z</code> value for the <code>Position</code> to <code>-9</code>.</p>
<p>Finally, we need to set the Projection setting to <code>Orthographic</code> and adjust the Size parameter to <code>4.5</code> in the <code>Inspector</code> tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-resize-camera.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="set-up-style-transfer-code" class="level2">
<h2 class="anchored" data-anchor-id="set-up-style-transfer-code">Set Up Style Transfer Code</h2>
<p>Now, we can implement the code for using both the Barracuda and OpenVINO inference engines.</p>
<section id="create-style-transfer-folder" class="level3">
<h3 class="anchored" data-anchor-id="create-style-transfer-folder">Create Style Transfer Folder</h3>
<p>We’ll place all our additions to the project in a new asset folder called <code>Style_Transfer</code>. This will help keep things organized.</p>
</section>
<section id="import-onnx-files-to-assets" class="level3">
<h3 class="anchored" data-anchor-id="import-onnx-files-to-assets">Import ONNX Files to Assets</h3>
<p>Next, we need to import the original ONN file that we used earlier. This will be used by the Barracuda inference engine. Open the <code>Style_Transfer</code> folder and make a new folder called <code>Models</code>.</p>
<p>Drag and drop the ONNX file into the <code>Models</code> folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/import-onnx-file-asset.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="styletransfershader-compute-shader" class="level3">
<h3 class="anchored" data-anchor-id="styletransfershader-compute-shader">StyleTransferShader Compute Shader</h3>
<p>We can perform both the preprocessing and postprocessing operations for the Barracuda model on the GPU since both the input and output are images. We’ll implement these steps in a <a href="https://docs.unity3d.com/Manual/class-ComputeShader.html">compute shader</a>.</p>
<section id="create-the-asset-file" class="level4">
<h4 class="anchored" data-anchor-id="create-the-asset-file">Create the Asset File</h4>
<p>Open the <code>Style_Transfer</code> folder and create a new folder called <code>Shaders</code>. Enter the <code>Shaders</code> folder and right-click an empty space. Select <code>Shader</code> in the <code>Create</code> submenu and click <code>Compute Shader</code>. We’ll name it <code>StyleTransferShader</code>.</p>
<p><code>image here</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-compute-shader.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="remove-the-default-code" class="level4">
<h4 class="anchored" data-anchor-id="remove-the-default-code">Remove the Default Code</h4>
<p>Open the <code>StyleTransferShader</code> in your code editor. By default, the <code>ComputeShader</code> will contain the following.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Each #kernel tells which function to compile; you can have many kernels</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>#pragma kernel CSMain</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a RenderTexture with enableRandomWrite flag and set it</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">// with cs.SetTexture</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>RWTexture2D<span class="op">&lt;</span>float4<span class="op">&gt;</span> Result<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">8</span><span class="op">,</span><span class="dv">8</span><span class="op">,</span><span class="dv">1</span><span class="op">)]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">CSMain</span> <span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: insert actual code here!</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">float4</span><span class="op">(</span>id<span class="op">.</span><span class="fu">x</span> <span class="op">&amp;</span> id<span class="op">.</span><span class="fu">y</span><span class="op">,</span> <span class="op">(</span>id<span class="op">.</span><span class="fu">x</span> <span class="op">&amp;</span> <span class="dv">15</span><span class="op">)/</span><span class="fl">15.0</span><span class="op">,</span> <span class="op">(</span>id<span class="op">.</span><span class="fu">y</span> <span class="op">&amp;</span> <span class="dv">15</span><span class="op">)/</span><span class="fl">15.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Delete the <code>CSMain</code> function along with the <code>#pragma kernel CSMain</code>. Next, we need to add a <code>Texture2D</code> variable to store the input image. Name it <code>InputImage</code> and give it a data type of <code>&lt;half4&gt;</code>. Use the same data type for the <code>Result</code> variable as well.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a RenderTexture with enableRandomWrite flag and set it</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">// with cs.SetTexture</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>RWTexture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> Result<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the input image and is set with cs.SetTexture</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> InputImage<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-processinput-function" class="level4">
<h4 class="anchored" data-anchor-id="create-processinput-function">Create <code>ProcessInput</code> Function</h4>
<p>The style transfer models expect RGB channel values to be in the range <code>[0, 255]</code>. Color values in Unity are in the range <code>[0,1]</code>. Therefore, we need to scale the three channel values for the <code>InputImage</code> by <code>255</code>. We’ll perform this step in a new function called <code>ProcessInput</code> as shown below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Each #kernel tells which function to compile; you can have many kernels</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessInput</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a RenderTexture with enableRandomWrite flag and set it</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">// with cs.SetTexture</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>RWTexture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> Result<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the input image and is set with cs.SetTexture</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> InputImage<span class="op">;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">ProcessInput</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">half4</span><span class="op">((</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">y</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">z</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span> <span class="fl">1.0</span>h<span class="op">);</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-processoutput-function" class="level4">
<h4 class="anchored" data-anchor-id="create-processoutput-function">Create <code>ProcessOutput</code> Function</h4>
<p>As we did in the DLL, we need to clamp the model output values to the range <code>[0, 255]</code>. We can use the built-in <a href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-clamp"><code>clamp()</code></a> method to make sure all values are in the correct range. We’ll then scale the values back down to <code>[0, 1]</code> for Unity. We’ll perform these steps in a new function called <code>ProcessOutput</code> as shown below.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Each #kernel tells which function to compile; you can have many kernels</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessInput</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessOutput</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a RenderTexture with enableRandomWrite flag and set it</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">// with cs.SetTexture</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>RWTexture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> Result<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the input image and is set with cs.SetTexture</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> InputImage<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">ProcessInput</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">half4</span><span class="op">((</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">y</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">z</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span> <span class="fl">1.0</span>h<span class="op">);</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">ProcessOutput</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">half4</span><span class="op">((</span><span class="fu">clamp</span><span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span><span class="op">,</span> <span class="fl">0.0</span>h<span class="op">,</span> <span class="fl">255.0</span>h<span class="op">)</span> <span class="op">/</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span><span class="fu">clamp</span><span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">y</span><span class="op">,</span> <span class="fl">0.0f</span><span class="op">,</span> <span class="fl">255.0</span>h<span class="op">)</span> <span class="op">/</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span><span class="fu">clamp</span><span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">z</span><span class="op">,</span> <span class="fl">0.0f</span><span class="op">,</span> <span class="fl">255.0</span>h<span class="op">)</span> <span class="op">/</span> <span class="fl">255.0</span>h<span class="op">),</span> <span class="fl">1.0</span>h<span class="op">);</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-flipxaxis-function" class="level4">
<h4 class="anchored" data-anchor-id="create-flipxaxis-function">Create <code>FlipXAxis()</code> Function</h4>
<p>The pixel data from Unity gets flipped when loaded into the <code>cv::Mat texture</code> variable in the DLL. We will need to flip the image before sending it to the plugin so that it will be in the correct orientation for the model. We will need to flip the image again when we receive the update pixel data back from the DLL.</p>
<p>We need to know the height and width of the image to swap the pixel values. We’ll store these values in <code>int</code> variables. We’ll store the new <code>(x,y)</code> coordinates for individual pixel values in an <code>int2</code> variable.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Each #kernel tells which function to compile; you can have many kernels</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessInput</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>#pragma kernel ProcessOutput</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>#pragma kernel FlipXAxis</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a RenderTexture with enableRandomWrite flag and set it</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">// with cs.SetTexture</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>RWTexture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> Result<span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the input image and is set with cs.SetTexture</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> InputImage<span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">ProcessInput</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">half4</span><span class="op">((</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">y</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">z</span> <span class="op">*</span> <span class="fl">255.0</span>h<span class="op">),</span> <span class="fl">1.0</span>h<span class="op">);</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">ProcessOutput</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">half4</span><span class="op">((</span><span class="fu">clamp</span><span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">x</span><span class="op">,</span> <span class="fl">0.0</span>h<span class="op">,</span> <span class="fl">255.0</span>h<span class="op">)</span> <span class="op">/</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span><span class="fu">clamp</span><span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">y</span><span class="op">,</span> <span class="fl">0.0f</span><span class="op">,</span> <span class="fl">255.0</span>h<span class="op">)</span> <span class="op">/</span> <span class="fl">255.0</span>h<span class="op">),</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span><span class="fu">clamp</span><span class="op">(</span>InputImage<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">].</span><span class="fu">z</span><span class="op">,</span> <span class="fl">0.0f</span><span class="op">,</span> <span class="fl">255.0</span>h<span class="op">)</span> <span class="op">/</span> <span class="fl">255.0</span>h<span class="op">),</span> <span class="fl">1.0</span>h<span class="op">);</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">// The height of the input image</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> height<span class="op">;</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">// The width of the input image</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> width<span class="op">;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the new location for individual pixel values</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>int2 coords<span class="op">;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">FlipXAxis</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the y value for the pixel coordinates</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> <span class="fu">int2</span><span class="op">(</span>id<span class="op">.</span><span class="fu">x</span><span class="op">,</span> height <span class="op">-</span> id<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">float4</span><span class="op">(</span>InputImage<span class="op">[</span>coords<span class="op">].</span><span class="fu">x</span><span class="op">,</span> InputImage<span class="op">[</span>coords<span class="op">].</span><span class="fu">y</span><span class="op">,</span> InputImage<span class="op">[</span>coords<span class="op">].</span><span class="fu">z</span><span class="op">,</span> <span class="fl">1.0f</span><span class="op">);</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-styletransfer-script" class="level3">
<h3 class="anchored" data-anchor-id="create-styletransfer-script">Create <code>StyleTransfer</code> Script</h3>
<p>We need to make a new <code>C#</code> script to perform inference with the style transfer model. This script will load the model, process the input, run the model, and process the output.</p>
<section id="create-the-asset-file-1" class="level4">
<h4 class="anchored" data-anchor-id="create-the-asset-file-1">Create the Asset File</h4>
<p>Open the <code>Style_Transfer</code> folder and create a new folder called <code>Scripts</code>. In the <code>Scripts</code> folder, right-click an empty space and select <code>C# Script</code> in the <code>Create</code> submenu. Name the script <code>StyleTransfer</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-csharp-script.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="add-required-namespaces" class="level4">
<h4 class="anchored" data-anchor-id="add-required-namespaces">Add Required Namespaces</h4>
<p>We will start by adding the required namespaces at the top of the script.</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system?view=net-5.0"><code>System</code></a>: Contains fundamental classes and base classes that define commonly-used value and reference data types, events and event handlers, interfaces, attributes, and processing exceptions.</li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices?view=net-5.0"><code>System.Runtime.InteropServices</code></a>: Provides a wide variety of members that support COM interop and platform invoke services.</li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.ugui@1.0/api/UnityEngine.UI.html"><code>UnityEngine.UI</code></a>: Provides access to UI elements.</li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/api/Unity.Barracuda.html"><code>Unity.Barracuda</code></a>: Provides access to the Barracuda library API.</li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.core@5.9/api/UnityEngine.Rendering.html"><code>UnityEngine.Rendering</code></a>: Provides access to the elements of the rendering pipeline.</li>
</ul>
<section id="code" class="level5">
<h5 class="anchored" data-anchor-id="code">Code</h5>
<div class="sourceCode" id="cb6"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Runtime</span><span class="op">.</span><span class="fu">InteropServices</span><span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">.</span><span class="fu">UI</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Unity<span class="op">.</span><span class="fu">Barracuda</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">.</span><span class="fu">Rendering</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="add-public-variables" class="level4">
<h4 class="anchored" data-anchor-id="add-public-variables">Add Public Variables</h4>
<p>Next, we add the publicly accessible variables inside the <code>StyleTransfer</code> class.</p>
<p>We need to add a <code>ComputeShader</code> variable so that we can access the <code>StyleTransferShader</code> we made earlier.</p>
<p>There are several parts of the user interface that we will need to access inside the script.</p>
<ul>
<li>inference engine dropdown</li>
<li>compute device dropdown</li>
<li>model dropdown</li>
<li>stylize toggle</li>
<li>useAsync toggle</li>
<li>input resolution fields</li>
<li>console readout text</li>
</ul>
<p>The last public variables will be a list of <a href="https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/api/Unity.Barracuda.NNModel.html"><code>NNmodel</code></a> variables to store the ONNX models for the Barracuda engine and a <a href="https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/api/Unity.Barracuda.WorkerFactory.Type.html"><code>WorkerFactory.Type</code></a> variable to specify the <a href="https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/manual/Worker.html">backend</a> for the Barracuda engine.</p>
<section id="code-1" class="level5">
<h5 class="anchored" data-anchor-id="code-1">Code</h5>
<div class="sourceCode" id="cb7"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StyleTransfer <span class="op">:</span> MonoBehaviour</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Performs the preprocessing and postprocessing steps"</span><span class="op">)]</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> ComputeShader styleTransferShader<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Toggle between OpenVINO and Barracuda"</span><span class="op">)]</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> TMPro<span class="op">.</span><span class="fu">TMP_Dropdown</span> inferenceEngineDropdown<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Switch between the available compute devices for OpenVINO"</span><span class="op">)]</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> TMPro<span class="op">.</span><span class="fu">TMP_Dropdown</span> deviceDropdown<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Switch between the available OpenVINO models"</span><span class="op">)]</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> TMPro<span class="op">.</span><span class="fu">TMP_Dropdown</span> modelDropdown<span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Turn stylization on and off"</span><span class="op">)]</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Toggle stylize<span class="op">;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Turn AsyncGPUReadback on and off"</span><span class="op">)]</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Toggle useAsync<span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Text box for the input width"</span><span class="op">)]</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> TMPro<span class="op">.</span><span class="fu">TMP_InputField</span> widthText<span class="op">;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Text box for the input height"</span><span class="op">)]</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> TMPro<span class="op">.</span><span class="fu">TMP_InputField</span> heightText<span class="op">;</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Text area to display console output"</span><span class="op">)]</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Text consoleText<span class="op">;</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The model asset file that will be used when performing inference"</span><span class="op">)]</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> NNModel<span class="op">[]</span> modelAssets<span class="op">;</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The backend used when performing inference"</span><span class="op">)]</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> WorkerFactory<span class="op">.</span><span class="fu">Type</span> workerType <span class="op">=</span> WorkerFactory<span class="op">.</span><span class="fu">Type</span><span class="op">.</span><span class="fu">Auto</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-dll-method-declarations" class="level4">
<h4 class="anchored" data-anchor-id="create-dll-method-declarations">Create DLL Method Declarations</h4>
<p>We need to specify the name of the <code>.dll</code> file. We’ll store this in a <code>const string</code> variable called <code>dll</code>.</p>
<p>We can indicate that a given method is from a DLL by using the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.dllimportattribute?view=net-5.0"><code>DllImport</code></a> attribute.</p>
<p><strong>Note:</strong> The DLL functions that return string values have <a href="https://docs.microsoft.com/en-us/dotnet/api/system.intptr?view=net-5.0"><code>IntPtr</code></a> as their return values here. We will use the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.marshal.ptrtostringansi?view=net-5.0"><code>Marshal.PtrToStringAnsi()</code></a> method to get that string value at the memory location stored in the pointer.</p>
<p>We will be accessing the following methods from the DLL:</p>
<ul>
<li><code>GetAvailableDevices</code></li>
<li><code>InitializeOpenVINO</code></li>
<li><code>SetInputDims</code></li>
<li><code>PrepareBlobs</code></li>
<li><code>UploadModelToDevice</code></li>
<li><code>PerformInference</code></li>
</ul>
<section id="code-2" class="level5">
<h5 class="anchored" data-anchor-id="code-2">Code</h5>
<div class="sourceCode" id="cb8"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Name of the DLL file</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">string</span> dll <span class="op">=</span> <span class="st">"OpenVINO_Plugin"</span><span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> IntPtr <span class="fu">GetAvailableDevices</span><span class="op">();</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">InitializeOpenVINO</span><span class="op">(</span><span class="dt">string</span> modelPath<span class="op">);</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">bool</span> <span class="fu">SetInputDims</span><span class="op">(</span><span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">);</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">PrepareBlobs</span><span class="op">();</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> IntPtr <span class="fu">UploadModelToDevice</span><span class="op">(</span><span class="dt">int</span> deviceNum <span class="op">=</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">PerformInference</span><span class="op">(</span>IntPtr inputData<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="add-private-variables" class="level4">
<h4 class="anchored" data-anchor-id="add-private-variables">Add Private Variables</h4>
<p>Lastly, we will add the variables that do not need to be publicly accessible.</p>
<p>The models in the <code>modelAssets</code> variable will need to be compiled into runtime models to perform inference with them. We’ll store the compiled models in a new list of <a href="https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/api/Unity.Barracuda.Model.html"><code>Model</code></a> variables called <code>m_RuntimeModels</code>.</p>
<p>We will create a separate inference engine interface for each of the Barracuda models. These will be stored in a list of <a href="https://docs.unity3d.com/Packages/com.unity.barracuda@1.0/api/Unity.Barracuda.IWorker.html"><code>IWorker</code></a> variables called engines.</p>
<p>We will need to resize and flip the input image in Unity before sending it to the OpenVINO plugin. We’ll perform these operations using a temporary <a href="https://docs.unity3d.com/ScriptReference/RenderTexture.html"><code>RenderTexture</code></a> variable called <code>tempTex</code>.</p>
<p>For this tutorial, the pixel data currently needs to be downloaded from the GPU to the CPU before sending it to the plugin as well. We’ll read the pixel data from <code>tempTex</code> to a <a href="https://docs.unity3d.com/ScriptReference/Texture2D.html"><code>Texture2D</code></a> variable called <code>inputTex</code>.</p>
<p>We will store the raw pixel data from <code>inputTex</code> in a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.byte?view=net-5.0"><code>byte[]</code></a> variable called <code>inputData</code>. We will be passing a pointer to this array as input to the <code>PerformInference()</code> method.</p>
<p>Next , we will create two <code>int</code> variables to store the current width and height values for the input dimensions. We’ll give the width a default value of <code>960</code> and height a default value of <code>540</code>.</p>
<p>We also need two <a href="https://docs.microsoft.com/en-us/dotnet/api/system.string?view=net-5.0"><code>string</code></a> variables to store the unparsed list of available devices for OpenVINO and the current device being used.</p>
<p>Finally, we need four <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1?view=net-5.0"><code>List&lt;string&gt;</code></a> variables to store the parsed list of available devices, the file paths for the OpenVINO models, the names of the OpenVINO models, and the names of the ONNX models.</p>
<section id="code-3" class="level5">
<h5 class="anchored" data-anchor-id="code-3">Code</h5>
<div class="sourceCode" id="cb9"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The compiled model used for performing inference</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Model<span class="op">[]</span> m_RuntimeModels<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The interface used to execute the neural network</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> IWorker<span class="op">[]</span> engines<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Contains the resized input texture</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> RenderTexture tempTex<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Contains the input texture that will be sent to the OpenVINO inference engine</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Texture2D inputTex<span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stores the raw pixel data for inputTex</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">byte</span><span class="op">[]</span> inputData<span class="op">;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Input image width</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> width <span class="op">=</span> <span class="dv">960</span><span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Input image height</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> height <span class="op">=</span> <span class="dv">540</span><span class="op">;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Unparsed list of available compute devices for OpenVINO</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">string</span> openvinoDevices<span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Current compute device for OpenVINO</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">string</span> currentDevice<span class="op">;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Parsed list of compute devices for OpenVINO</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> deviceList <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// File paths for the OpenVINO IR models</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> openVINOPaths <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Names of the OpenVINO IR model</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> openvinoModels <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Names of the ONNX models</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> onnxModels <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="define-start-method" class="level4">
<h4 class="anchored" data-anchor-id="define-start-method">Define <code>Start()</code> Method</h4>
<p>Here we will perform all the set up steps needed to initialize the user interface, OpenVINO plugin, and Barracuda inference engine.</p>
<p><strong>Note:</strong> We are assuming that the OpenVINO models are stored in the same directory as the application executable, in a folder named <code>models</code>.</p>
</section>
<section id="method-steps" class="level4">
<h4 class="anchored" data-anchor-id="method-steps">Method Steps</h4>
<ol type="1">
<li>Get the name of the CPU and GPU</li>
<li>Create a list of the available OpenVINO IR models</li>
<li>Update model dropdown menu with list of OpenVINO models</li>
<li>Clear list of available compute devices</li>
<li>Check if either the CPU or GPU is made by Intel
<ol type="1">
<li>if true, initialize OpenVINO and update the list of compute devices</li>
<li>if false, use the Barracuda inference engine</li>
</ol></li>
<li>Initialize the <code>tempTex</code> and <code>inputTex</code> variables with the default resolution</li>
<li>Initialize the <code>m_RuntimeModels</code> variable</li>
<li>Initialize the <code>engines</code> variable</li>
<li>Compile the models in the <code>modelAssets</code> variable and initialize the inference engines for each.</li>
</ol>
<section id="code-4" class="level5">
<h5 class="anchored" data-anchor-id="code-4">Code</h5>
<div class="sourceCode" id="cb10"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start is called before the first frame update</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> processorType <span class="op">=</span> SystemInfo<span class="op">.</span><span class="fu">processorType</span><span class="op">.</span><span class="fu">ToString</span><span class="op">();</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Processor Type: {processorType}"</span><span class="op">);</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> graphicsDeviceName <span class="op">=</span> SystemInfo<span class="op">.</span><span class="fu">graphicsDeviceName</span><span class="op">.</span><span class="fu">ToString</span><span class="op">();</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Graphics Device Name: {graphicsDeviceName}"</span><span class="op">);</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span><span class="op">[]</span> openVINOFiles <span class="op">=</span> System<span class="op">.</span><span class="fu">IO</span><span class="op">.</span><span class="fu">Directory</span><span class="op">.</span><span class="fu">GetFiles</span><span class="op">(</span><span class="st">"models"</span><span class="op">);</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Available OpenVINO Models"</span><span class="op">);</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> file <span class="kw">in</span> openVINOFiles<span class="op">)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>file<span class="op">.</span><span class="fu">EndsWith</span><span class="op">(</span><span class="st">".xml"</span><span class="op">))</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>file<span class="op">);</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                openVINOPaths<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>file<span class="op">);</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                <span class="dt">string</span> modelName <span class="op">=</span> file<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="ch">'\\'</span><span class="op">)[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                openvinoModels<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>modelName<span class="op">.</span><span class="fu">Substring</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> modelName<span class="op">.</span><span class="fu">Length</span><span class="dv">-4</span><span class="op">));</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Remove default dropdown options</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        modelDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Add OpenVINO models to menu</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        modelDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>openvinoModels<span class="op">);</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Select the first option in the dropdown</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        modelDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Remove default dropdown options</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        deviceDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if either the CPU of GPU is made by Intel</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>processorType<span class="op">.</span><span class="fu">Contains</span><span class="op">(</span><span class="st">"Intel"</span><span class="op">)</span> <span class="op">||</span> graphicsDeviceName<span class="op">.</span><span class="fu">Contains</span><span class="op">(</span><span class="st">"Intel"</span><span class="op">))</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Initializing OpenVINO"</span><span class="op">);</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">InitializeOpenVINO</span><span class="op">(</span>openVINOPaths<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Setting Input Dims to W: {width} x H: {height}"</span><span class="op">);</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">SetInputDims</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">);</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Uploading IR Model to Compute Device"</span><span class="op">);</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>            currentDevice <span class="op">=</span> Marshal<span class="op">.</span><span class="fu">PtrToStringAnsi</span><span class="op">(</span><span class="fu">UploadModelToDevice</span><span class="op">());</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"OpenVINO using: {currentDevice}"</span><span class="op">);</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Get an unparsed list of available </span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>            openvinoDevices <span class="op">=</span> Marshal<span class="op">.</span><span class="fu">PtrToStringAnsi</span><span class="op">(</span><span class="fu">GetAvailableDevices</span><span class="op">());</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Available Devices:"</span><span class="op">);</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Parse list of available compute devices</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> device <span class="kw">in</span> openvinoDevices<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="ch">','</span><span class="op">))</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Add device name to list</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>                deviceList<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>device<span class="op">);</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>device<span class="op">);</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Add OpenVINO compute devices to dropdown</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>            deviceDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>deviceList<span class="op">);</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Set the value for the dropdown to the current compute device</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>            deviceDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span>deviceList<span class="op">.</span><span class="fu">IndexOf</span><span class="op">(</span>currentDevice<span class="op">));</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Use Barracuda inference engine if not on Intel hardware</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>            inferenceEngineDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialize textures with default input resolution</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>        tempTex <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">ARGB32</span><span class="op">);</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>        inputTex <span class="op">=</span> <span class="kw">new</span> <span class="fu">Texture2D</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> TextureFormat<span class="op">.</span><span class="fu">RGBA32</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialize list of Barracuda models</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>        m_RuntimeModels <span class="op">=</span> <span class="kw">new</span> Model<span class="op">[</span>modelAssets<span class="op">.</span><span class="fu">Length</span><span class="op">];</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialize list of Barracuda inference engines</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>        engines <span class="op">=</span> <span class="kw">new</span> IWorker<span class="op">[</span>modelAssets<span class="op">.</span><span class="fu">Length</span><span class="op">];</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> modelAssets<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Add names of available ONNX models to list</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>            onnxModels<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>modelAssets<span class="op">[</span>i<span class="op">].</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"ModelAsset Name: {modelAssets[i].name}"</span><span class="op">);</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Compile the model asset into an object oriented representation</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>            m_RuntimeModels<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> ModelLoader<span class="op">.</span><span class="fu">Load</span><span class="op">(</span>modelAssets<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Create a worker that will execute the model with the selected backend</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>            engines<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> WorkerFactory<span class="op">.</span><span class="fu">CreateWorker</span><span class="op">(</span>workerType<span class="op">,</span> m_RuntimeModels<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-processimage-method" class="level4">
<h4 class="anchored" data-anchor-id="create-processimage-method">Create <code>ProcessImage()</code> Method</h4>
<p>Next, we’ll make a new method to execute the <code>ProcessInput()</code>, <code>ProcessOutput()</code> and <code>FlipXAxis()</code> functions in our <code>ComputeShader</code>. This method will take in the image that needs to be processed as well as a function name to indicate which function we want to execute. We’ll need to store the processed images in textures with HDR formats. This will allow us to use color values outside the default range of <code>[0, 1]</code>. As mentioned previously, the model expects values in the range of <code>[0, 255]</code>.</p>
<section id="method-steps-1" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-1">Method Steps</h5>
<ol type="1">
<li>Get the <code>ComputeShader</code> index for the specified function</li>
<li>Create a temporary <code>RenderTexture</code> with random write access enabled to store the processed image</li>
<li>Execute the <code>ComputeShader</code></li>
<li>Copy the processed image back into the original <code>RenderTexture</code></li>
<li>Release the temporary <code>RenderTexture</code></li>
</ol>
</section>
<section id="code-5" class="level5">
<h5 class="anchored" data-anchor-id="code-5">Code</h5>
<div class="sourceCode" id="cb11"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Process the provided image using the specified function on the GPU</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"image"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"functionName"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The processed image</span><span class="kw">&lt;/returns&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">ProcessImage</span><span class="op">(</span>RenderTexture image<span class="op">,</span> <span class="dt">string</span> functionName<span class="op">)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Specify the number of threads on the GPU</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> numthreads <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the index for the specified function in the ComputeShader</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> kernelHandle <span class="op">=</span> styleTransferShader<span class="op">.</span><span class="fu">FindKernel</span><span class="op">(</span>functionName<span class="op">);</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Define a temporary HDR RenderTexture</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        RenderTexture result <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>image<span class="op">.</span><span class="fu">width</span><span class="op">,</span> image<span class="op">.</span><span class="fu">height</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">ARGBHalf</span><span class="op">);</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Enable random write access</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        result<span class="op">.</span><span class="fu">enableRandomWrite</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Create the HDR RenderTexture</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        result<span class="op">.</span><span class="fu">Create</span><span class="op">();</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set the value for the Result variable in the ComputeShader</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        styleTransferShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"Result"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set the value for the InputImage variable in the ComputeShader</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        styleTransferShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"InputImage"</span><span class="op">,</span> image<span class="op">);</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set the value for the height variable in the ComputeShader</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        styleTransferShader<span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"height"</span><span class="op">,</span> image<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set the value for the width variable in the ComputeShader</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        styleTransferShader<span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"width"</span><span class="op">,</span> image<span class="op">.</span><span class="fu">width</span><span class="op">);</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Execute the ComputeShader</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        styleTransferShader<span class="op">.</span><span class="fu">Dispatch</span><span class="op">(</span>kernelHandle<span class="op">,</span> result<span class="op">.</span><span class="fu">width</span> <span class="op">/</span> numthreads<span class="op">,</span> result<span class="op">.</span><span class="fu">height</span> <span class="op">/</span> numthreads<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Copy the result into the source RenderTexture</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>result<span class="op">,</span> image<span class="op">);</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Release the temporary RenderTexture</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>        RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>result<span class="op">);</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-stylizeimage-method" class="level4">
<h4 class="anchored" data-anchor-id="create-stylizeimage-method">Create <code>StylizeImage()</code> Method</h4>
<p>We’ll create a new method to handle stylizing individual frames from the camera with the Barracuda engine. This method will take in the <code>src</code> <code>RenderTexture</code> from the game camera and copy the stylized image back into that same <code>RenderTexture</code>.</p>
<section id="method-steps-2" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-2">Method Steps:</h5>
<ol type="1">
<li><p>Resize the camera input to the <code>targetHeight</code></p>
<p>If the height of <code>src</code> is larger than the <code>targetHeight</code>, we’ll calculate the new dimensions to downscale the camera input. We’ll then adjust the new dimensions to be multiples of 8. This is to make sure we don’t lose parts of the image after applying the processing steps with the <code>Compute shader</code>.</p></li>
<li><p>Apply preprocessing steps to the image</p>
<p>We’ll call the <code>ProcessImage()</code> method and pass <code>rTex</code> along with the name for the <code>ProcessInput()</code> function in the <code>ComputeShader</code>. The result will be stored in <code>rTex</code>.</p></li>
<li><p>Execute the model</p>
<p>We’ll use the <code>engine.Execute()</code> method to run the model with the current <code>input</code>. We can store the raw output from the model in a new <code>Tensor</code>.</p></li>
<li><p>Apply the postprocessing steps to the model output</p>
<p>We’ll call the <code>ProcessImage()</code> method and pass <code>rTex</code> along with the name for the <code>ProcessOutput()</code> function in the <code>ComputeShader</code>. The result will be stored in <code>rTex</code>.</p></li>
<li><p>Copy the stylized image to the <code>src</code> <code>RenderTexture</code></p>
<p>We’ll use the <code>Graphics.Blit()</code> method to copy the final stylized image into the <code>src</code> <code>RenderTexture</code>.</p></li>
<li><p>Release the temporary <code>RenderTexture</code></p>
<p>Finally, we’ll release the temporary <code>RenderTexture</code>.</p></li>
</ol>
</section>
<section id="code-6" class="level5">
<h5 class="anchored" data-anchor-id="code-6">Code</h5>
<div class="sourceCode" id="cb12"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Stylize the provided image</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"src"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;returns&gt;&lt;/returns&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">StylizeImage</span><span class="op">(</span>RenderTexture src<span class="op">)</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Create a new RenderTexture variable</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        RenderTexture rTex<span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if the target display is larger than the height</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// and make sure the height is at least 4</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>src<span class="op">.</span><span class="fu">height</span> <span class="op">&gt;</span> height <span class="op">&amp;&amp;</span> height <span class="op">&gt;=</span> <span class="dv">4</span><span class="op">)</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Adjust the target image dimensions to be multiples of 4</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> targetHeight <span class="op">=</span> height <span class="op">-</span> <span class="op">(</span>height <span class="op">%</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> targetWidth <span class="op">=</span> width <span class="op">-</span> <span class="op">(</span>width <span class="op">%</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Assign a temporary RenderTexture with the new dimensions</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            rTex <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>targetWidth<span class="op">,</span> targetHeight<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> src<span class="op">.</span><span class="fu">format</span><span class="op">);</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Assign a temporary RenderTexture with the src dimensions</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>            rTex <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>src<span class="op">.</span><span class="fu">width</span><span class="op">,</span> src<span class="op">.</span><span class="fu">height</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> src<span class="op">.</span><span class="fu">format</span><span class="op">);</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Copy the src RenderTexture to the new rTex RenderTexture</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>src<span class="op">,</span> rTex<span class="op">);</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Apply preprocessing steps</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ProcessImage</span><span class="op">(</span>rTex<span class="op">,</span> <span class="st">"ProcessInput"</span><span class="op">);</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Create a Tensor of shape [1, rTex.height, rTex.width, 3]</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        Tensor input <span class="op">=</span> <span class="kw">new</span> <span class="fu">Tensor</span><span class="op">(</span>rTex<span class="op">,</span> channels<span class="op">:</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Execute neural network with the provided input</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">//engine.Execute(input);</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        engines<span class="op">[</span>modelDropdown<span class="op">.</span><span class="fu">value</span><span class="op">].</span><span class="fu">Execute</span><span class="op">(</span>input<span class="op">);</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the raw model output</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>        Tensor prediction <span class="op">=</span> engines<span class="op">[</span>modelDropdown<span class="op">.</span><span class="fu">value</span><span class="op">].</span><span class="fu">PeekOutput</span><span class="op">();</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Release GPU resources allocated for the Tensor</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        input<span class="op">.</span><span class="fu">Dispose</span><span class="op">();</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Make sure rTex is not the active RenderTexture</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>        RenderTexture<span class="op">.</span><span class="fu">active</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Copy the model output to rTex</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>        prediction<span class="op">.</span><span class="fu">ToRenderTexture</span><span class="op">(</span>rTex<span class="op">);</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Release GPU resources allocated for the Tensor</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>        prediction<span class="op">.</span><span class="fu">Dispose</span><span class="op">();</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Apply post processing steps</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ProcessImage</span><span class="op">(</span>rTex<span class="op">,</span> <span class="st">"ProcessOutput"</span><span class="op">);</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Copy rTex into src</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>        Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>rTex<span class="op">,</span> src<span class="op">);</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Release the temporary RenderTexture</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>        RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>rTex<span class="op">);</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-setinferenceengine-method" class="level4">
<h4 class="anchored" data-anchor-id="create-setinferenceengine-method">Create <code>SetInferenceEngine()</code> Method</h4>
<p>This method will be called when a new option is selected from the inference engine dropdown menu.</p>
<section id="method-steps-3" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-3">Method Steps</h5>
<ol type="1">
<li>Create a temporary list of the models for the selected inference engine</li>
<li>Update the model dropdown menu with the temporary list</li>
<li>Check if the model that was last used for the previous inference engine is available for the selected inference engine.</li>
</ol>
</section>
<section id="code-7" class="level5">
<h5 class="anchored" data-anchor-id="code-7">Code</h5>
<div class="sourceCode" id="cb13"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called when an inference engine option is selected from dropdown</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">SetInferenceEngine</span><span class="op">()</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the list of models for the selected inference engine</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> currentList <span class="op">=</span> inferenceEngineDropdown<span class="op">.</span><span class="fu">value</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">?</span> openvinoModels <span class="op">:</span> onnxModels<span class="op">;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Remove current dropdown options</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        modelDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Add current inference engine models to menu</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        modelDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>currentList<span class="op">);</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Select the first option in the dropdown</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        modelDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get index for current model selection</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> index <span class="op">=</span> modelDropdown<span class="op">.</span><span class="fu">value</span><span class="op">;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the name for the previously selected inference engine model</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> previousModel <span class="op">=</span> inferenceEngineDropdown<span class="op">.</span><span class="fu">value</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">?</span> onnxModels<span class="op">[</span>index<span class="op">]</span> <span class="op">:</span> openvinoModels<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if the model for the previous inference engine is available for the current engine</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>currentList<span class="op">.</span><span class="fu">Contains</span><span class="op">(</span>previousModel<span class="op">))</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            modelDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span>openvinoModels<span class="op">.</span><span class="fu">IndexOf</span><span class="op">(</span>previousModel<span class="op">));</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-setdevice-method" class="level4">
<h4 class="anchored" data-anchor-id="create-setdevice-method">Create <code>SetDevice()</code> Method</h4>
<p>This method will be called when a new option is selected from the device dropdown menu.</p>
<section id="method-steps-4" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-4">Method Steps</h5>
<ol type="1">
<li>Call <code>UploadModelToDevice()</code> method and save the returned value to <code>currentDevice</code></li>
</ol>
</section>
<section id="code-8" class="level5">
<h5 class="anchored" data-anchor-id="code-8">Code</h5>
<div class="sourceCode" id="cb14"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called when a compute device is selected from dropdown</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">SetDevice</span><span class="op">()</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Uploading model to device</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        currentDevice <span class="op">=</span> Marshal<span class="op">.</span><span class="fu">PtrToStringAnsi</span><span class="op">(</span><span class="fu">UploadModelToDevice</span><span class="op">(</span>deviceDropdown<span class="op">.</span><span class="fu">value</span><span class="op">));</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updateinputdims-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updateinputdims-method">Create <code>UpdateInputDims()</code> Method</h4>
<p>This method will be called when the input dimensions are updated from the user interface.</p>
<section id="method-steps-5" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-5">Method Steps</h5>
<ol type="1">
<li>Get integer values from user input for the height and width input fields</li>
<li>Update <code>tempTex</code> and <code>inputTex</code> with the new height and width values</li>
<li>Call <code>SetInputDims()</code> method.</li>
<li>Call <code>SetDevice()</code> method</li>
<li>Call <code>PrepareBlobs()</code> method</li>
</ol>
</section>
<section id="code-9" class="level5">
<h5 class="anchored" data-anchor-id="code-9">Code</h5>
<div class="sourceCode" id="cb15"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called when the input resolution is updated</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateInputDims</span><span class="op">()</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the integer value from the width input</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span><span class="op">.</span><span class="fu">TryParse</span><span class="op">(</span>widthText<span class="op">.</span><span class="fu">text</span><span class="op">,</span> <span class="kw">out</span> width<span class="op">);</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the integer value from the height input</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span><span class="op">.</span><span class="fu">TryParse</span><span class="op">(</span>heightText<span class="op">.</span><span class="fu">text</span><span class="op">,</span> <span class="kw">out</span> height<span class="op">);</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update tempTex with the new dimensions</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        tempTex <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">ARGB32</span><span class="op">);</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update inputTex with the new dimensions</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        inputTex <span class="op">=</span> <span class="kw">new</span> <span class="fu">Texture2D</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> TextureFormat<span class="op">.</span><span class="fu">RGBA32</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set input resolution width x height for the OpenVINO model</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Setting Input Dims to W: {width} x H: {height}"</span><span class="op">);</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">SetInputDims</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">);</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">SetDevice</span><span class="op">();</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Preparing Output Blobs</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">PrepareBlobs</span><span class="op">();</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updatemodel-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updatemodel-method">Create <code>UpdateModel()</code> Method</h4>
<p>This method will be called when a new option is selected from the model dropdown menu.</p>
<section id="method-steps-6" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-6">Method Steps</h5>
<ol type="1">
<li>Check if the OpenVINO engine is currently selected
<ol type="1">
<li>Call <code>InitializeOpenVINO()</code> for selected the model.</li>
<li>Call <code>UpdateInputDims()</code> method</li>
</ol></li>
</ol>
</section>
<section id="code-10" class="level5">
<h5 class="anchored" data-anchor-id="code-10">Code</h5>
<div class="sourceCode" id="cb16"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called when a model option is selected from the dropdown</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateModel</span><span class="op">()</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Selected Model: {modelDropdown.value}"</span><span class="op">);</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialize the selected OpenVINO model</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>inferenceEngineDropdown<span class="op">.</span><span class="fu">value</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">InitializeOpenVINO</span><span class="op">(</span>openVINOPaths<span class="op">[</span>modelDropdown<span class="op">.</span><span class="fu">value</span><span class="op">]);</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">UpdateInputDims</span><span class="op">();</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updatetexture-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updatetexture-method">Create <code>UpdateTexture()</code> Method</h4>
<p>This method is where we will send the current pixel data from <code>inputTex</code> to the OpenVINO plugin. We need to use the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/unsafe"><code>unsafe</code></a> keyword since we’ll be creating a pointer to the <code>inputData</code> array. Unity does not allow unsafe code by default, so we will need to enable it in the Project Settings.</p>
<section id="method-steps-7" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-7">Method Steps</h5>
<ol type="1">
<li>Pin the memory for <code>inputData</code> using a <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/fixed-statement"><code>fixed</code></a> statement and get a pointer to the variable</li>
<li>Call the <code>PerformInference()</code> method with the pointer as input</li>
</ol>
</section>
<section id="code-11" class="level5">
<h5 class="anchored" data-anchor-id="code-11">Code</h5>
<div class="sourceCode" id="cb17"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Pin memory for the input data and send it to OpenVINO for inference</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"inputData"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">unsafe</span> <span class="dt">void</span> <span class="fu">UpdateTexture</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> inputData<span class="op">)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Pin Memory</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fixed</span> <span class="op">(</span><span class="dt">byte</span><span class="op">*</span> p <span class="op">=</span> inputData<span class="op">)</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Perform inference with OpenVINO</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">PerformInference</span><span class="op">((</span>IntPtr<span class="op">)</span>p<span class="op">);</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-oncompletereadback-callback" class="level4">
<h4 class="anchored" data-anchor-id="create-oncompletereadback-callback">Create <code>OnCompleteReadback()</code> Callback</h4>
<p>As mentioned earlier, we currently need to download the pixel data for <code>tempTex</code> from the GPU to the CPU. This normally causes a <a href="https://en.wikipedia.org/wiki/Pipeline_stall">pipeline stall</a> as Unity prevents any execution on the main thread to prevent the data from changing before it has finished downloading to the CPU. This can cause a noticeable performance bottleneck that increases with the amount of pixel data there is to download.</p>
<p>Unity provides an alternative approach with <a href="https://docs.unity3d.com/ScriptReference/Rendering.AsyncGPUReadback.html"><code>AsyncGPUReadback</code></a> that does not block the main thread. However it adds a few frames of latency. This may or may not matter depending on the specific application.</p>
<p>This function will be called once the <code>AsyncGPUReadback</code> has completed. We can load the raw pixel data from the request directly to <code>inputTex</code>.</p>
<p><strong>Note:</strong> It may be possible to access the underlying DirectX11 texture data directly using OpenVINO’s <a href="https://docs.openvinotoolkit.org/latest/openvino_docs_IE_DG_supported_plugins_GPU_RemoteBlob_API.html">Remote Blob API</a>. However, this potential approach will need to be explored in a future post.</p>
<section id="method-steps-8" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-8">Method Steps</h5>
<ol type="1">
<li>Check if an error occurred during the GPU readback.</li>
<li>Load the raw texture data from the readback into <code>inputTex</code>.</li>
<li>Apply the changes to <code>inputTex</code>.</li>
</ol>
</section>
<section id="code-12" class="level5">
<h5 class="anchored" data-anchor-id="code-12">Code</h5>
<div class="sourceCode" id="cb18"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called once AsyncGPUReadback has been completed</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"request"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">OnCompleteReadback</span><span class="op">(</span>AsyncGPUReadbackRequest request<span class="op">)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>request<span class="op">.</span><span class="fu">hasError</span><span class="op">)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"GPU readback error detected."</span><span class="op">);</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span><span class="op">;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fill Texture2D with raw data from the AsyncGPUReadbackRequest</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        inputTex<span class="op">.</span><span class="fu">LoadRawTextureData</span><span class="op">(</span>request<span class="op">.</span><span class="fu">GetData</span><span class="op">&lt;</span><span class="dt">uint</span><span class="op">&gt;());</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Apply changes to Texture2D</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        inputTex<span class="op">.</span><span class="fu">Apply</span><span class="op">();</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="define-onrenderimage-method" class="level4">
<h4 class="anchored" data-anchor-id="define-onrenderimage-method">Define <code>OnRenderImage()</code> Method</h4>
<p>The <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnRenderImage.html"><code>OnRenderImage()</code></a> method gets called after the Camera has finished rendering. This gives us access to the <code>RenderTexture</code> for the game camera as well as the <code>RenderTexture</code> for the target display. It allows us to stylize the final image from the in-game that would be displayed to the user. We’ll only stylize the current frame if the stylize toggle is on.</p>
<section id="method-steps-9" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-9">Method Steps:</h5>
<ol type="1">
<li>Check if the stylize UI toggle is ticked.
<ol type="1">
<li>Check which inference engine is currently selected
<ul>
<li>OpenVINO:
<ol type="1">
<li>Copy the <code>RenderTexture</code> for the camera to <code>tempTex</code></li>
<li>Flip the image</li>
<li>Read pixel data from <code>tempTex</code> to <code>inputTex</code> either asynchronously or synchronously</li>
<li>Call <code>UpdateTexture()</code> method</li>
<li>Load the updated raw pixel data from <code>inputData</code> to <code>inputTex</code></li>
<li>Apply the changes to <code>inputTex</code></li>
<li>Copy the pixel data from <code>inputTex</code> to <code>tempTex</code></li>
<li>Flip the image again</li>
<li>Copy the pixel data from <code>tempTex</code> to the <code>RenderTexture</code> for the camera</li>
</ol></li>
<li>Barracuda:
<ol type="1">
<li>Call <code>StylizeImage()</code> method</li>
</ol></li>
</ul></li>
<li>Copy the <code>RenderTexture</code> for the camera to the <code>RenderTexture</code> for the target display.</li>
</ol></li>
</ol>
</section>
<section id="code-13" class="level5">
<h5 class="anchored" data-anchor-id="code-13">Code</h5>
<div class="sourceCode" id="cb19"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// OnRenderImage is called after the Camera had finished rendering </span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"src"</span><span class="kw">&gt;</span><span class="co">Input from the Camera</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"dest"</span><span class="kw">&gt;</span><span class="co">The texture for the target display</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">OnRenderImage</span><span class="op">(</span>RenderTexture src<span class="op">,</span> RenderTexture dest<span class="op">)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Only stylize current frame if Stylize toggle is on</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>stylize<span class="op">.</span><span class="fu">isOn</span><span class="op">)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Check which inference engine to use</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>inferenceEngineDropdown<span class="op">.</span><span class="fu">value</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Copy current frame to smaller temporary texture</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>src<span class="op">,</span> tempTex<span class="op">);</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Flip image before sending to DLL</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ProcessImage</span><span class="op">(</span>tempTex<span class="op">,</span> <span class="st">"FlipXAxis"</span><span class="op">);</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>useAsync<span class="op">.</span><span class="fu">isOn</span><span class="op">)</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                    AsyncGPUReadback<span class="op">.</span><span class="fu">Request</span><span class="op">(</span>tempTex<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> TextureFormat<span class="op">.</span><span class="fu">RGBA32</span><span class="op">,</span> OnCompleteReadback<span class="op">);</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">else</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>                    RenderTexture<span class="op">.</span><span class="fu">active</span> <span class="op">=</span> tempTex<span class="op">;</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                    inputTex<span class="op">.</span><span class="fu">ReadPixels</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Rect</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> tempTex<span class="op">.</span><span class="fu">width</span><span class="op">,</span> tempTex<span class="op">.</span><span class="fu">height</span><span class="op">),</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                    inputTex<span class="op">.</span><span class="fu">Apply</span><span class="op">();</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Get raw data from Texture2D</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>                inputData <span class="op">=</span> inputTex<span class="op">.</span><span class="fu">GetRawTextureData</span><span class="op">();</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Send reference to inputData to DLL</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>                <span class="fu">UpdateTexture</span><span class="op">(</span>inputData<span class="op">);</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Load the new image data from the DLL to the texture</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>                inputTex<span class="op">.</span><span class="fu">LoadRawTextureData</span><span class="op">(</span>inputData<span class="op">);</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Apply the changes to the texture</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>                inputTex<span class="op">.</span><span class="fu">Apply</span><span class="op">();</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Copy output image to temporary texture</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>                Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>inputTex<span class="op">,</span> tempTex<span class="op">);</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Flip output image from DLL</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ProcessImage</span><span class="op">(</span>tempTex<span class="op">,</span> <span class="st">"FlipXAxis"</span><span class="op">);</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Copy the temporary texture to the source resolution texture</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>                Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>tempTex<span class="op">,</span> src<span class="op">);</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">StylizeImage</span><span class="op">(</span>src<span class="op">);</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>        Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>src<span class="op">,</span> dest<span class="op">);</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-log-method" class="level4">
<h4 class="anchored" data-anchor-id="create-log-method">Create <code>Log()</code> Method</h4>
<p>Since we can’t run the project in the Unity Editor with the plugin, we don’t have direct access to the console. However, we can capture the text that gets sent to the console and display it in the user interface. This can be useful for debugging purposes.</p>
<section id="method-steps-10" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-10">Method Steps</h5>
<ol type="1">
<li>Add the most recent console text to the console readout text area.</li>
</ol>
</section>
<section id="code-14" class="level5">
<h5 class="anchored" data-anchor-id="code-14">Code</h5>
<div class="sourceCode" id="cb20"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Updates on screen console text</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"logString"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stackTrace"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"type"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">Log</span><span class="op">(</span><span class="dt">string</span> logString<span class="op">,</span> <span class="dt">string</span> stackTrace<span class="op">,</span> LogType type<span class="op">)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        consoleText<span class="op">.</span><span class="fu">text</span> <span class="op">=</span> consoleText<span class="op">.</span><span class="fu">text</span> <span class="op">+</span> <span class="st">"</span><span class="sc">\n</span><span class="st"> "</span> <span class="op">+</span> logString<span class="op">;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="define-onenable-method" class="level4">
<h4 class="anchored" data-anchor-id="define-onenable-method">Define <code>OnEnable()</code> Method</h4>
<p>The <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnEnable.html"><code>OnEnable()</code></a> method is called when the <code>GameObject</code> the script is attached to becomes enabled or active.</p>
<section id="method-steps-11" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-11">Method Steps</h5>
<ol type="1">
<li>Add <code>Log()</code> method to <a href="https://docs.unity3d.com/ScriptReference/Application-logMessageReceived.html"><code>Application.logMessageReceived</code></a> event.</li>
</ol>
</section>
<section id="code-15" class="level5">
<h5 class="anchored" data-anchor-id="code-15">Code</h5>
<div class="sourceCode" id="cb21"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called when the object becomes enabled and active</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">OnEnable</span><span class="op">()</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        Application<span class="op">.</span><span class="fu">logMessageReceived</span> <span class="op">+=</span> Log<span class="op">;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="define-ondestroy-method" class="level4">
<h4 class="anchored" data-anchor-id="define-ondestroy-method">Define <code>OnDestroy()</code> Method</h4>
<p>We need to manually release the resources that get allocated for the inference engine interfaces and release the temporary <code>RenderTexture</code>. This should be one of the last actions performed. Therefore, we will do it in the <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnDestroy.html"><code>OnDestroy()</code></a> method.</p>
<section id="method-steps-12" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-12">Method Steps</h5>
<ol type="1">
<li>Remove the <code>inputTex</code> object.</li>
<li>Release the <code>tempTex</code> RenderTexture.</li>
<li>Release the resources allocated for each Barracuda inference engine interface.</li>
<li>Remove the Log function from the <code>Application.logMessageReceived</code> event.</li>
</ol>
</section>
<section id="code-16" class="level5">
<h5 class="anchored" data-anchor-id="code-16">Code</h5>
<div class="sourceCode" id="cb22"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called when the MonoBehaviour will be destroyed</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">OnDestroy</span><span class="op">()</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Destroy</span><span class="op">(</span>inputTex<span class="op">);</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>tempTex<span class="op">);</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Release the resources allocated for the inference engines</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span>IWorker engine <span class="kw">in</span> engines<span class="op">)</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>            engine<span class="op">.</span><span class="fu">Dispose</span><span class="op">();</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        Application<span class="op">.</span><span class="fu">logMessageReceived</span> <span class="op">-=</span> Log<span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-quit-method" class="level4">
<h4 class="anchored" data-anchor-id="create-quit-method">Create <code>Quit()</code> Method</h4>
<p>This method will be called when the <code>Quit</code> button is clicked in the user interface and will cause the application to exit.</p>
<section id="method-steps-13" class="level5">
<h5 class="anchored" data-anchor-id="method-steps-13">Method Steps</h5>
<ol type="1">
<li>Call the <a href="https://docs.unity3d.com/ScriptReference/Application.Quit.html"><code>Application.Quit()</code></a> method.</li>
</ol>
</section>
<section id="code-17" class="level5">
<h5 class="anchored" data-anchor-id="code-17">Code</h5>
<div class="sourceCode" id="cb23"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called when the Quit button is clicked.</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">Quit</span><span class="op">()</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Causes the application to exit</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        Application<span class="op">.</span><span class="fu">Quit</span><span class="op">();</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That takes care of the required code for this project. However, we still need to enable unsafe code in the Project Settings for the <code>UpdateTexture()</code> method to be allowed.</p>
</section>
</section>
</section>
</section>
<section id="enable-unsafe-code" class="level2">
<h2 class="anchored" data-anchor-id="enable-unsafe-code">Enable Unsafe Code</h2>
<p>Open the <code>Edit</code> menu at the top of the Unity Editor and select Project Settings.</p>
<p><img src="./images/unity-open-project-settings.png" alt="unity-open-project-settings" style="zoom:80%;"></p>
<p>Select <code>Player</code> from the side menu and open the <code>Other Settings</code> dropdown menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-project-settings-player.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Scroll down until you see the <code>Allow 'unsafe' Code</code> checkbox. Enable the setting and close the Project Settings window.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-player-settings-allow-unsafe-code.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="attach-script-to-camera" class="level2">
<h2 class="anchored" data-anchor-id="attach-script-to-camera">Attach Script to Camera</h2>
<p>To run the <code>StyleTransfer</code> script, we need to attach it to the active <code>Camera</code> in the scene.</p>
<p>Select the <code>Main Camera</code> object in the Hierarchy Tab and click the little lock icon at the top of the Inspector tab. This will keep the <code>Main Camera</code> in the Inspector tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-lock-camera-inspector.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Drag and drop the <code>StyleTransfer.cs</code> into the bottom of the Inspector tab. Now can assign the UI elements inside the Canvas object as well as the compute shader and any ONNX models. We can do so by dragging dropping them into their associated variable spots in the Inspector tab.</p>
<p>The actual text area for the <code>Console View</code> object is located at <code>Console View &gt; Viewport &gt; Content</code> in the Hierarchy tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-console-view-content.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>We also need to select the <code>Compute Precompiled</code> option from the <code>Worker Type</code> dropdown menu.</p>
<p><code>image here</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-select-compute-precompiled.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>The fully populated script should look like the image below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-fully-populated-script-component.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Click the lock icon again to unlock the Inspector tab.</p>
</section>
<section id="assign-ui-events" class="level2">
<h2 class="anchored" data-anchor-id="assign-ui-events">Assign UI Events</h2>
<p>Now we just need to assign the associated methods from the <code>StyleTransfer.cs</code> script to the UI event triggers.</p>
<section id="update-button" class="level3">
<h3 class="anchored" data-anchor-id="update-button">Update Button</h3>
<p>Select the <code>Update</code> object inside the <code>Canvas</code> object.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-update-button-object.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Scroll down in the Inspector tab to the <code>On Click</code> section.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-update-button-on-click-empty.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Drag and drop the <code>Main Camera</code> object into the <code>None (Object)</code> spot. Open the <code>No Function</code> dropdown menu. Open the <code>StyleTransfer</code> option and select <code>UpdateInputDims()</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-update-button-add-method.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="inference-engine-dropdown" class="level3">
<h3 class="anchored" data-anchor-id="inference-engine-dropdown">Inference Engine Dropdown</h3>
<p>Select the <code>Inference Engines</code> object inside the <code>Canvas</code> object.</p>
<p>Scroll down in the Inspector tab to the <code>On Value Changed (Int32)</code> section and press the little plus sign.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-engine-dropdown-on-changed-empty.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Drag and drop the <code>Main Camera</code> object into the <code>None (Object)</code> spot.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-engine-dropdown-on-changed-add-camera.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>This time, select the <code>StyleTransfer.SetInferenceEngine</code> method.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-engine-dropdown-on-changed-add-method.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="device-dropdown" class="level3">
<h3 class="anchored" data-anchor-id="device-dropdown">Device Dropdown</h3>
<p>Select the <code>Device</code> object inside the <code>Canvas</code> object and follow the same steps as the inference engine dropdown. This time, select the <code>StyleTransfer.SetDevice</code> method.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-device-add-method.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="model-dropdown" class="level3">
<h3 class="anchored" data-anchor-id="model-dropdown">Model Dropdown</h3>
<p>Select the <code>Model</code> object inside the <code>Canvas</code> object and follow the same steps as the device dropdown. This time, select the <code>StyleTransfer.UpdateModel</code> method.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-model-add-method.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="quit-button" class="level3">
<h3 class="anchored" data-anchor-id="quit-button">Quit Button</h3>
<p>Select the <code>Quit</code> object inside the <code>Canvas</code> object and follow the same steps as the <code>Update</code> button. This time select the <code>StyleTransfer.Quit</code> method.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-quit-button-add-method.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="build-the-project" class="level2">
<h2 class="anchored" data-anchor-id="build-the-project">Build the Project</h2>
<p>Now we can build the completed project. Open the <code>Build Settings</code> window like before and press <code>Build</code>. We’ll use the same folder as last time. If we did everything correctly, there should not be any build errors.</p>
</section>
<section id="add-models-folder" class="level2">
<h2 class="anchored" data-anchor-id="add-models-folder">Add Models Folder</h2>
<p>Create a new folder in the same directory as the <code>OpenVINO_Plugin_Demo.exe</code> file and name it <code>models</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/create-models-folder.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>We’ll place the <code>.xml</code> and <code>.bin</code> files for any OpenVINO models in this folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/add-model-files.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="add-plugins-folder" class="level2">
<h2 class="anchored" data-anchor-id="add-plugins-folder">Add Plugins folder</h2>
<p>Go back to the main build folder and open the <code>OpenVINO_Plugin_Demo_Data</code> folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/open-build-data-folder.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>From there, open the <code>Plugins</code> folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/open-build-data--plugins-folder.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Copy and paste the <code>x86_64</code> from earlier that contains all the <code>.dll</code> files and dependencies in here.</p>
</section>
<section id="run-the-application" class="level2">
<h2 class="anchored" data-anchor-id="run-the-application">Run the Application</h2>
<p>Now we can finally test the application. Go back to the main build folder and double-click the <code>OpenVINO_Plugin_Demo.exe</code> file to run it. Remember that the first time the application launches will be slow as the cache files are generated.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/application-test-run.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We now have a general workflow for leveraging the OpenVINO™ Toolkit inside the Unity game engine. The style transfer model used in this tutorial is extremely demanding and can push even high-end graphics cards to their limit. The performance improvements from using OpenVINO make these types of models accessible to a wider audience. Less demanding models can even be offloaded to the integrated graphics or CPU. Tools like Unity are capable of much more than making games and it is exciting to see what will be possible by combining efficient deep learning models with real-time development platforms.</p>
<p><strong>Project Resources:</strong></p>
<p><a href="https://github.com/cj-mills/Unity-OpenVINO-Plugin">GitHub Repository</a></p>


</section>

</main> <!-- /main -->
<!-- Cloudflare Web Analytics --><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;56b8d2f624604c4891327b3c0d9f6703&quot;}"></script><!-- End Cloudflare Web Analytics -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="cj-mills/christianjmills" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright 2023, Christian J. Mills
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>