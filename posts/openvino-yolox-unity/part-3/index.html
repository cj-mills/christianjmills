<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian Mills">
<meta name="dcterms.date" content="2021-10-06">
<meta name="description" content="This post demonstrates how to create a Unity project to access the DLL as a plugin.">

<title>Christian Mills - OpenVINO Object Detection for Unity Tutorial Pt.3 (Outdated)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Christian Mills - OpenVINO Object Detection for Unity Tutorial Pt.3 (Outdated)">
<meta property="og:description" content="This post demonstrates how to create a Unity project to access the DLL as a plugin.">
<meta property="og:image" content="christianjmills.com/posts/openvino-yolox-unity/part-3/images/logo.png">
<meta property="og:site-name" content="Christian Mills">
<meta name="twitter:title" content="Christian Mills - OpenVINO Object Detection for Unity Tutorial Pt.3 (Outdated)">
<meta name="twitter:description" content="This post demonstrates how to create a Unity project to access the DLL as a plugin.">
<meta name="twitter:image" content="christianjmills.com/posts/openvino-yolox-unity/part-3/images/logo.png">
<meta name="twitter:creator" content="@cdotjdotmills">
<meta name="twitter:site" content="@cdotjdotmills">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Christian Mills</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../series/tutorials/index.html" rel="" target="">
 <span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../series/notes/index.html" rel="" target="">
 <span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:christian@christianjmills.com" rel="" target=""><i class="bi bi-envelope-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cj-mills" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/cdotjdotmills" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../blog.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section">8/11/2022:</a></li>
  <li><a href="#previous-part-2" id="toc-previous-part-2" class="nav-link" data-scroll-target="#previous-part-2">Previous: Part 2</a></li>
  <li><a href="#update-12921-in-editor" id="toc-update-12921-in-editor" class="nav-link" data-scroll-target="#update-12921-in-editor">Update 12/9/21: In-Editor</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#create-new-project" id="toc-create-new-project" class="nav-link" data-scroll-target="#create-new-project">Create New Project</a></li>
  <li><a href="#add-gui" id="toc-add-gui" class="nav-link" data-scroll-target="#add-gui">Add GUI</a>
  <ul class="collapse">
  <li><a href="#import-canvas-prefab" id="toc-import-canvas-prefab" class="nav-link" data-scroll-target="#import-canvas-prefab">Import Canvas Prefab</a></li>
  <li><a href="#install-graphy-package" id="toc-install-graphy-package" class="nav-link" data-scroll-target="#install-graphy-package">Install Graphy Package</a></li>
  </ul></li>
  <li><a href="#create-video-player" id="toc-create-video-player" class="nav-link" data-scroll-target="#create-video-player">Create Video Player</a>
  <ul class="collapse">
  <li><a href="#create-the-videos-folder" id="toc-create-the-videos-folder" class="nav-link" data-scroll-target="#create-the-videos-folder">Create the Videos Folder</a></li>
  <li><a href="#add-video-files" id="toc-add-video-files" class="nav-link" data-scroll-target="#add-video-files">Add Video Files</a></li>
  <li><a href="#create-the-video-screen" id="toc-create-the-video-screen" class="nav-link" data-scroll-target="#create-the-video-screen">Create the Video Screen</a></li>
  <li><a href="#add-video-player-component" id="toc-add-video-player-component" class="nav-link" data-scroll-target="#add-video-player-component">Add Video Player Component</a></li>
  <li><a href="#make-the-video-loop" id="toc-make-the-video-loop" class="nav-link" data-scroll-target="#make-the-video-loop">Make the Video Loop</a></li>
  </ul></li>
  <li><a href="#add-label-canvas" id="toc-add-label-canvas" class="nav-link" data-scroll-target="#add-label-canvas">Add Label Canvas</a></li>
  <li><a href="#enable-unsafe-code" id="toc-enable-unsafe-code" class="nav-link" data-scroll-target="#enable-unsafe-code">Enable Unsafe Code</a></li>
  <li><a href="#include-unlit-shaders" id="toc-include-unlit-shaders" class="nav-link" data-scroll-target="#include-unlit-shaders">Include Unlit Shaders</a></li>
  <li><a href="#set-background-color" id="toc-set-background-color" class="nav-link" data-scroll-target="#set-background-color">Set Background Color</a></li>
  <li><a href="#set-up-project-code" id="toc-set-up-project-code" class="nav-link" data-scroll-target="#set-up-project-code">Set Up Project Code</a>
  <ul class="collapse">
  <li><a href="#imageprocessing-compute-shader" id="toc-imageprocessing-compute-shader" class="nav-link" data-scroll-target="#imageprocessing-compute-shader">ImageProcessing Compute Shader</a></li>
  <li><a href="#create-utils-script" id="toc-create-utils-script" class="nav-link" data-scroll-target="#create-utils-script">Create Utils Script</a></li>
  <li><a href="#create-boundingbox-script" id="toc-create-boundingbox-script" class="nav-link" data-scroll-target="#create-boundingbox-script">Create BoundingBox Script</a></li>
  <li><a href="#create-objectdetector-script" id="toc-create-objectdetector-script" class="nav-link" data-scroll-target="#create-objectdetector-script">Create ObjectDetector Script</a></li>
  </ul></li>
  <li><a href="#attach-script-to-gameobject" id="toc-attach-script-to-gameobject" class="nav-link" data-scroll-target="#attach-script-to-gameobject">Attach Script to GameObject</a></li>
  <li><a href="#assign-ui-events" id="toc-assign-ui-events" class="nav-link" data-scroll-target="#assign-ui-events">Assign UI Events</a>
  <ul class="collapse">
  <li><a href="#input-dims" id="toc-input-dims" class="nav-link" data-scroll-target="#input-dims">Input Dims</a></li>
  <li><a href="#nms-threshold" id="toc-nms-threshold" class="nav-link" data-scroll-target="#nms-threshold">NMS Threshold</a></li>
  <li><a href="#confidence-threshold" id="toc-confidence-threshold" class="nav-link" data-scroll-target="#confidence-threshold">Confidence Threshold</a></li>
  <li><a href="#device-dropdown" id="toc-device-dropdown" class="nav-link" data-scroll-target="#device-dropdown">Device Dropdown</a></li>
  <li><a href="#model-dropdown" id="toc-model-dropdown" class="nav-link" data-scroll-target="#model-dropdown">Model Dropdown</a></li>
  <li><a href="#video-dropdown" id="toc-video-dropdown" class="nav-link" data-scroll-target="#video-dropdown">Video Dropdown</a></li>
  <li><a href="#webcam-toggle" id="toc-webcam-toggle" class="nav-link" data-scroll-target="#webcam-toggle">Webcam Toggle</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a></li>
  <li><a href="#quit" id="toc-quit" class="nav-link" data-scroll-target="#quit">Quit</a></li>
  </ul></li>
  <li><a href="#build-the-project" id="toc-build-the-project" class="nav-link" data-scroll-target="#build-the-project">Build the Project</a></li>
  <li><a href="#add-models-folder" id="toc-add-models-folder" class="nav-link" data-scroll-target="#add-models-folder">Add Models Folder</a></li>
  <li><a href="#add-the-plugins-folder" id="toc-add-the-plugins-folder" class="nav-link" data-scroll-target="#add-the-plugins-folder">Add the Plugins folder</a></li>
  <li><a href="#run-the-application" id="toc-run-the-application" class="nav-link" data-scroll-target="#run-the-application">Run the Application</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">OpenVINO Object Detection for Unity Tutorial Pt.3 (Outdated)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">openvino</div>
    <div class="quarto-category">object-detection</div>
    <div class="quarto-category">yolox</div>
    <div class="quarto-category">tutorial</div>
    <div class="quarto-category">unity</div>
  </div>
  </div>

<div>
  <div class="description">
    This post demonstrates how to create a Unity project to access the DLL as a plugin.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian Mills </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 6, 2021</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section">8/11/2022:</h3>
<ul>
<li>This tutorial is outdated. Use the new version at the link below.</li>
<li><a href="../../icevision-openvino-unity-tutorial/part-1/">End-to-End Object Detection for Unity With IceVision and OpenVINO Pt. 1</a></li>
</ul>
<hr>
</section>
<section id="previous-part-2" class="level3">
<h3 class="anchored" data-anchor-id="previous-part-2">Previous: <a href="../part-2/">Part 2</a></h3>
</section>
<section id="update-12921-in-editor" class="level3">
<h3 class="anchored" data-anchor-id="update-12921-in-editor">Update 12/9/21: <a href="../in-editor/">In-Editor</a></h3>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#create-new-project">Create New Project</a></li>
<li><a href="#add-gui">Add GUI</a></li>
<li><a href="#create-video-player">Create Video Player</a></li>
<li><a href="#add-label-canvas">Add Label Canvas</a></li>
<li><a href="#enable-unsafe-code">Enable Unsafe Code</a></li>
<li><a href="#include-unlit-shaders">Include Unlit Shaders</a></li>
<li><a href="#set-background-color">Set Background Color</a></li>
<li><a href="#set-up-project-code">Set Up Project Code</a></li>
<li><a href="#attach-script-to-gameobject">Attach Script to GameObject</a></li>
<li><a href="#assign-ui-events">Assign UI Events</a></li>
<li><a href="#build-the-project">Build the Project</a></li>
<li><a href="#add-models-folder">Add Models Folder</a></li>
<li><a href="#add-plugins-folder">Add Plugins folder</a></li>
<li><a href="#run-the-application">Run the Application</a></li>
<li><a href="#next-steps">Next Steps</a></li>
</ul>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In Part 1 of the tutorial, we first installed Unity, OpenVINO™, and the prerequisite software. We then downloaded some pretrained models in the OpenVINO™ <a href="https://docs.openvinotoolkit.org/latest/openvino_docs_MO_DG_IR_and_opsets.html">Intermediate Representation</a> format, along with some videos to test the models.</p>
<p>In Part 2, we walked through the steps to create a <a href="https://docs.microsoft.com/en-us/troubleshoot/windows-client/deployment/dynamic-link-library">Dynamic link library (DLL)</a> in Visual Studio to perform <a href="https://www.intel.com/content/www/us/en/artificial-intelligence/posts/deep-learning-training-and-inference.html">inference</a> with the pre-trained deep learning models.</p>
<p>In this part, we will demonstrate how to create a Unity project to access the DLL as a plugin.</p>
</section>
<section id="create-new-project" class="level2">
<h2 class="anchored" data-anchor-id="create-new-project">Create New Project</h2>
<p>Open Unity Hub and click the New button.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-click-new.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>We can stick with the default 3D template and name the project OpenVINO_YOLOX_Demo. Take note of where the project will be generated and click Create.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-hub-create-project.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="add-gui" class="level2">
<h2 class="anchored" data-anchor-id="add-gui">Add GUI</h2>
<p>At the moment, we cannot use our OpenVINO plugin inside the Unity editor. There appears to be a dependency conflict between one of the dependencies for this version of OpenVINO and the Unity editor. However, this should be resolved for future versions of OpenVINO.</p>
<p>For now, we need to build our Unity project without the plugin files, and then add them to the build folder where the project executable file is located.</p>
<p>We will be using the free <a href="https://assetstore.unity.com/packages/tools/gui/graphy-ultimate-fps-counter-stats-monitor-debugger-105778">Graphy</a> asset to display frame rate and other performance metrics at runtime. A simple user interface is already set up in the <a href="https://docs.unity3d.com/Manual/Prefabs.html">prefab</a> linked below.</p>
<ul>
<li><a href="https://drive.google.com/file/d/1e7hYBM7rBsqhvjWThfpMKbYbUVCBUPLM/view?usp=sharing">Canvas Prefab</a></li>
</ul>
<section id="import-canvas-prefab" class="level3">
<h3 class="anchored" data-anchor-id="import-canvas-prefab">Import Canvas Prefab</h3>
<p>Download the Canvas.prefab file from the above link and drop it into the assets folder in the Unity editor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-add-canvas-prefab.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Drag and drop the prefab from the Assets folder into the Hierarchy tab. A TMP Importer popup window will appear. Click Import TMP Essentials. Close the popup window once the import is complete.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-import-tmp-essentials.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>If we select the Game tab, we can see the interface we just added. Don’t worry if it looks squished.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-view-canvas.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="install-graphy-package" class="level3">
<h3 class="anchored" data-anchor-id="install-graphy-package">Install Graphy Package</h3>
<p>This next step requires being signed into a Unity account. Open the link to the Graphy Unity Store page below and click Add to My Assets.</p>
<ul>
<li>Graphy Asset Store Page: (<a href="https://assetstore.unity.com/packages/tools/gui/graphy-ultimate-fps-counter-stats-monitor-debugger-105778">link</a>)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-store-add-graphy.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>The Add to My Assets button should change to Open In Unity. Click the button again to open the asset in the Package Manager back in the editor.</p>
<p>The Package Manager window should popup in the editor with the Graphy asset selected. Click the download button in the bottom right corner.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/package-manager-download-graphy.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Click Import once the package is finished downloading. An Import Unity Package popup window will appear.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/package-manager-import-graphy.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Click Import in the popup window. Close the Package Manager window once the import is complete. There should now be a new folder called Graphy - Ultimate Stats Monitor in the Assets folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/import-unity-package-graphy.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Inside the new folder, open the Prefab folder and drag the [Graphy] prefab into the Hierarchy tab. We will see that our game scene gets updated.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-assets-graphy-prefab.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>With the <code>[Graphy]</code> object still selected in the Hierarchy tab. Scroll down in the Inspector tab to the Graphy Manager (Script) section. Open the Graph modules position dropdown and select TOP_LEFT. Nothing will change in the game view, but the position will be updated when we build the project.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/graphy-set-module-position.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="create-video-player" class="level2">
<h2 class="anchored" data-anchor-id="create-video-player">Create Video Player</h2>
<p>For this demo, we will obtain our input images from a video or webcam feed playing in the scene.</p>
<section id="create-the-videos-folder" class="level3">
<h3 class="anchored" data-anchor-id="create-the-videos-folder">Create the Videos Folder</h3>
<p>In the Assets window, right-click an empty space, select the Create option, and click Folder. Name the folder Videos.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-create-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Double-click the Videos folder to open it.</p>
</section>
<section id="add-video-files" class="level3">
<h3 class="anchored" data-anchor-id="add-video-files">Add Video Files</h3>
<p>Drag and drop any video files from the file explorer into the Videos folder. We will be using the file names to populate the dropdown menu in the UI, so rename the files according to their target object class.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-editor-add-video-files.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="create-the-video-screen" class="level3">
<h3 class="anchored" data-anchor-id="create-the-video-screen">Create the Video Screen</h3>
<p>We will use a <a href="https://docs.unity3d.com/Manual/PrimitiveObjects.html">Quad</a> object for the screen. Right-click an empty space in the Hierarchy tab. Select the 3D Object section and click Quad. We can just name it VideoScreen.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-quad.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>We will be updating the VideoScreen dimensions in code based on the resolution of the video or webcam feed.</p>
</section>
<section id="add-video-player-component" class="level3">
<h3 class="anchored" data-anchor-id="add-video-player-component">Add Video Player Component</h3>
<p>Unity has a <a href="https://docs.unity3d.com/Manual/class-VideoPlayer.html">Video Player component</a> that provides the functionality to attach video files to the VideoScreen. With the VideoScreen object selected in the Hierarchy tab, click the Add Component button in the Inspector tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/videoScreen-add-component.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Type video into the search box and select Video Player from the search results.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/videoScreen-add-video-player-component.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>We do not need to manually assign a video clip as this will be done in code.</p>
</section>
<section id="make-the-video-loop" class="level3">
<h3 class="anchored" data-anchor-id="make-the-video-loop">Make the Video Loop</h3>
<p>Tick the Loop checkbox in the Inspector tab to make the video repeat when the project is running.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-loop-video.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="add-label-canvas" class="level2">
<h2 class="anchored" data-anchor-id="add-label-canvas">Add Label Canvas</h2>
<p>We will attach the labels for each bounding box to a separate Canvas rather than the one containing the user interface. This will allow us to hide the user interface without hiding the labels.</p>
<p>Right-click an empty space in the Hierarchy tab. Select the UI section and click Canvas. We can just name it Label Canvas.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-label-canvas.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="enable-unsafe-code" class="level2">
<h2 class="anchored" data-anchor-id="enable-unsafe-code">Enable Unsafe Code</h2>
<p>In order to pass references to Unity variables to the OpenVINO plugin we will need to enable <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/unsafe">unsafe</a> code. Open the Edit menu at the top of the Unity Editor and select Project Settings.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-open-project-settings.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Select Player from the side menu and open the Other Settings dropdown menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-project-settings-player.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Scroll down to the Allow ‘unsafe’ Code checkbox and enable it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-player-settings-allow-unsafe-code.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="include-unlit-shaders" class="level2">
<h2 class="anchored" data-anchor-id="include-unlit-shaders">Include Unlit Shaders</h2>
<p>We will be using Unlit shaders for both the video screen and the bounding boxes. By default, Unlit shaders are not included in project builds. We need to manually include them in the project settings.</p>
<p>While still in the Project Settings window, select the Graphics submenu and scroll down to the Always Included Shaders section. Update the Size value to add an extra Element spot.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/project-settings-increase-included-shaders-size.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Select the new bottom shader spot.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/select-bottom-shader-spot.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Type Unlit/Texture shader into the Select Shader window and select Unlit/Texture from the available options. We can then close the Select Shader window.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/select-unlit-texture-shader.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>We will also need the Unlit/Color shader for the bounding boxes so repeat these steps to add it as well.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/add-unlit-color-shader.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Now we can close the project settings window.</p>
</section>
<section id="set-background-color" class="level2">
<h2 class="anchored" data-anchor-id="set-background-color">Set Background Color</h2>
<p>One last thing we can do to make things a bit cleaner is to set the background color to a solid color. This will look a bit nicer when we play videos that have a different aspect ratio than the screen.</p>
<p>Select the Main Camera object in the Hierarchy tab. Over in the Inspector tab, open the Clear Flags dropdown and select Solid Color.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-set-clear-flags.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Click on the color bar next to Background to set the color.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-select-background-color.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>We can make it pure black by setting the RGB color values to 0.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-set-background-to-black.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="set-up-project-code" class="level2">
<h2 class="anchored" data-anchor-id="set-up-project-code">Set Up Project Code</h2>
<p>Now, we can implement the code for the project.</p>
<section id="imageprocessing-compute-shader" class="level3">
<h3 class="anchored" data-anchor-id="imageprocessing-compute-shader">ImageProcessing Compute Shader</h3>
<p>The pixel data from Unity gets flipped when loaded into the cv::Mat texture variable in the DLL. We will need to flip the image before sending it to the plugin so that it will be in the correct orientation for the model. We’ll implement these steps on the GPU in a <a href="https://docs.unity3d.com/Manual/class-ComputeShader.html">compute shader</a>.</p>
<section id="create-the-asset-file" class="level4">
<h4 class="anchored" data-anchor-id="create-the-asset-file">Create the Asset File</h4>
<p>Create a new assets folder called Shaders. Enter the Shaders folder and right-click an empty space. Select Shader in the Create submenu and click Compute Shader. We’ll name it ImageProcessing.</p>
</section>
<section id="remove-the-default-code" class="level4">
<h4 class="anchored" data-anchor-id="remove-the-default-code">Remove the Default Code</h4>
<p>Open the ImageProcessing file in the code editor. By default, the ComputeShader will contain the following code.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Each #kernel tells which function to compile; you can have many kernels</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>#pragma kernel CSMain</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a RenderTexture with enableRandomWrite flag and set it</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">// with cs.SetTexture</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>RWTexture2D<span class="op">&lt;</span>float4<span class="op">&gt;</span> Result<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">8</span><span class="op">,</span><span class="dv">8</span><span class="op">,</span><span class="dv">1</span><span class="op">)]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">CSMain</span> <span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: insert actual code here!</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">float4</span><span class="op">(</span>id<span class="op">.</span><span class="fu">x</span> <span class="op">&amp;</span> id<span class="op">.</span><span class="fu">y</span><span class="op">,</span> <span class="op">(</span>id<span class="op">.</span><span class="fu">x</span> <span class="op">&amp;</span> <span class="dv">15</span><span class="op">)/</span><span class="fl">15.0</span><span class="op">,</span> <span class="op">(</span>id<span class="op">.</span><span class="fu">y</span> <span class="op">&amp;</span> <span class="dv">15</span><span class="op">)/</span><span class="fl">15.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Delete the CSMain function along with the #pragma kernel CSMain.</p>
</section>
<section id="create-flipxaxis-function" class="level4">
<h4 class="anchored" data-anchor-id="create-flipxaxis-function">Create FlipXAxis() Function</h4>
<p>Next, we need to add a Texture2D variable to store the input image. Name it InputImage and give it a data type of <half4>. Use the same data type for the Result variable as well.</half4></p>
<p>We also need to know the height and width of the image to swap the pixel values. We’ll store these values in int variables and store the new (x,y) coordinates for individual pixel values in an int2 variable.</p>
<section id="code" class="level5">
<h5 class="anchored" data-anchor-id="code">Code:</h5>
<div class="sourceCode" id="cb2"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Each #kernel tells which function to compile; you can have many kernels</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>#pragma kernel FlipXAxis</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a RenderTexture with enableRandomWrite flag and set it</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">// with cs.SetTexture</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>RWTexture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> Result<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the input image and is set with cs.SetTexture</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Texture2D<span class="op">&lt;</span>half4<span class="op">&gt;</span> InputImage<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">// The height of the input image</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> height<span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the new location for individual pixel values</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>int2 coords<span class="op">;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">numthreads</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">)]</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">FlipXAxis</span><span class="op">(</span>uint3 id <span class="op">:</span> SV_DispatchThreadID<span class="op">)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the y value for the pixel coordinates</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> <span class="fu">int2</span><span class="op">(</span>id<span class="op">.</span><span class="fu">x</span><span class="op">,</span> height <span class="op">-</span> id<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    Result<span class="op">[</span>id<span class="op">.</span><span class="fu">xy</span><span class="op">]</span> <span class="op">=</span> <span class="fu">float4</span><span class="op">(</span>InputImage<span class="op">[</span>coords<span class="op">].</span><span class="fu">x</span><span class="op">,</span> InputImage<span class="op">[</span>coords<span class="op">].</span><span class="fu">y</span><span class="op">,</span> InputImage<span class="op">[</span>coords<span class="op">].</span><span class="fu">z</span><span class="op">,</span> <span class="fl">1.0f</span><span class="op">);</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="create-utils-script" class="level3">
<h3 class="anchored" data-anchor-id="create-utils-script">Create Utils Script</h3>
<p>We need to create an Object struct for Unity to match the one we defined for the OpenVINO code. We will place the Object and the list of object classes inside a separate C# script called Utils so that we can access them from multiple scripts.</p>
<section id="create-the-asset-file-1" class="level4">
<h4 class="anchored" data-anchor-id="create-the-asset-file-1">Create the Asset File</h4>
<p>Create a new assets folder called Scripts. In the Scripts folder, right-click an empty space and select C# Script in the Create submenu. Name the script Utils.</p>
</section>
<section id="required-namespaces" class="level4">
<h4 class="anchored" data-anchor-id="required-namespaces">Required Namespaces</h4>
<p>We will start by adding the required namespaces at the top of the script.</p>
<ul>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system?view=net-5.0">System</a>: Contains fundamental classes and base classes that define commonly-used value and reference data types, events and event handlers, interfaces, attributes, and processing exceptions.</p></li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices?view=net-5.0">System.Runtime.InteropServices</a>: Provides a wide variety of members that support COM interop and platform invoke services.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Runtime</span><span class="op">.</span><span class="fu">InteropServices</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="object-struct" class="level4">
<h4 class="anchored" data-anchor-id="object-struct">Object Struct</h4>
<p>The Object struct in Unity has the exact same variables as the one in the DLL. We need to specify how the data in the struct is organized so that we can properly modify the Object array in the PopulateObjectsArray() function. We can use the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.structlayoutattribute?view=net-5.0">StructLayout</a> attribute to indicate how the data is laid out. In our case, the data is laid out sequentially, so we specify <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.layoutkind?view=net-5.0">LayoutKind.Sequential</a>.</p>
<section id="code-1" class="level5">
<h5 class="anchored" data-anchor-id="code-1">Code:</h5>
<div class="sourceCode" id="cb4"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Indicate that the members of the struct are laid out sequentially</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">StructLayout</span><span class="op">(</span>LayoutKind<span class="op">.</span><span class="fu">Sequential</span><span class="op">)]</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// Stores the information for a single object</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span><span class="co"> </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">struct</span> Object</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The X coordinate for the top left bounding box corner</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">float</span> x0<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The Y coordinate for the top left bounding box corner</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">float</span> y0<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The width of the bounding box</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">float</span> width<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The height of the bounding box</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">float</span> height<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The object class index for the detected object</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> label<span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The model confidence score for the object</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">float</span> prob<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Object</span><span class="op">(</span><span class="dt">float</span> x0<span class="op">,</span> <span class="dt">float</span> y0<span class="op">,</span> <span class="dt">float</span> width<span class="op">,</span> <span class="dt">float</span> height<span class="op">,</span> <span class="dt">int</span> label<span class="op">,</span> <span class="dt">float</span> prob<span class="op">)</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">x0</span> <span class="op">=</span> x0<span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">y0</span> <span class="op">=</span> y0<span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">width</span> <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">height</span> <span class="op">=</span> height<span class="op">;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">label</span> <span class="op">=</span> label<span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">prob</span> <span class="op">=</span> prob<span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="object_classes-tuple" class="level4">
<h4 class="anchored" data-anchor-id="object_classes-tuple">object_classes Tuple</h4>
<p>We will store the ordered list of object classes along with unique color codes in a Tuple array. The color codes will be used to set the color for the bounding boxes.</p>
<p><strong>Note:</strong> The object classes need to be in the same order as what the model was trained on. This array will need to be updated when using models trained on a different dataset.</p>
<section id="code-2" class="level5">
<h5 class="anchored" data-anchor-id="code-2">Code:</h5>
<div class="sourceCode" id="cb5"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// The color coded, ordered list of object classes the model was trained to detect</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> Tuple<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> Color<span class="op">&gt;[]</span> object_classes <span class="op">=</span> <span class="kw">new</span> Tuple<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> Color<span class="op">&gt;[]</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"person"</span><span class="op">,</span>         <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.447f</span><span class="op">,</span> <span class="fl">0.741f</span><span class="op">)),</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"bicycle"</span><span class="op">,</span>        <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.850f</span><span class="op">,</span> <span class="fl">0.325f</span><span class="op">,</span> <span class="fl">0.098f</span><span class="op">)),</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"car"</span><span class="op">,</span>            <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.929f</span><span class="op">,</span> <span class="fl">0.694f</span><span class="op">,</span> <span class="fl">0.125f</span><span class="op">)),</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"motorcycle"</span><span class="op">,</span>     <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.494f</span><span class="op">,</span> <span class="fl">0.184f</span><span class="op">,</span> <span class="fl">0.556f</span><span class="op">)),</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"airplane"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.466f</span><span class="op">,</span> <span class="fl">0.674f</span><span class="op">,</span> <span class="fl">0.188f</span><span class="op">)),</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"bus"</span><span class="op">,</span>            <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.301f</span><span class="op">,</span> <span class="fl">0.745f</span><span class="op">,</span> <span class="fl">0.933f</span><span class="op">)),</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"train"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.635f</span><span class="op">,</span> <span class="fl">0.078f</span><span class="op">,</span> <span class="fl">0.184f</span><span class="op">)),</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"truck"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.300f</span><span class="op">,</span> <span class="fl">0.300f</span><span class="op">,</span> <span class="fl">0.300f</span><span class="op">)),</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"boat"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.600f</span><span class="op">,</span> <span class="fl">0.600f</span><span class="op">,</span> <span class="fl">0.600f</span><span class="op">)),</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"traffic light"</span><span class="op">,</span>  <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"fire hydrant"</span><span class="op">,</span>   <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"stop sign"</span><span class="op">,</span>      <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.749f</span><span class="op">,</span> <span class="fl">0.749f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"parking meter"</span><span class="op">,</span>  <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"bench"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"bird"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"cat"</span><span class="op">,</span>            <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"dog"</span><span class="op">,</span>            <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"horse"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"sheep"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"cow"</span><span class="op">,</span>            <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"elephant"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"bear"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"zebra"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"giraffe"</span><span class="op">,</span>        <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"backpack"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"umbrella"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"handbag"</span><span class="op">,</span>        <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"tie"</span><span class="op">,</span>            <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"suitcase"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"frisbee"</span><span class="op">,</span>        <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"skis"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"snowboard"</span><span class="op">,</span>      <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"sports ball"</span><span class="op">,</span>    <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"kite"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"baseball bat"</span><span class="op">,</span>   <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"baseball glove"</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"skateboard"</span><span class="op">,</span>     <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"surfboard"</span><span class="op">,</span>      <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"tennis racket"</span><span class="op">,</span>  <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"bottle"</span><span class="op">,</span>         <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"wine glass"</span><span class="op">,</span>     <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"cup"</span><span class="op">,</span>            <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"fork"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"knife"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"spoon"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"bowl"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"banana"</span><span class="op">,</span>         <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"apple"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"sandwich"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"orange"</span><span class="op">,</span>         <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"broccoli"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"carrot"</span><span class="op">,</span>         <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"hot dog"</span><span class="op">,</span>        <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"pizza"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"donut"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.500f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"cake"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"chair"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.833f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"couch"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"potted plant"</span><span class="op">,</span>   <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.167f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"bed"</span><span class="op">,</span>            <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"dining table"</span><span class="op">,</span>   <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"toilet"</span><span class="op">,</span>         <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"tv"</span><span class="op">,</span>             <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.833f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"laptop"</span><span class="op">,</span>         <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"mouse"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.167f</span><span class="op">)),</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"remote"</span><span class="op">,</span>         <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.333f</span><span class="op">)),</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"keyboard"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.500f</span><span class="op">)),</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"cell phone"</span><span class="op">,</span>     <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.667f</span><span class="op">)),</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"microwave"</span><span class="op">,</span>      <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.833f</span><span class="op">)),</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"oven"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">1.000f</span><span class="op">)),</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"toaster"</span><span class="op">,</span>        <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.000f</span><span class="op">)),</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"sink"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.143f</span><span class="op">,</span> <span class="fl">0.143f</span><span class="op">,</span> <span class="fl">0.143f</span><span class="op">)),</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"refrigerator"</span><span class="op">,</span>   <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.286f</span><span class="op">,</span> <span class="fl">0.286f</span><span class="op">,</span> <span class="fl">0.286f</span><span class="op">)),</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"book"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.429f</span><span class="op">,</span> <span class="fl">0.429f</span><span class="op">,</span> <span class="fl">0.429f</span><span class="op">)),</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"clock"</span><span class="op">,</span>          <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.571f</span><span class="op">,</span> <span class="fl">0.571f</span><span class="op">,</span> <span class="fl">0.571f</span><span class="op">)),</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"vase"</span><span class="op">,</span>           <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.714f</span><span class="op">,</span> <span class="fl">0.714f</span><span class="op">,</span> <span class="fl">0.714f</span><span class="op">)),</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"scissors"</span><span class="op">,</span>       <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.857f</span><span class="op">,</span> <span class="fl">0.857f</span><span class="op">,</span> <span class="fl">0.857f</span><span class="op">)),</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"teddy bear"</span><span class="op">,</span>     <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.000f</span><span class="op">,</span> <span class="fl">0.447f</span><span class="op">,</span> <span class="fl">0.741f</span><span class="op">)),</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"hair drier"</span><span class="op">,</span>     <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.314f</span><span class="op">,</span> <span class="fl">0.717f</span><span class="op">,</span> <span class="fl">0.741f</span><span class="op">)),</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>    Tuple<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"toothbrush"</span><span class="op">,</span>     <span class="kw">new</span> <span class="fu">Color</span><span class="op">(</span><span class="fl">0.50f</span><span class="op">,</span> <span class="fl">0.5f</span><span class="op">,</span> 0f<span class="op">))</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="create-boundingbox-script" class="level3">
<h3 class="anchored" data-anchor-id="create-boundingbox-script">Create BoundingBox Script</h3>
<p>We will implement the functionality for creating bounding boxes in a new script called BoundingBox. The BoundingBox class will handle creating a single bounding box along with updating its object class, position, and size. We will be creating as many BoundingBox instances as needed to handle the number of objects specified by the GetObjectCount() function.</p>
<section id="required-namespaces-1" class="level4">
<h4 class="anchored" data-anchor-id="required-namespaces-1">Required Namespaces</h4>
<ul>
<li><a href="https://docs.unity3d.com/Packages/com.unity.textmeshpro@1.3/api/TMPro.html">TMPro</a>: Provides advanced text rendering capabilities</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> TMPro<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="properties" class="level4">
<h4 class="anchored" data-anchor-id="properties">Properties</h4>
<ul>
<li><p>bbox: A new <a href="https://docs.unity3d.com/ScriptReference/GameObject.html">GameObject</a> will be created for each bounding box.</p></li>
<li><p>text: The text showing the labe and confidence score will be stored in a separate GameObject as it needs to be attached to a Canvas</p></li>
<li><p>canvas: We will store a reference to the Label Canvas object so that we can attach the text object to it.</p></li>
<li><p>info: This will store the Object struct for the bounding box.</p></li>
<li><p>color: This will store the color specific to the current object class</p></li>
<li><p>lineWidth: We shall set the line thickness for the bounding box based on the current screen size. Feel free to make this larger or smaller based on personal preference.</p></li>
<li><p>fontSize: We shall also set the font size for the bounding box text based on the current screen size. Again, feel free to adjust this based on personal preference.</p></li>
<li><p>textContent: We can display the text for the bounding using the <a href="https://docs.unity3d.com/Packages/com.unity.textmeshpro@1.1/api/TMPro.TextMeshProUGUI.html">TextMeshProUGUI</a> component. We will attach this component to the text object.</p></li>
<li><p>lineRenderer: We can draw the bounding box itself using a <a href="https://docs.unity3d.com/Manual/class-LineRenderer.html">LineRenderer</a> component. We will attach this component to the bbox object.</p></li>
</ul>
<section id="code-3" class="level5">
<h5 class="anchored" data-anchor-id="code-3">Code:</h5>
<div class="sourceCode" id="cb7"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Contains the bounding box</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> GameObject bbox <span class="op">=</span> <span class="kw">new</span> <span class="fu">GameObject</span><span class="op">();</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Contains the label text</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> GameObject text <span class="op">=</span> <span class="kw">new</span> <span class="fu">GameObject</span><span class="op">();</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">// The canvas on which the bounding box labels will be drawn</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> GameObject canvas <span class="op">=</span> GameObject<span class="op">.</span><span class="fu">Find</span><span class="op">(</span><span class="st">"Label Canvas"</span><span class="op">);</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">// The object information for the bounding box</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Utils<span class="op">.</span><span class="fu">Object</span> info<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">// The object class color</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Color color<span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">// The adjusted line width for the bounding box</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> lineWidth <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>Screen<span class="op">.</span><span class="fu">width</span> <span class="op">*</span> <span class="fl">1.75e-3</span><span class="op">);</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">// The adjusted font size based on the screen size</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">float</span> fontSize <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)(</span>Screen<span class="op">.</span><span class="fu">width</span> <span class="op">*</span> <span class="fl">9e-3</span><span class="op">);</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">// The label text</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> TextMeshProUGUI textContent<span class="op">;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Draws the bounding box</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> LineRenderer lineRenderer<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="initializelabel" class="level4">
<h4 class="anchored" data-anchor-id="initializelabel">InitializeLabel()</h4>
<p>The text for each bounding box will contain the name of the object class and the confidence score from the model output.</p>
<p>We shall make the text the color specified by the object class, left-justified, and aligned in the middle of the text box. The default size of the text box might be too small for some of the longer object names, so we shall make it a bit wider as well.</p>
<p>The text will be positioned just above the top-left corner of the bounding box. We can use the <a href="https://docs.unity3d.com/ScriptReference/Camera.WorldToScreenPoint.html">WorldToScreenPoint()</a> method to map the desired in-game position to screen space.</p>
<section id="code-4" class="level5">
<h5 class="anchored" data-anchor-id="code-4">Code:</h5>
<div class="sourceCode" id="cb8"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Initialize the label for the bounding box</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"label"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializeLabel</span><span class="op">()</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the label text</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    textContent<span class="op">.</span><span class="fu">text</span> <span class="op">=</span> $<span class="st">"{text.name}: {(info.prob * 100).ToString("</span><span class="fl">0.</span>##<span class="st">")}%"</span><span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the text color</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    textContent<span class="op">.</span><span class="fu">color</span> <span class="op">=</span> color<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the text alignment</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    textContent<span class="op">.</span><span class="fu">alignment</span> <span class="op">=</span> TextAlignmentOptions<span class="op">.</span><span class="fu">MidlineLeft</span><span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the font size</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    textContent<span class="op">.</span><span class="fu">fontSize</span> <span class="op">=</span> fontSize<span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Resize the text area</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    RectTransform rectTransform <span class="op">=</span> text<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>RectTransform<span class="op">&gt;();</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    rectTransform<span class="op">.</span><span class="fu">sizeDelta</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span><span class="dv">250</span><span class="op">,</span> <span class="dv">50</span><span class="op">);</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Position the label above the top left corner of the bounding box</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    Vector3 textPos <span class="op">=</span> Camera<span class="op">.</span><span class="fu">main</span><span class="op">.</span><span class="fu">WorldToScreenPoint</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>info<span class="op">.</span><span class="fu">x0</span><span class="op">,</span> info<span class="op">.</span><span class="fu">y0</span><span class="op">,</span> <span class="op">-</span>10f<span class="op">));</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> xOffset <span class="op">=</span> rectTransform<span class="op">.</span><span class="fu">rect</span><span class="op">.</span><span class="fu">width</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    textPos <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>textPos<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> xOffset<span class="op">,</span> textPos<span class="op">.</span><span class="fu">y</span> <span class="op">+</span> textContent<span class="op">.</span><span class="fu">fontSize</span><span class="op">,</span> textPos<span class="op">.</span><span class="fu">z</span><span class="op">);</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    text<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">position</span> <span class="op">=</span> textPos<span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="togglebbox" class="level4">
<h4 class="anchored" data-anchor-id="togglebbox">ToggleBBox()</h4>
<p>We can toggle the visibility for the bounding box and text using the <a href="https://docs.unity3d.com/ScriptReference/GameObject.SetActive.html">SetActive()</a> method. We will use this to hide any extra bounding boxes and to unhide them when they are needed again.</p>
<section id="code-5" class="level5">
<h5 class="anchored" data-anchor-id="code-5">Code:</h5>
<div class="sourceCode" id="cb9"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Toggle the visibility for the bounding box</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"show"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">ToggleBBox</span><span class="op">(</span><span class="dt">bool</span> show<span class="op">)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    bbox<span class="op">.</span><span class="fu">SetActive</span><span class="op">(</span>show<span class="op">);</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    text<span class="op">.</span><span class="fu">SetActive</span><span class="op">(</span>show<span class="op">);</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="initializebbox" class="level4">
<h4 class="anchored" data-anchor-id="initializebbox">InitializeBBox()</h4>
<p>The bounding box will be the color specified by the object class. The lineRender will consist of five points to create a closed box; four for each corner and one to close the box.</p>
<ol type="1">
<li><p>Point #0: Top-left corner</p></li>
<li><pre><code>Point #1: Top-right corner</code></pre></li>
<li><pre><code>Point #2: Bottom-right corner</code></pre></li>
<li><pre><code>Point #3: Bottom-left corner</code></pre></li>
<li><pre><code>Point #4: Top-left corner (close loop)</code></pre></li>
</ol>
<section id="code-6" class="level5">
<h5 class="anchored" data-anchor-id="code-6">Code:</h5>
<div class="sourceCode" id="cb14"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Initialize the position and dimensions for the bounding box</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializeBBox</span><span class="op">()</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the material color</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">material</span><span class="op">.</span><span class="fu">color</span> <span class="op">=</span> color<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The bbox will consist of five points</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">positionCount</span> <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the width from the start point</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">startWidth</span> <span class="op">=</span> lineWidth<span class="op">;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the width from the end point</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">endWidth</span> <span class="op">=</span> lineWidth<span class="op">;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get object information</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> x0 <span class="op">=</span> info<span class="op">.</span><span class="fu">x0</span><span class="op">;</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> y0 <span class="op">=</span> info<span class="op">.</span><span class="fu">y0</span><span class="op">;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> width <span class="op">=</span> info<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> height <span class="op">=</span> info<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Offset value to align the bounding box points</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> offset <span class="op">=</span> lineWidth <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Top left point</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    Vector3 pos0 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>x0<span class="op">,</span> y0<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">SetPosition</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> pos0<span class="op">);</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Top right point</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    Vector3 pos1 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>x0 <span class="op">+</span> width<span class="op">,</span> y0<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">SetPosition</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> pos1<span class="op">);</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bottom right point</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    Vector3 pos2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>x0 <span class="op">+</span> width<span class="op">,</span> <span class="op">(</span>y0 <span class="op">-</span> height<span class="op">)</span> <span class="op">+</span> offset<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">SetPosition</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> pos2<span class="op">);</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bottom left point</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    Vector3 pos3 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>x0 <span class="op">+</span> offset<span class="op">,</span> <span class="op">(</span>y0 <span class="op">-</span> height<span class="op">)</span> <span class="op">+</span> offset<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">SetPosition</span><span class="op">(</span><span class="dv">3</span><span class="op">,</span> pos3<span class="op">);</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Closing Point</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    Vector3 pos4 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>x0 <span class="op">+</span> offset<span class="op">,</span> y0 <span class="op">+</span> offset<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">SetPosition</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> pos4<span class="op">);</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Make sure the bounding box is visible</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ToggleBBox</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="setobjectinfo" class="level4">
<h4 class="anchored" data-anchor-id="setobjectinfo">SetObjectInfo()</h4>
<p>We will call the InitializeLabel() and InitializeBBox() methods from a new method called SetObjectInfo(). This method will also update the names for the bbox and text objects along with the color. We will use this method to update the bounding boxes based on the latest model output.</p>
<section id="code-7" class="level5">
<h5 class="anchored" data-anchor-id="code-7">Code:</h5>
<div class="sourceCode" id="cb15"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Update the object info for the bounding box</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"objectInfo"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">SetObjectInfo</span><span class="op">(</span>Utils<span class="op">.</span><span class="fu">Object</span> objectInfo<span class="op">)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the object info</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> objectInfo<span class="op">;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the object class label</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    bbox<span class="op">.</span><span class="fu">name</span> <span class="op">=</span> Utils<span class="op">.</span><span class="fu">object_classes</span><span class="op">[</span>objectInfo<span class="op">.</span><span class="fu">label</span><span class="op">].</span><span class="fu">Item1</span><span class="op">;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    text<span class="op">.</span><span class="fu">name</span> <span class="op">=</span> bbox<span class="op">.</span><span class="fu">name</span><span class="op">;</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the object class color</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> Utils<span class="op">.</span><span class="fu">object_classes</span><span class="op">[</span>objectInfo<span class="op">.</span><span class="fu">label</span><span class="op">].</span><span class="fu">Item2</span><span class="op">;</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the label</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeLabel</span><span class="op">();</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the position and dimensions</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeBBox</span><span class="op">();</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="constructor" class="level4">
<h4 class="anchored" data-anchor-id="constructor">Constructor</h4>
<p>There are a few steps we need to take whenever we create a new BoundingBox instance.</p>
<p>First, we need to attach the textContent component to the text object and make the text object a child of the Label Canvas.</p>
<p>Next, we need to add the lineRender component to the bbox object and give it a new material with an Unlit/Color shader.</p>
<p>Lastly, we call the SetObjectInfo() method to update the bounding box and text.</p>
<section id="code-8" class="level5">
<h5 class="anchored" data-anchor-id="code-8">Code:</h5>
<div class="sourceCode" id="cb16"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Constructor for the bounding box</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"objectInfo"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="fu">BoundingBox</span><span class="op">(</span>Utils<span class="op">.</span><span class="fu">Object</span> objectInfo<span class="op">)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add a text component to store the label text</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    textContent <span class="op">=</span> text<span class="op">.</span><span class="fu">AddComponent</span><span class="op">&lt;</span>TextMeshProUGUI<span class="op">&gt;();</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Assign text object to the label canvas</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    text<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">SetParent</span><span class="op">(</span>canvas<span class="op">.</span><span class="fu">transform</span><span class="op">);</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add a line renderer to draw the bounding box</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    lineRenderer <span class="op">=</span> bbox<span class="op">.</span><span class="fu">AddComponent</span><span class="op">&lt;</span>LineRenderer<span class="op">&gt;();</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Make LineRenderer Shader Unlit</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    lineRenderer<span class="op">.</span><span class="fu">material</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Material</span><span class="op">(</span>Shader<span class="op">.</span><span class="fu">Find</span><span class="op">(</span><span class="st">"Unlit/Color"</span><span class="op">));</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the object info for the bounding box</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SetObjectInfo</span><span class="op">(</span>objectInfo<span class="op">);</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="create-objectdetector-script" class="level3">
<h3 class="anchored" data-anchor-id="create-objectdetector-script">Create ObjectDetector Script</h3>
<p>We will implement the functionality for calling the plugin functions and handling the model output in a new script. Open the Scripts folder in the Assets section and create a new C# script called ObjectDetector.</p>
<section id="add-required-namespaces" class="level4">
<h4 class="anchored" data-anchor-id="add-required-namespaces">Add Required Namespaces</h4>
<ul>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system?view=net-5.0">System</a>: Contains fundamental classes and base classes that define commonly-used value and reference data types, events and event handlers, interfaces, attributes, and processing exceptions.</p></li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices?view=net-5.0">System.Runtime.InteropServices</a>: Provides a wide variety of members that support COM interop and platform invoke services.</p></li>
<li><p><a href="https://docs.unity3d.com/Packages/com.unity.ugui@1.0/api/UnityEngine.UI.html">UnityEngine.UI</a>: Provides access to UI elements.</p></li>
<li><p>UnityEngine.Video: Provides access to the functionality for the Video Player component.</p></li>
<li><p><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.core@5.9/api/UnityEngine.Rendering.html">UnityEngine.Rendering</a>: Provides access to the elements of the rendering pipeline.</p></li>
</ul>
<section id="code-9" class="level5">
<h5 class="anchored" data-anchor-id="code-9">Code:</h5>
<div class="sourceCode" id="cb17"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">.</span><span class="fu">Video</span><span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">.</span><span class="fu">Rendering</span><span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Runtime</span><span class="op">.</span><span class="fu">InteropServices</span><span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">.</span><span class="fu">UI</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="add-public-variables" class="level4">
<h4 class="anchored" data-anchor-id="add-public-variables">Add Public Variables</h4>
<ul>
<li><p>videoScreen: We need a reference to the VideoScreen object so that we can update its dimensions and access the VideoPlayer component.</p></li>
<li><p>imageProcessingShader: We need a reference to the imageProcessing shader so that we can access the FlipXAxis function.</p></li>
<li><p>deviceDropdown: We need access to the device dropdown menu, and update the list of available compute devices.</p></li>
<li><p>modelDropdown: The script will look for available model files when the application first starts. We will update the menu options based on what model files are found.</p></li>
<li><p>videoDropdown:</p></li>
<li><p>inference: The Inference toggle button in the UI will be used to indicate whether we want to execute the mode or just play the video feed.</p></li>
<li><p>useWebcam: The Webcam toggle button in the UI will be used to switch between using a video file or webcam feed as input for the model.</p></li>
<li><p>useAsync: The Use Async toggle button will be used to turn asynchronous GPU readback on and off (more on this later).</p></li>
<li><p>consoleText: We don’t have direct access to the console while running the application. However, we can capture the text that gets sent to the console and display it in the user interface. This can be useful for debugging purposes.</p></li>
<li><p>videoClips: We will select which video files we want to have available in the Inspector tab.</p></li>
</ul>
<section id="code-10" class="level5">
<h5 class="anchored" data-anchor-id="code-10">Code:</h5>
<div class="sourceCode" id="cb18"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"The screen for viewing preprocessed images"</span><span class="op">)]</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Transform videoScreen<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Performs the preprocessing steps"</span><span class="op">)]</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> ComputeShader imageProcessingShader<span class="op">;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Switch between the available compute devices for OpenVINO"</span><span class="op">)]</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> TMPro<span class="op">.</span><span class="fu">TMP_Dropdown</span> deviceDropdown<span class="op">;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Switch between the available OpenVINO models"</span><span class="op">)]</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> TMPro<span class="op">.</span><span class="fu">TMP_Dropdown</span> modelDropdown<span class="op">;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Switch between the available video files"</span><span class="op">)]</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> TMPro<span class="op">.</span><span class="fu">TMP_Dropdown</span> videoDropdown<span class="op">;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Turn stylization on and off"</span><span class="op">)]</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Toggle inference<span class="op">;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Use webcam feed as input"</span><span class="op">)]</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Toggle useWebcam<span class="op">;</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Turn AsyncGPUReadback on and off"</span><span class="op">)]</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Toggle useAsync<span class="op">;</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"Text area to display console output"</span><span class="op">)]</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Text consoleText<span class="op">;</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Tooltip</span><span class="op">(</span><span class="st">"List of available video files"</span><span class="op">)]</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> VideoClip<span class="op">[]</span> videoClips<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-dll-method-declarations" class="level4">
<h4 class="anchored" data-anchor-id="create-dll-method-declarations">Create DLL Method Declarations</h4>
<p>We need to specify the name of the .dll file. We’ll store this in a const string variable called dll.</p>
<p>We can indicate that a given method is from a DLL by using the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.dllimportattribute?view=net-5.0">DllImport</a> attribute.</p>
<p><strong>Note:</strong> The DLL functions that return string values have <a href="https://docs.microsoft.com/en-us/dotnet/api/system.intptr?view=net-5.0">IntPtr</a> as their return values here. We will use the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.marshal.ptrtostringansi?view=net-5.0">Marshal.PtrToStringAnsi()</a> method to get that string value at the memory location stored in the pointer.</p>
<section id="code-11" class="level5">
<h5 class="anchored" data-anchor-id="code-11">Code:</h5>
<div class="sourceCode" id="cb19"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Name of the DLL file</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">string</span> dll <span class="op">=</span> <span class="st">"OpenVINO_YOLOX_DLL"</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> IntPtr <span class="fu">GetAvailableDevices</span><span class="op">();</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> IntPtr <span class="fu">InitOpenVINO</span><span class="op">(</span><span class="dt">string</span> model<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">,</span> <span class="dt">int</span> device<span class="op">);</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">PerformInference</span><span class="op">(</span>IntPtr inputData<span class="op">);</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">PopulateObjectsArray</span><span class="op">(</span>IntPtr objects<span class="op">);</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">int</span> <span class="fu">GetObjectCount</span><span class="op">();</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">SetNMSThreshold</span><span class="op">(</span><span class="dt">float</span> threshold<span class="op">);</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">SetConfidenceThreshold</span><span class="op">(</span><span class="dt">float</span> threshold<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="add-private-variables" class="level4">
<h4 class="anchored" data-anchor-id="add-private-variables">Add Private Variables</h4>
<ul>
<li><p>webcamDims: We will set the target resolution for a webcam to 1280x720</p></li>
<li><p>videoDims: We need to keep track of the dimensions of the video screen for different methods in the script.</p></li>
<li><p>targetDims: We will set the default target dims to 640x640. However, this will get updated to maintain the aspect ratio for the current video source.</p></li>
<li><p>imageDims: This will store the unpadded dimensions of the image being fed to the model.</p></li>
<li><p>webcamTexture: This will provide access to live video input from a webcam.</p></li>
<li><p>videoTexture: This will store the current source video texture.</p></li>
<li><p>rTex: This will store the texture used to create the input texture.</p></li>
<li><p>inputTex: This contains the input texture that will be sent to the OpenVINO inference engine.</p></li>
<li><p>performInference: Keeps track of whether to execute the OpenVINO model.</p></li>
<li><p>webcamFPS: We will set the target frame rate for the webcam to 60fps.</p></li>
<li><p>aspectRatioScale: Used to scale the input image dimensions while maintaining aspect ratio.</p></li>
<li><p>currentDevice: Current compute device for OpenVINO.</p></li>
<li><p>inputData: Stores the raw pixel data for inputTex.</p></li>
<li><p>objectInfoArray: This is the Object array that we will update using the PopulateObjectsArray() function in the plugin.</p></li>
<li><p>boundingBoxes: Stores the bounding boxes for detected objects.</p></li>
<li><p>deviceList: Parsed list of compute devices for OpenVINO.</p></li>
<li><p>openVINOPaths: File paths for the OpenVINO IR models</p></li>
<li><p>openvinoModels: Names of the OpenVINO IR model</p></li>
<li><p>videoNames: Names of the available video files</p></li>
<li><p>canvas: A reference to the canvas for the user interface</p></li>
<li><p>graphy: A reference to the Graphy on-screen metrics</p></li>
<li><p>width: A references to the width input field for the target image dimensions</p></li>
<li><p>height: A references to the height input field for the target image dimensions</p></li>
</ul>
<section id="code-12" class="level5">
<h5 class="anchored" data-anchor-id="code-12">Code:</h5>
<div class="sourceCode" id="cb20"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// The requested webcam dimensions</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Vector2Int webcamDims <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">(</span><span class="dv">1280</span><span class="op">,</span> <span class="dv">720</span><span class="op">);</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">// The dimensions of the current video source</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Vector2Int videoDims<span class="op">;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">// The targrt resolution for input images</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Vector2Int targetDims <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">(</span><span class="dv">640</span><span class="op">,</span> <span class="dv">640</span><span class="op">);</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">// The unpadded dimensions of the image being fed to the model</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Vector2Int imageDims <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Live video input from a webcam</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> WebCamTexture webcamTexture<span class="op">;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">// The source video texture</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> RenderTexture videoTexture<span class="op">;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">// The texture used to create the input texture</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> RenderTexture rTex<span class="op">;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Contains the input texture that will be sent to the OpenVINO inference engine</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Texture2D inputTex<span class="op">;</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Keeps track of whether to execute the OpenVINO model</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">bool</span> performInference <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">// The requested webcam frame rate</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">int</span> webcamFPS <span class="op">=</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Used to scale the input image dimensions while maintaining aspect ratio</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">float</span> aspectRatioScale<span class="op">;</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Current compute device for OpenVINO</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span> currentDevice<span class="op">;</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the raw pixel data for inputTex</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">byte</span><span class="op">[]</span> inputData<span class="op">;</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores information about detected objects</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Utils<span class="op">.</span><span class="fu">Object</span><span class="op">[]</span> objectInfoArray<span class="op">;</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Stores the bounding boxes for detected objects</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> List<span class="op">&lt;</span>BoundingBox<span class="op">&gt;</span> boundingBoxes <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>BoundingBox<span class="op">&gt;();</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co">// Parsed list of compute devices for OpenVINO</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> deviceList <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="co">// File paths for the OpenVINO IR models</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> openVINOPaths <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="co">// Names of the OpenVINO IR model</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> openvinoModels <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="co">// Names of the available video files </span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> videoNames <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="co">// A reference to the canvas for the user interface</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> GameObject canvas<span class="op">;</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="co">// A reference to the Graphy on-screen metrics</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> GameObject graphy<span class="op">;</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co">// References to input fields for the target image dimensions</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> TMPro<span class="op">.</span><span class="fu">TMP_InputField</span> width<span class="op">;</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> TMPro<span class="op">.</span><span class="fu">TMP_InputField</span> height<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-log-method" class="level4">
<h4 class="anchored" data-anchor-id="create-log-method">Create Log() Method</h4>
<p>We can capture the console output using the <a href="https://docs.unity3d.com/ScriptReference/Application-logMessageReceived.html">Applications.logMessageReceived</a> callback. We just need to append a function call to this callback that updates consoleText with the latest console message. This function will be called every time a log message is received. All it does is append the latest console message to the existing text for consoleText.</p>
<section id="code-13" class="level5">
<h5 class="anchored" data-anchor-id="code-13">Code:</h5>
<div class="sourceCode" id="cb21"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Updates on-screen console text</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"logString"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"stackTrace"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"type"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Log</span><span class="op">(</span><span class="dt">string</span> logString<span class="op">,</span> <span class="dt">string</span> stackTrace<span class="op">,</span> LogType type<span class="op">)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    consoleText<span class="op">.</span><span class="fu">text</span> <span class="op">=</span> consoleText<span class="op">.</span><span class="fu">text</span> <span class="op">+</span> <span class="st">"</span><span class="sc">\n</span><span class="st"> "</span> <span class="op">+</span> logString<span class="op">;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="define-onenable-method" class="level4">
<h4 class="anchored" data-anchor-id="define-onenable-method">Define OnEnable() Method</h4>
<p>We will append the Log() method to the <a href="https://docs.unity3d.com/ScriptReference/Application-logMessageReceived.html">Applications.logMessageReceived</a> callback in the <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnEnable.html">OnEnable()</a> method. The <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnEnable.html">OnEnable()</a> method is called when the GameObject the script is attached to becomes enabled.</p>
<section id="code-14" class="level5">
<h5 class="anchored" data-anchor-id="code-14">Code:</h5>
<div class="sourceCode" id="cb22"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Called when the object becomes enabled and active</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">OnEnable</span><span class="op">()</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    Application<span class="op">.</span><span class="fu">logMessageReceived</span> <span class="op">+=</span> Log<span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-initializevideoscreen-method" class="level4">
<h4 class="anchored" data-anchor-id="create-initializevideoscreen-method">Create InitializeVideoScreen() Method</h4>
<p>We will update the position, orientation, and size of the VideoScreen object in a new method called InitializeVideoScreen. The method will take in width and height values.</p>
<p>First, we will set the video player component to render to a RenderTexture and set videoTexture as the target texture.</p>
<p>The default <a href="https://docs.unity3d.com/ScriptReference/Shader.html">shader</a> assigned to the VideoScreen object needs to be replaced with an Unlit/Texture shader. This will remove the need for the screen to be lit by an in-game light.</p>
<p>Lastly, we will update the dimension and position of the VideoScreen object.</p>
<section id="code-15" class="level5">
<h5 class="anchored" data-anchor-id="code-15">Code:</h5>
<div class="sourceCode" id="cb23"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Prepares the videoScreen GameObject to display the chosen video source.</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"width"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"height"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"mirrorScreen"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializeVideoScreen</span><span class="op">(</span><span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the render mode for the video player</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    videoScreen<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>VideoPlayer<span class="op">&gt;().</span><span class="fu">renderMode</span> <span class="op">=</span> VideoRenderMode<span class="op">.</span><span class="fu">RenderTexture</span><span class="op">;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use new videoTexture for Video Player</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    videoScreen<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>VideoPlayer<span class="op">&gt;().</span><span class="fu">targetTexture</span> <span class="op">=</span> videoTexture<span class="op">;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply the new videoTexture to the VideoScreen Gameobject</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    videoScreen<span class="op">.</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>MeshRenderer<span class="op">&gt;().</span><span class="fu">material</span><span class="op">.</span><span class="fu">shader</span> <span class="op">=</span> Shader<span class="op">.</span><span class="fu">Find</span><span class="op">(</span><span class="st">"Unlit/Texture"</span><span class="op">);</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    videoScreen<span class="op">.</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>MeshRenderer<span class="op">&gt;().</span><span class="fu">material</span><span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span><span class="st">"_MainTex"</span><span class="op">,</span> videoTexture<span class="op">);</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the VideoScreen dimensions for the new videoTexture</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    videoScreen<span class="op">.</span><span class="fu">localScale</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>width<span class="op">,</span> height<span class="op">,</span> videoScreen<span class="op">.</span><span class="fu">localScale</span><span class="op">.</span><span class="fu">z</span><span class="op">);</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the VideoScreen position for the new videoTexture</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    videoScreen<span class="op">.</span><span class="fu">position</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-initializewebcam-method" class="level4">
<h4 class="anchored" data-anchor-id="create-initializewebcam-method">Create InitializeWebcam() Method</h4>
<p>When using a webcam, we will first initialize the webcamTexture with the target resolution and framerate. We will not know if the target resolution is supported by the webcam until we try playing it.</p>
<p>If there is no physical webcam available, Unity may try using a virtual camera from applications like <a href="https://obsproject.com/">OBS</a>. We can tell when this happens by checking the actual dimensions of the webcamTexture. If the resolution is set to 16x16, then it is safe to say something went wrong. When this happens, we will disable the webcam functionality.</p>
<p>If the webcamTexture is properly initialized, we will limit the target framerate to the same as the target frame rate for the webcam. This can help the application run more smoothly.</p>
<p>We will also disable the Video Player component. Lastly, we will update the values for videoDims with the final dimensions for the webcamTexture.</p>
<section id="code-16" class="level5">
<h5 class="anchored" data-anchor-id="code-16">Code:</h5>
<div class="sourceCode" id="cb24"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Try to initialize and start a webcam</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializeWebcam</span><span class="op">()</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a new WebCamTexture</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    webcamTexture <span class="op">=</span> <span class="kw">new</span> <span class="fu">WebCamTexture</span><span class="op">(</span>webcamDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> webcamDims<span class="op">.</span><span class="fu">y</span><span class="op">,</span> webcamFPS<span class="op">);</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start the Camera</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    webcamTexture<span class="op">.</span><span class="fu">Play</span><span class="op">();</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>webcamTexture<span class="op">.</span><span class="fu">width</span> <span class="op">==</span> <span class="dv">16</span><span class="op">)</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        webcamTexture<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Unable to initialize a webcam. Disabling option.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        useWebcam<span class="op">.</span><span class="fu">isOn</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        useWebcam<span class="op">.</span><span class="fu">enabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Limit application framerate to the target webcam framerate</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        Application<span class="op">.</span><span class="fu">targetFrameRate</span> <span class="op">=</span> webcamFPS<span class="op">;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Deactivate the Video Player</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        videoScreen<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>VideoPlayer<span class="op">&gt;().</span><span class="fu">enabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update the videoDims.y</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        videoDims<span class="op">.</span><span class="fu">y</span> <span class="op">=</span> webcamTexture<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update the videoDims.x</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>        videoDims<span class="op">.</span><span class="fu">x</span> <span class="op">=</span> webcamTexture<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-initializecamera-method" class="level4">
<h4 class="anchored" data-anchor-id="create-initializecamera-method">Create InitializeCamera() Method</h4>
<p>Once the VideoScreen has been updated, either for a video or webcam feed, we need to resize and reposition the in-game camera. We will do so in a new method called InitializeCamera.</p>
<p>We can access the Main Camera object with <a href="https://docs.unity3d.com/ScriptReference/GameObject.Find.html">GameObject.Find(“Main Camera”)</a>. We will set the X and Y coordinates to the same as the VideoScreen position.</p>
<p>The camera also needs to be set to <a href="https://docs.unity3d.com/ScriptReference/Camera-orthographic.html">orthographic</a> mode to remove perspective.</p>
<p>Lastly, we need to update the size of the camera. The <a href="https://docs.unity3d.com/ScriptReference/Camera-orthographicSize.html">orthographicSize</a> attribute is actually the half size, so we need to divide videoDims.y (i.e.&nbsp;the height) by 2 as well.</p>
<section id="code-17" class="level5">
<h5 class="anchored" data-anchor-id="code-17">Code:</h5>
<div class="sourceCode" id="cb25"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Resizes and positions the in-game Camera to accommodate the video dimensions</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializeCamera</span><span class="op">()</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get a reference to the Main Camera GameObject</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    GameObject mainCamera <span class="op">=</span> GameObject<span class="op">.</span><span class="fu">Find</span><span class="op">(</span><span class="st">"Main Camera"</span><span class="op">);</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the camera position to account for updates to the VideoScreen</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    mainCamera<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">position</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>videoDims<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> videoDims<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span>10f<span class="op">);</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Render objects with no perspective (i.e. 2D)</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    mainCamera<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>Camera<span class="op">&gt;().</span><span class="fu">orthographic</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the camera size to account for updates to the VideoScreen</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> orthographicSize<span class="op">;</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(((</span><span class="dt">float</span><span class="op">)</span>Screen<span class="op">.</span><span class="fu">width</span> <span class="op">/</span> Screen<span class="op">.</span><span class="fu">height</span><span class="op">)</span> <span class="op">&lt;</span> <span class="op">((</span><span class="dt">float</span><span class="op">)</span>videoDims<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> videoDims<span class="op">.</span><span class="fu">y</span><span class="op">)){</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> scale <span class="op">=</span> <span class="op">((</span><span class="dt">float</span><span class="op">)</span>Screen<span class="op">.</span><span class="fu">width</span> <span class="op">/</span> Screen<span class="op">.</span><span class="fu">height</span><span class="op">)</span> <span class="op">/</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">((</span><span class="dt">float</span><span class="op">)</span>videoDims<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> videoDims<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        orthographicSize <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)((</span>videoDims<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="dv">2</span><span class="op">)</span> <span class="op">/</span> scale<span class="op">);</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        orthographicSize <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>videoDims<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Orthographic Size: {orthographicSize}"</span><span class="op">);</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    mainCamera<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>Camera<span class="op">&gt;().</span><span class="fu">orthographicSize</span> <span class="op">=</span> orthographicSize<span class="op">;</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-initializetextures-method" class="level4">
<h4 class="anchored" data-anchor-id="create-initializetextures-method">Create InitializeTextures() Method</h4>
<p>Whenever the target input resolution is updated, we need to make sure that it maintains the same aspect ratio as the source video or webcam feed. Feeding a stretched or squashed image to the model could impact the model’s accuracy.</p>
<p>Once we have adjusted the target input resolution, we can update rTex and inputTex with the new dimensions. We will also update the width and height input fields to make sure the user knows the adjusted resolution.</p>
<section id="code-18" class="level5">
<h5 class="anchored" data-anchor-id="code-18">Code:</h5>
<div class="sourceCode" id="cb26"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Calculate the dimensions for the input image</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"newVideo"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializeTextures</span><span class="op">(</span><span class="dt">bool</span> newVideo <span class="op">=</span> <span class="kw">false</span><span class="op">)</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>newVideo<span class="op">)</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Calculate scale for new  aspect ratio</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> min <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>videoTexture<span class="op">.</span><span class="fu">width</span><span class="op">,</span> videoTexture<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> max <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Max</span><span class="op">(</span>videoTexture<span class="op">.</span><span class="fu">width</span><span class="op">,</span> videoTexture<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        aspectRatioScale <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>min <span class="op">/</span> max<span class="op">;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Adjust the smallest input dimension to maintain the new aspect ratio</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>max <span class="op">==</span> videoTexture<span class="op">.</span><span class="fu">height</span><span class="op">)</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>            imageDims<span class="op">.</span><span class="fu">x</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>targetDims<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> aspectRatioScale<span class="op">);</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>            imageDims<span class="op">.</span><span class="fu">y</span> <span class="op">=</span> targetDims<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>            imageDims<span class="op">.</span><span class="fu">y</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>targetDims<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> aspectRatioScale<span class="op">);</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>            imageDims<span class="op">.</span><span class="fu">x</span> <span class="op">=</span> targetDims<span class="op">.</span><span class="fu">x</span><span class="op">;</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Adjust the input dimensions to maintain the current aspect ratio</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>imageDims<span class="op">.</span><span class="fu">x</span> <span class="op">!=</span> targetDims<span class="op">.</span><span class="fu">x</span><span class="op">)</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>            imageDims<span class="op">.</span><span class="fu">x</span> <span class="op">=</span> targetDims<span class="op">.</span><span class="fu">x</span><span class="op">;</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>            aspectRatioScale <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>videoTexture<span class="op">.</span><span class="fu">height</span> <span class="op">/</span> videoTexture<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>            imageDims<span class="op">.</span><span class="fu">y</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>targetDims<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> aspectRatioScale<span class="op">);</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>            targetDims<span class="op">.</span><span class="fu">y</span> <span class="op">=</span> imageDims<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>imageDims<span class="op">.</span><span class="fu">y</span> <span class="op">!=</span> targetDims<span class="op">.</span><span class="fu">y</span><span class="op">)</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>            imageDims<span class="op">.</span><span class="fu">y</span> <span class="op">=</span> targetDims<span class="op">.</span><span class="fu">y</span><span class="op">;</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>            aspectRatioScale <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>videoTexture<span class="op">.</span><span class="fu">width</span> <span class="op">/</span> videoTexture<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>            imageDims<span class="op">.</span><span class="fu">x</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>targetDims<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> aspectRatioScale<span class="op">);</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>            targetDims<span class="op">.</span><span class="fu">x</span> <span class="op">=</span> imageDims<span class="op">.</span><span class="fu">x</span><span class="op">;</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the RenderTexture that will store the processed input image</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>    rTex <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>imageDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> imageDims<span class="op">.</span><span class="fu">y</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">ARGB32</span><span class="op">);</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update inputTex with the new dimensions</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>    inputTex <span class="op">=</span> <span class="kw">new</span> <span class="fu">Texture2D</span><span class="op">(</span>imageDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> imageDims<span class="op">.</span><span class="fu">y</span><span class="op">,</span> TextureFormat<span class="op">.</span><span class="fu">RGBA32</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the values for the width and height input fields</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Setting Input Dims to W: {imageDims.x} x H: {imageDims.y}"</span><span class="op">);</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>    width<span class="op">.</span><span class="fu">text</span> <span class="op">=</span> $<span class="st">"{imageDims.x}"</span><span class="op">;</span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>    height<span class="op">.</span><span class="fu">text</span> <span class="op">=</span> $<span class="st">"{imageDims.y}"</span><span class="op">;</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-initializedropdowns-method" class="level4">
<h4 class="anchored" data-anchor-id="create-initializedropdowns-method">Create InitializeDropDowns() Method</h4>
<p>This method will simply clear the default options for the dropdown menus in the UI, add the current options, and select the first option in the list.</p>
<section id="code-19" class="level5">
<h5 class="anchored" data-anchor-id="code-19">Code:</h5>
<div class="sourceCode" id="cb27"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Initialize the options for the dropdown menus</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializeDropdowns</span><span class="op">()</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove default dropdown options</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    deviceDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add OpenVINO compute devices to dropdown</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    deviceDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>deviceList<span class="op">);</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the dropdown to the current compute device</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    deviceDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span>deviceList<span class="op">.</span><span class="fu">IndexOf</span><span class="op">(</span>currentDevice<span class="op">));</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove default dropdown options</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    videoDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add OpenVINO models to menu</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    videoDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>videoNames<span class="op">);</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the first option in the dropdown</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    videoDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove default dropdown options</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    modelDropdown<span class="op">.</span><span class="fu">ClearOptions</span><span class="op">();</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add OpenVINO models to menu</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    modelDropdown<span class="op">.</span><span class="fu">AddOptions</span><span class="op">(</span>openvinoModels<span class="op">);</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the first option in the dropdown</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    modelDropdown<span class="op">.</span><span class="fu">SetValueWithoutNotify</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-initializeopenvino-method" class="level4">
<h4 class="anchored" data-anchor-id="create-initializeopenvino-method">Create InitializeOpenVINO() Method</h4>
<p>We will call the InitiOpenVINO() function from the plugin in a new method called InitializeOpenVINO(). The InitiOpenVINO() function will only be called when the inference toggle is checked.</p>
<section id="code-20" class="level5">
<h5 class="anchored" data-anchor-id="code-20">Code:</h5>
<div class="sourceCode" id="cb28"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when a model option is selected from the dropdown</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">InitializeOpenVINO</span><span class="op">()</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Only initialize OpenVINO when performing inference</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>performInference <span class="op">==</span> <span class="kw">false</span><span class="op">)</span> <span class="kw">return</span><span class="op">;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Initializing OpenVINO"</span><span class="op">);</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Selected Model: {openvinoModels[modelDropdown.value]}"</span><span class="op">);</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Selected Model Path: {openVINOPaths[modelDropdown.value]}"</span><span class="op">);</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Setting Input Dims to W: {imageDims.x} x H: {imageDims.y}"</span><span class="op">);</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Uploading IR Model to Compute Device"</span><span class="op">);</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set up the neural network for the OpenVINO inference engine</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    currentDevice <span class="op">=</span> Marshal<span class="op">.</span><span class="fu">PtrToStringAnsi</span><span class="op">(</span><span class="fu">InitOpenVINO</span><span class="op">(</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        openVINOPaths<span class="op">[</span>modelDropdown<span class="op">.</span><span class="fu">value</span><span class="op">],</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>        inputTex<span class="op">.</span><span class="fu">width</span><span class="op">,</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>        inputTex<span class="op">.</span><span class="fu">height</span><span class="op">,</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>        deviceDropdown<span class="op">.</span><span class="fu">value</span><span class="op">));</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"OpenVINO using: {currentDevice}"</span><span class="op">);</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-initializationsteps-method" class="level4">
<h4 class="anchored" data-anchor-id="create-initializationsteps-method">Create InitializationSteps() Method</h4>
<p>We will call the initialization methods in a new method called InitializationSteps(). This method will be called each time the model input is updated. This could be from changing the target input resolution, selecting a different video, or switching between using a webcam.</p>
<section id="code-21" class="level5">
<h5 class="anchored" data-anchor-id="code-21">Code:</h5>
<div class="sourceCode" id="cb29"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Perform the initialization steps required when the model input is updated</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">InitializationSteps</span><span class="op">()</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>useWebcam<span class="op">.</span><span class="fu">isOn</span><span class="op">)</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialize webcam</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">InitializeWebcam</span><span class="op">();</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Selected Video: {videoDropdown.value}"</span><span class="op">);</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set Initial video clip</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        videoScreen<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>VideoPlayer<span class="op">&gt;().</span><span class="fu">clip</span> <span class="op">=</span> videoClips<span class="op">[</span>videoDropdown<span class="op">.</span><span class="fu">value</span><span class="op">];</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update the videoDims.y</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        videoDims<span class="op">.</span><span class="fu">y</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>videoScreen<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>VideoPlayer<span class="op">&gt;().</span><span class="fu">height</span><span class="op">;</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update the videoDims.x</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>        videoDims<span class="op">.</span><span class="fu">x</span> <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>videoScreen<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>VideoPlayer<span class="op">&gt;().</span><span class="fu">width</span><span class="op">;</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a new videoTexture using the current video dimensions</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    videoTexture <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>videoDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> videoDims<span class="op">.</span><span class="fu">y</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> RenderTextureFormat<span class="op">.</span><span class="fu">ARGB32</span><span class="op">);</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the videoScreen</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeVideoScreen</span><span class="op">(</span>videoDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> videoDims<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adjust the camera based on the source video dimensions</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeCamera</span><span class="op">();</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the textures that store the model input</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeTextures</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set up the neural network for the OpenVINO inference engine</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeOpenVINO</span><span class="op">();</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-getopenvinomodels" class="level4">
<h4 class="anchored" data-anchor-id="create-getopenvinomodels">Create GetOpenVINOModels()</h4>
<p>Before we can perform the initialization steps, we need to get a list of available OpenVINO models. The models folder from part 1 of this tutorial will be placed in the same directory as the executable for the Unity application. We will search through the subfolders to obtain the paths to the .xml model files.</p>
<p>The actual .xml files are all named yolox_10.xml, so we will use the names of their respective parent directories for the dropdown menu options.</p>
<section id="code-22" class="level5">
<h5 class="anchored" data-anchor-id="code-22">Code:</h5>
<div class="sourceCode" id="cb30"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Get the list of available OpenVINO models</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">GetOpenVINOModels</span><span class="op">()</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the subdirectories containing the available models</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span><span class="op">[]</span> modelDirs <span class="op">=</span> System<span class="op">.</span><span class="fu">IO</span><span class="op">.</span><span class="fu">Directory</span><span class="op">.</span><span class="fu">GetDirectories</span><span class="op">(</span><span class="st">"models"</span><span class="op">);</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the model files in each subdirectory</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> openVINOFiles <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> dir <span class="kw">in</span> modelDirs<span class="op">)</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        openVINOFiles<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>System<span class="op">.</span><span class="fu">IO</span><span class="op">.</span><span class="fu">Directory</span><span class="op">.</span><span class="fu">GetFiles</span><span class="op">(</span>dir<span class="op">));</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the paths for the .xml files for each model</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Available OpenVINO Models:"</span><span class="op">);</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> file <span class="kw">in</span> openVINOFiles<span class="op">)</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>file<span class="op">.</span><span class="fu">EndsWith</span><span class="op">(</span><span class="st">".xml"</span><span class="op">))</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>            openVINOPaths<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>file<span class="op">);</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">string</span> modelName <span class="op">=</span> file<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="ch">'\\'</span><span class="op">)[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>            openvinoModels<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>modelName<span class="op">.</span><span class="fu">Substring</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> modelName<span class="op">.</span><span class="fu">Length</span><span class="op">));</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Model Name: {modelName}"</span><span class="op">);</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"File Path: {file}"</span><span class="op">);</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">""</span><span class="op">);</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="define-start-method" class="level4">
<h4 class="anchored" data-anchor-id="define-start-method">Define Start() Method</h4>
<p>When the application starts, we will get references to the canvas, graphy, width, and height objects in the Hierarchy tab.</p>
<p>The OpenVINO plugin project has only been tested on Intel hardware, so we will confirm that Intel hardware is available. If it is, we will get the available OpenVINO models and call the GetAvailableDevices() function to see what compute devices are available for OpenVINO.</p>
<p>If there is no Intel hardware available, we will disable the option to perform inference, but still call the other initialization steps.</p>
<section id="code-23" class="level5">
<h5 class="anchored" data-anchor-id="code-23">Code:</h5>
<div class="sourceCode" id="cb31"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Start is called before the first frame update</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get references to GameObjects in hierarchy</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    canvas <span class="op">=</span> GameObject<span class="op">.</span><span class="fu">Find</span><span class="op">(</span><span class="st">"Canvas"</span><span class="op">);</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    graphy <span class="op">=</span> GameObject<span class="op">.</span><span class="fu">Find</span><span class="op">(</span><span class="st">"[Graphy]"</span><span class="op">);</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> GameObject<span class="op">.</span><span class="fu">Find</span><span class="op">(</span><span class="st">"Width"</span><span class="op">).</span><span class="fu">GetComponent</span><span class="op">&lt;</span>TMPro<span class="op">.</span><span class="fu">TMP_InputField</span><span class="op">&gt;();</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> GameObject<span class="op">.</span><span class="fu">Find</span><span class="op">(</span><span class="st">"Height"</span><span class="op">).</span><span class="fu">GetComponent</span><span class="op">&lt;</span>TMPro<span class="op">.</span><span class="fu">TMP_InputField</span><span class="op">&gt;();</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if either the CPU of GPU is made by Intel</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> processorType <span class="op">=</span> SystemInfo<span class="op">.</span><span class="fu">processorType</span><span class="op">.</span><span class="fu">ToString</span><span class="op">();</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> graphicsDeviceName <span class="op">=</span> SystemInfo<span class="op">.</span><span class="fu">graphicsDeviceName</span><span class="op">.</span><span class="fu">ToString</span><span class="op">();</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>processorType<span class="op">.</span><span class="fu">Contains</span><span class="op">(</span><span class="st">"Intel"</span><span class="op">)</span> <span class="op">||</span> graphicsDeviceName<span class="op">.</span><span class="fu">Contains</span><span class="op">(</span><span class="st">"Intel"</span><span class="op">))</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the list of available models</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">GetOpenVINOModels</span><span class="op">();</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get an unparsed list of available </span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> openvinoDevices <span class="op">=</span> Marshal<span class="op">.</span><span class="fu">PtrToStringAnsi</span><span class="op">(</span><span class="fu">GetAvailableDevices</span><span class="op">());</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Available Devices:"</span><span class="op">);</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Parse list of available compute devices</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> device <span class="kw">in</span> openvinoDevices<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="ch">','</span><span class="op">))</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Add device name to list</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>            deviceList<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>device<span class="op">);</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>device<span class="op">);</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        inference<span class="op">.</span><span class="fu">isOn</span> <span class="op">=</span> performInference <span class="op">=</span> inference<span class="op">.</span><span class="fu">enabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"No Intel hardware detected"</span><span class="op">);</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the names of the video clips</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>VideoClip clip <span class="kw">in</span> videoClips<span class="op">)</span> videoNames<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>clip<span class="op">.</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the dropdown menus</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeDropdowns</span><span class="op">();</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perform the required </span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializationSteps</span><span class="op">();</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-flipimage-method" class="level4">
<h4 class="anchored" data-anchor-id="create-flipimage-method">Create FlipImage() Method</h4>
<p>Next, we’ll make a new method to execute the FlipXAxis() function in our ComputeShader. This method will take in the image that needs to be processed as well as a function name to indicate which function we want to execute.</p>
<section id="method-steps" class="level5">
<h5 class="anchored" data-anchor-id="method-steps">Method Steps</h5>
<ol type="1">
<li><p>Get the ComputeShader index for the specified function</p></li>
<li><pre><code>Create a temporary RenderTexture with random write access enabled to store the processed image</code></pre></li>
<li><p>Execute the ComputeShader</p></li>
<li><pre><code>Copy the processed image back into the original RenderTexture</code></pre></li>
<li><pre><code>Release the temporary RenderTexture</code></pre></li>
</ol>
</section>
<section id="code-24" class="level5">
<h5 class="anchored" data-anchor-id="code-24">Code:</h5>
<div class="sourceCode" id="cb35"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Perform a flip operation of the GPU</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"image"</span><span class="kw">&gt;</span><span class="co">The image to be flipped</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"tempTex"</span><span class="kw">&gt;</span><span class="co">Stores the flipped image</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"functionName"</span><span class="kw">&gt;</span><span class="co">The name of the function to execute in the compute shader</span><span class="kw">&lt;/param&gt;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">FlipImage</span><span class="op">(</span>RenderTexture image<span class="op">,</span> <span class="dt">string</span> functionName<span class="op">)</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Specify the number of threads on the GPU</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numthreads <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the index for the PreprocessResNet function in the ComputeShader</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> kernelHandle <span class="op">=</span> imageProcessingShader<span class="op">.</span><span class="fu">FindKernel</span><span class="op">(</span>functionName<span class="op">);</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Allocate a temporary RenderTexture</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    RenderTexture result <span class="op">=</span> RenderTexture<span class="op">.</span><span class="fu">GetTemporary</span><span class="op">(</span>image<span class="op">.</span><span class="fu">width</span><span class="op">,</span> image<span class="op">.</span><span class="fu">height</span><span class="op">,</span> <span class="dv">24</span><span class="op">,</span> image<span class="op">.</span><span class="fu">format</span><span class="op">);</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Enable random write access</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    result<span class="op">.</span><span class="fu">enableRandomWrite</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create the RenderTexture</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    result<span class="op">.</span><span class="fu">Create</span><span class="op">();</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the Result variable in the ComputeShader</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    imageProcessingShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"Result"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the InputImage variable in the ComputeShader</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    imageProcessingShader<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>kernelHandle<span class="op">,</span> <span class="st">"InputImage"</span><span class="op">,</span> image<span class="op">);</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the height variable in the ComputeShader</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    imageProcessingShader<span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"height"</span><span class="op">,</span> image<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the value for the width variable in the ComputeShader</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    imageProcessingShader<span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"width"</span><span class="op">,</span> image<span class="op">.</span><span class="fu">width</span><span class="op">);</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Execute the ComputeShader</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    imageProcessingShader<span class="op">.</span><span class="fu">Dispatch</span><span class="op">(</span>kernelHandle<span class="op">,</span> image<span class="op">.</span><span class="fu">width</span> <span class="op">/</span> numthreads<span class="op">,</span> image<span class="op">.</span><span class="fu">height</span> <span class="op">/</span> numthreads<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Copy the flipped image to tempTex</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>result<span class="op">,</span> image<span class="op">);</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Release the temporary RenderTexture</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    RenderTexture<span class="op">.</span><span class="fu">ReleaseTemporary</span><span class="op">(</span>result<span class="op">);</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-oncompletereadback-callback" class="level4">
<h4 class="anchored" data-anchor-id="create-oncompletereadback-callback">Create OnCompleteReadback() Callback</h4>
<p>We currently need to download the pixel data for tempTex from the GPU to the CPU. This normally causes a <a href="https://en.wikipedia.org/wiki/Pipeline_stall">pipeline stall</a> as Unity prevents any execution on the main thread to prevent the data from changing before it has finished downloading to the CPU. This can cause a noticeable performance bottleneck that increases with the amount of pixel data there is to download.</p>
<p>Unity provides an alternative approach with <a href="https://docs.unity3d.com/ScriptReference/Rendering.AsyncGPUReadback.html">AsyncGPUReadback</a> that does not block the main thread. However it adds a few frames of latency. This may or may not matter depending on the specific application.</p>
<p>This function will be called once the AsyncGPUReadback has completed. We can load the raw pixel data from the request directly to inputTex.</p>
<section id="code-25" class="level5">
<h5 class="anchored" data-anchor-id="code-25">Code:</h5>
<div class="sourceCode" id="cb36"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called once AsyncGPUReadback has been completed</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"request"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">OnCompleteReadback</span><span class="op">(</span>AsyncGPUReadbackRequest request<span class="op">)</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>request<span class="op">.</span><span class="fu">hasError</span><span class="op">)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"GPU readback error detected."</span><span class="op">);</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span><span class="op">;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Fill Texture2D with raw data from the AsyncGPUReadbackRequest</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    inputTex<span class="op">.</span><span class="fu">LoadRawTextureData</span><span class="op">(</span>request<span class="op">.</span><span class="fu">GetData</span><span class="op">&lt;</span><span class="dt">uint</span><span class="op">&gt;());</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply changes to Texture2D</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    inputTex<span class="op">.</span><span class="fu">Apply</span><span class="op">();</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-uploadtexture-method" class="level4">
<h4 class="anchored" data-anchor-id="create-uploadtexture-method">Create UploadTexture() Method</h4>
<p>This method is where we will send the current pixel data from inputTex to the OpenVINO plugin. We need to use the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/unsafe">unsafe</a> keyword since we’ll be creating a pointer to the inputData array. Unity does not allow unsafe code by default, so we will need to enable it in the Project Settings.</p>
<p>We need to pin the memory for inputData using a <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/fixed-statement">fixed</a> statement and get a pointer to the variable. We can then call the PerformInference() method with the pointer as input.</p>
<p>After executing the model, we will call the GetObjectCount() so that we can initialize the objectInfoArray.</p>
<p>Lastly, we need to pin the memory for the objectInfoArray, before calling the PopulateObjectsArray() function.</p>
<section id="code-26" class="level5">
<h5 class="anchored" data-anchor-id="code-26">Code:</h5>
<div class="sourceCode" id="cb37"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Pin memory for the input data and send it to OpenVINO for inference</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"inputData"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">unsafe</span> <span class="dt">void</span> <span class="fu">UploadTexture</span><span class="op">(</span><span class="dt">byte</span><span class="op">[]</span> inputData<span class="op">)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Pin Memory</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fixed</span> <span class="op">(</span><span class="dt">byte</span><span class="op">*</span> p <span class="op">=</span> inputData<span class="op">)</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Perform inference</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">PerformInference</span><span class="op">((</span>IntPtr<span class="op">)</span>p<span class="op">);</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the number of detected objects</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> numObjects <span class="op">=</span> <span class="fu">GetObjectCount</span><span class="op">();</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the array</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    objectInfoArray <span class="op">=</span> <span class="kw">new</span> Utils<span class="op">.</span><span class="fu">Object</span><span class="op">[</span>numObjects<span class="op">];</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pin memory</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fixed</span> <span class="op">(</span>Utils<span class="op">.</span><span class="fu">Object</span><span class="op">*</span> o <span class="op">=</span> objectInfoArray<span class="op">)</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get the detected objects</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">PopulateObjectsArray</span><span class="op">((</span>IntPtr<span class="op">)</span>o<span class="op">);</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updateboundingboxes-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updateboundingboxes-method">Create UpdateBoundingBoxes() Method</h4>
<p>After getting the object info for the current output predictions, we can update the boundingBoxes array with the new info. The position and dimensions for the bounding boxes need to be scaled based on the dimensions of the videoTexture. We also need to flip the bounding box coordinates vertically.</p>
<p>Since the model does not keep track of unique objects across video frames, we will just reuse the existing bounding box objects. We will only add new bounding boxes as needed.</p>
<p>We are unlikely to need the same number of bounding boxes all the time, so we will deactivate any extras.</p>
<section id="code-27" class="level5">
<h5 class="anchored" data-anchor-id="code-27">Code:</h5>
<div class="sourceCode" id="cb38"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Update the list of bounding boxes based on the latest output from the model</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">UpdateBoundingBoxes</span><span class="op">()</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Process new detected objects</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> objectInfoArray<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// The smallest dimension of the videoTexture</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> minDimension <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>videoTexture<span class="op">.</span><span class="fu">width</span><span class="op">,</span> videoTexture<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// The value used to scale the bbox locations up to the source resolution</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> scale <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>minDimension <span class="op">/</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>imageDims<span class="op">.</span><span class="fu">x</span><span class="op">,</span> imageDims<span class="op">.</span><span class="fu">y</span><span class="op">);</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Flip the bbox coordinates vertically</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        objectInfoArray<span class="op">[</span>i<span class="op">].</span><span class="fu">y0</span> <span class="op">=</span> rTex<span class="op">.</span><span class="fu">height</span> <span class="op">-</span> objectInfoArray<span class="op">[</span>i<span class="op">].</span><span class="fu">y0</span><span class="op">;</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        objectInfoArray<span class="op">[</span>i<span class="op">].</span><span class="fu">x0</span> <span class="op">*=</span> scale<span class="op">;</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        objectInfoArray<span class="op">[</span>i<span class="op">].</span><span class="fu">y0</span> <span class="op">*=</span> scale<span class="op">;</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        objectInfoArray<span class="op">[</span>i<span class="op">].</span><span class="fu">width</span> <span class="op">*=</span> scale<span class="op">;</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>        objectInfoArray<span class="op">[</span>i<span class="op">].</span><span class="fu">height</span> <span class="op">*=</span> scale<span class="op">;</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update bounding box list with new object info</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">try</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>            boundingBoxes<span class="op">[</span>i<span class="op">].</span><span class="fu">SetObjectInfo</span><span class="op">(</span>objectInfoArray<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">catch</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Add a new bounding box object when needed</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>            boundingBoxes<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">BoundingBox</span><span class="op">(</span>objectInfoArray<span class="op">[</span>i<span class="op">]));</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Turn off extra bounding boxes</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> boundingBoxes<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>i <span class="op">&gt;</span> objectInfoArray<span class="op">.</span><span class="fu">Length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>            boundingBoxes<span class="op">[</span>i<span class="op">].</span><span class="fu">ToggleBBox</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="define-update-method" class="level4">
<h4 class="anchored" data-anchor-id="define-update-method">Define Update() Method</h4>
<p>The UI and performance metrics can take up a lot of the screen. We can toggle the visibility of the UI and metrics using the SetActive() method.</p>
<p>If we are using a webcam, we need to copy the pixel data from the webcamTexture to the videoTexture.</p>
<p>When not performing inference, we will just skip the rest of this method.</p>
<p>When we are performing inference, we need to copy the videoTexture to rTex so that we don’t manipulate the video feed displayed to the viewers.</p>
<p>We can then flip the image, download the pixel data from the CPU to GPU, execute the model, and update the bounding boxes.</p>
<section id="code-28" class="level5">
<h5 class="anchored" data-anchor-id="code-28">Code:</h5>
<div class="sourceCode" id="cb39"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Update is called once per frame</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">Update</span><span class="op">()</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Toggle the user interface</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>Input<span class="op">.</span><span class="fu">GetKeyDown</span><span class="op">(</span><span class="st">"space"</span><span class="op">))</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        canvas<span class="op">.</span><span class="fu">SetActive</span><span class="op">(!</span>canvas<span class="op">.</span><span class="fu">activeInHierarchy</span><span class="op">);</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        graphy<span class="op">.</span><span class="fu">SetActive</span><span class="op">(!</span>graphy<span class="op">.</span><span class="fu">activeInHierarchy</span><span class="op">);</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Copy webcamTexture to videoTexture if using webcam</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>useWebcam<span class="op">.</span><span class="fu">isOn</span><span class="op">)</span> Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>webcamTexture<span class="op">,</span> videoTexture<span class="op">);</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Toggle whether to perform inference</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>performInference <span class="op">==</span> <span class="kw">false</span><span class="op">)</span> <span class="kw">return</span><span class="op">;</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Copy the videoTexture to the rTex RenderTexture</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    Graphics<span class="op">.</span><span class="fu">Blit</span><span class="op">(</span>videoTexture<span class="op">,</span> rTex<span class="op">);</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Flip image before sending to DLL</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">FlipImage</span><span class="op">(</span>rTex<span class="op">,</span> <span class="st">"FlipXAxis"</span><span class="op">);</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Download pixel data from GPU to CPU</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>useAsync<span class="op">.</span><span class="fu">isOn</span><span class="op">)</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>        AsyncGPUReadback<span class="op">.</span><span class="fu">Request</span><span class="op">(</span>rTex<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> TextureFormat<span class="op">.</span><span class="fu">RGBA32</span><span class="op">,</span> OnCompleteReadback<span class="op">);</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>        RenderTexture<span class="op">.</span><span class="fu">active</span> <span class="op">=</span> rTex<span class="op">;</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>        inputTex<span class="op">.</span><span class="fu">ReadPixels</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Rect</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> rTex<span class="op">.</span><span class="fu">width</span><span class="op">,</span> rTex<span class="op">.</span><span class="fu">height</span><span class="op">),</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>        inputTex<span class="op">.</span><span class="fu">Apply</span><span class="op">();</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send reference to inputData to DLL</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">UploadTexture</span><span class="op">(</span>inputTex<span class="op">.</span><span class="fu">GetRawTextureData</span><span class="op">());</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update bounding boxes with new object info</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">UpdateBoundingBoxes</span><span class="op">();</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updateinputdims-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updateinputdims-method">Create UpdateInputDims() Method</h4>
<p>This method will be called when the input dimensions are updated from the user interface. We first need to parse the user input for the width and height input fields and use the values to update targetDims. We can then call InitializeTextures() and InitializeOpenVINO().</p>
<section id="code-29" class="level5">
<h5 class="anchored" data-anchor-id="code-29">Code:</h5>
<div class="sourceCode" id="cb40"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when the input dimensions are updated in the GUI</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateInputDims</span><span class="op">()</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pares the new width value</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> newWidth<span class="op">;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">.</span><span class="fu">TryParse</span><span class="op">(</span>width<span class="op">.</span><span class="fu">text</span><span class="op">,</span> <span class="kw">out</span> newWidth<span class="op">);</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Parse the new height value</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> newHeight<span class="op">;</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">.</span><span class="fu">TryParse</span><span class="op">(</span>height<span class="op">.</span><span class="fu">text</span><span class="op">,</span> <span class="kw">out</span> newHeight<span class="op">);</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update target dims</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    targetDims <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2Int</span><span class="op">(</span>newWidth<span class="op">,</span> newHeight<span class="op">);</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize the textures that store the model input</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeTextures</span><span class="op">();</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set up the neural network for the OpenVINO inference engine</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializeOpenVINO</span><span class="op">();</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updateinferencevalue-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updateinferencevalue-method">Create UpdateInferenceValue() Method</h4>
<p>This method will be called when the user interacts with the inference toggle. If the toggle is turned on, we will call the InitializeOpenVINO() method. Otherwise, we will disable all the bounding boxes.</p>
<section id="code-30" class="level5">
<h5 class="anchored" data-anchor-id="code-30">Code:</h5>
<div class="sourceCode" id="cb41"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when the value for the Inference toggle is updated</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateInferenceValue</span><span class="op">()</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Only update the performInference value if the canvas is active</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    performInference <span class="op">=</span> inference<span class="op">.</span><span class="fu">isOn</span><span class="op">;</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>performInference<span class="op">)</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">InitializeOpenVINO</span><span class="op">();</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Hide all bounding boxes when not performing inference</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> boundingBoxes<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>            boundingBoxes<span class="op">[</span>i<span class="op">].</span><span class="fu">ToggleBBox</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updatenmsthreshold-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updatenmsthreshold-method">Create UpdateNMSThreshold() Method</h4>
<p>This method will be called when the NMS threshold value is updated. It simply parses the user input and then calls the SetNMSThreshold() function in the plugin.</p>
<section id="code-31" class="level5">
<h5 class="anchored" data-anchor-id="code-31">Code:</h5>
<div class="sourceCode" id="cb42"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when the NMS threshold value is updated in the GUI</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"inputField"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateNMSThreshold</span><span class="op">(</span>TMPro<span class="op">.</span><span class="fu">TMP_InputField</span> inputField<span class="op">)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Parse the input field value</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> threshold<span class="op">;</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span><span class="op">.</span><span class="fu">TryParse</span><span class="op">(</span>inputField<span class="op">.</span><span class="fu">text</span><span class="op">,</span> <span class="kw">out</span> threshold<span class="op">);</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clamp threshold value between 0 and 1</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    threshold <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>threshold<span class="op">,</span> 1f<span class="op">);</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    threshold <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Max</span><span class="op">(</span>0f<span class="op">,</span> threshold<span class="op">);</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the threshold value</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    inputField<span class="op">.</span><span class="fu">text</span> <span class="op">=</span> $<span class="st">"{threshold}"</span><span class="op">;</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SetNMSThreshold</span><span class="op">(</span>threshold<span class="op">);</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updateconfidencethreshold-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updateconfidencethreshold-method">Create UpdateConfidenceThreshold() Method</h4>
<p>Likewise, this method is called when the confidence score threshold is updated, and calls the SetConfidenceThreshold() function in the plugin.</p>
<section id="code-32" class="level5">
<h5 class="anchored" data-anchor-id="code-32">Code:</h5>
<div class="sourceCode" id="cb43"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when the confidence threshold is updated in the GUI</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"inputField"</span><span class="kw">&gt;&lt;/param&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateConfThreshold</span><span class="op">(</span>TMPro<span class="op">.</span><span class="fu">TMP_InputField</span> inputField<span class="op">)</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Parse the input field value</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> threshold<span class="op">;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span><span class="op">.</span><span class="fu">TryParse</span><span class="op">(</span>inputField<span class="op">.</span><span class="fu">text</span><span class="op">,</span> <span class="kw">out</span> threshold<span class="op">);</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clamp threshold value between 0 and 1</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    threshold <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Min</span><span class="op">(</span>threshold<span class="op">,</span> 1f<span class="op">);</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    threshold <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Max</span><span class="op">(</span>0f<span class="op">,</span> threshold<span class="op">);</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the threshold value</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    inputField<span class="op">.</span><span class="fu">text</span> <span class="op">=</span> $<span class="st">"{threshold}"</span><span class="op">;</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SetConfidenceThreshold</span><span class="op">(</span>threshold<span class="op">);</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-updatevideo-method" class="level4">
<h4 class="anchored" data-anchor-id="create-updatevideo-method">Create UpdateVideo() Method</h4>
<p>This method will be called when a new video is selected from the video dropdown menu. We will only call the InitializationSteps() method if we are using the video player and not a webcam.</p>
<section id="code-33" class="level5">
<h5 class="anchored" data-anchor-id="code-33">Code:</h5>
<div class="sourceCode" id="cb44"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when a model option is selected from the dropdown</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UpdateVideo</span><span class="op">()</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>videoScreen<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>VideoPlayer<span class="op">&gt;().</span><span class="fu">enabled</span> <span class="op">==</span> <span class="kw">false</span><span class="op">)</span> <span class="kw">return</span><span class="op">;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Selected Video: {videoDropdown.value}"</span><span class="op">);</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializationSteps</span><span class="op">();</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-usewebcam-method" class="level4">
<h4 class="anchored" data-anchor-id="create-usewebcam-method">Create UseWebcam() Method</h4>
<p>This method will be called when the user interacts with the useWebcam toggle. If the user wants to use a webcam, we will first confirm that there is a webcam available. If there is not, we will disable the option to use a webcam.</p>
<p>If the user does not want to use a webcam, we will stop the webcam feed and re-enable the video player.</p>
<p>We need to call the InitializationSteps() method whether we are starting or stopping the webcam.</p>
<section id="code-34" class="level5">
<h5 class="anchored" data-anchor-id="code-34">Code:</h5>
<div class="sourceCode" id="cb45"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when the value for the Use Webcam toggle is updated</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">UseWebcam</span><span class="op">()</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>useWebcam<span class="op">.</span><span class="fu">isOn</span><span class="op">)</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>        WebCamDevice<span class="op">[]</span> devices <span class="op">=</span> WebCamTexture<span class="op">.</span><span class="fu">devices</span><span class="op">;</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> devices<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>devices<span class="op">[</span>i<span class="op">].</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>WebCamTexture<span class="op">.</span><span class="fu">devices</span><span class="op">.</span><span class="fu">Length</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"No webcam device detected."</span><span class="op">);</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>            useWebcam<span class="op">.</span><span class="fu">SetIsOnWithoutNotify</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Stop the webcam</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>        webcamTexture<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Activate the Video Player</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>        videoScreen<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>VideoPlayer<span class="op">&gt;().</span><span class="fu">enabled</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">InitializationSteps</span><span class="op">();</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="define-ondestroy-method" class="level4">
<h4 class="anchored" data-anchor-id="define-ondestroy-method">Define OnDestroy() Method</h4>
<p>When the script stops running, we will remove the Log() method from the logMessageReceived callback.</p>
<section id="code-35" class="level5">
<h5 class="anchored" data-anchor-id="code-35">Code:</h5>
<div class="sourceCode" id="cb46"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Called when the MonoBehaviour will be destroyed</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">OnDestroy</span><span class="op">()</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span>        </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    Application<span class="op">.</span><span class="fu">logMessageReceived</span> <span class="op">-=</span> Log<span class="op">;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-quit-method" class="level4">
<h4 class="anchored" data-anchor-id="create-quit-method">Create Quit() Method</h4>
<p>This method will be called when the Quit button is clicked in the user interface and will cause the application to exit.</p>
<section id="code-36" class="level5">
<h5 class="anchored" data-anchor-id="code-36">Code:</h5>
<div class="sourceCode" id="cb47"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when the Quit button is clicked.</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Quit</span><span class="op">()</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Causes the application to exit</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    Application<span class="op">.</span><span class="fu">Quit</span><span class="op">();</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That takes care of the required code for this project.</p>
</section>
</section>
</section>
</section>
<section id="attach-script-to-gameobject" class="level2">
<h2 class="anchored" data-anchor-id="attach-script-to-gameobject">Attach Script to GameObject</h2>
<p>To use the ObjectDetector script, we need to attach it to a GameObject. Right-click an empty space in the Hierarchy tab and select Create Empty. Name the new object Object Detector.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-create-empty.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>With the object still selected, drag and drop the ObjectDetector script into the Hierarchy tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-attach-object-detector-script.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Now we can drag and drop the objects in the Hierarchy tab into their associated spots in the Inspector tab.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-assign-hierarchy-objects.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Next, we will need to click the small lock button at the top of the Inspector tab to keep the Object Detector selected.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-lock-object-detector-inspector.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Now we can add the video files by selecting all of them in the Assets section and dragging them onto the Video Clips slot in the Inspector tab. We can unlock the Inspector tab after we have added the videos.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-add-video-clips-inspector.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="assign-ui-events" class="level2">
<h2 class="anchored" data-anchor-id="assign-ui-events">Assign UI Events</h2>
<p>The last step needed before we can build the project is to assign the UI events.</p>
<section id="input-dims" class="level3">
<h3 class="anchored" data-anchor-id="input-dims">Input Dims</h3>
<p>Open the UpdateInputDims container inside the Canvas object and select Width.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-select-width-object.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>In the Inspector tab, scroll down to On End Edit.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/width-inspector-on-end-edit-empty.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/width-inspector-on-end-edit-attach-object.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Click on the No Function dropdown menu and open the ObjectDetector section. Select the UpdateInputDims() method from the list.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/width-inspector-on-end-edit-select-function.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Perform the same steps for the Height object.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/height-inspector-on-end-edit-select-function.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="nms-threshold" class="level3">
<h3 class="anchored" data-anchor-id="nms-threshold">NMS Threshold</h3>
<p>Open the UpdateNMSThreshold container inside the Canvas object and select Threshold.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-select-nms-thresh-object.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>In the Inspector tab, scroll down to On End Edit. Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot. This time, select the UpdateNMSThreshold(TMP_InputField) option from the function menu.</p>
</section>
<section id="confidence-threshold" class="level3">
<h3 class="anchored" data-anchor-id="confidence-threshold">Confidence Threshold</h3>
<p>Open the UpdateConfidenceThreshold container inside the Canvas object and select Threshold. In the Inspector tab, scroll down to On End Edit. Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot. This time, select the UpdateConfThreshold(TMP_InputField) option from the function menu.</p>
</section>
<section id="device-dropdown" class="level3">
<h3 class="anchored" data-anchor-id="device-dropdown">Device Dropdown</h3>
<p>Select the Device object inside the Canvas. In the Inspector tab, scroll down to On Value Changed (Int32). Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot. This time, select the InitializeOpenVINO() option from the function menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/device-inspector-on-end-edit-select-function.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="model-dropdown" class="level3">
<h3 class="anchored" data-anchor-id="model-dropdown">Model Dropdown</h3>
<p>Select the Model object inside the Canvas. In the Inspector tab, scroll down to On Value Changed (Int32). Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot. Again, select the InitializeOpenVINO() option from the function menu.</p>
</section>
<section id="video-dropdown" class="level3">
<h3 class="anchored" data-anchor-id="video-dropdown">Video Dropdown</h3>
<p>Select the Video object inside the Canvas. In the Inspector tab, scroll down to On Value Changed (Int32). Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot. This time, select the UpdateVideo() option from the function menu.</p>
</section>
<section id="webcam-toggle" class="level3">
<h3 class="anchored" data-anchor-id="webcam-toggle">Webcam Toggle</h3>
<p>Select the Webcam object inside the Canvas. In the Inspector tab, scroll down to On Value Changed (Boolean). Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot. This time, select the UseWebcam() option from the function menu.</p>
</section>
<section id="inference" class="level3">
<h3 class="anchored" data-anchor-id="inference">Inference</h3>
<p>Select the Inference object inside the Canvas. In the Inspector tab, scroll down to On Value Changed (Boolean). Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot. This time, select the UpdateInferenceValue() option from the function menu.</p>
</section>
<section id="quit" class="level3">
<h3 class="anchored" data-anchor-id="quit">Quit</h3>
<p>Select the Quit object inside the Canvas. In the Inspector tab, scroll down to On Click(). Drag and drop the Object Detector object from the Hierarchy tab onto the None (Object) slot. This time, select the Quite() option from the function menu.</p>
</section>
</section>
<section id="build-the-project" class="level2">
<h2 class="anchored" data-anchor-id="build-the-project">Build the Project</h2>
<p>Now we can build the completed project. First, press Ctrl+s to save the project. Open the File menu and select Build Settings…</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-open-build-settings.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Click build in the popup window. You will be prompted to select a folder to store the files generated during the build.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/build-settings-build-project.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Create a new folder in the default location and name it Build. Click Select Folder.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/create-build-folder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Once the build is complete, a File Explorer window will open with the project executable selected.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/unity-project-executable.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="add-models-folder" class="level2">
<h2 class="anchored" data-anchor-id="add-models-folder">Add Models Folder</h2>
<p>Copy and paste <code>models</code> folder from part 1 into the folder with the project executable.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/build-folder-add-models.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="add-the-plugins-folder" class="level2">
<h2 class="anchored" data-anchor-id="add-the-plugins-folder">Add the Plugins folder</h2>
<p>Open the OpenVINO_YOLOX_Demo_Data folder inside the Build directory. Copy and paste the Plugins folder from part 2.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/build-folder-add-plugins.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="run-the-application" class="level2">
<h2 class="anchored" data-anchor-id="run-the-application">Run the Application</h2>
<p>At last, we can test our project. Double-click the executable to run it. Remember that the first time the application launches will be slow as the cache files are generated.</p>
</section>
<section id="next-steps" class="level1">
<h1>Next Steps</h1>
<p>We now have a general workflow for implementing real-time object detection with the OpenVINO™ Toolkit inside the Unity game engine.</p>
<p>As mentioned previously, these models can be trained for a wide variety of applications. They can even be combined with other models to add new capabilities like <a href="https://blog.roboflow.com/zero-shot-object-tracking/">tracking</a> unique objects across multiple frames.</p>
<p>Instructions for training these models on custom datasets can be found in the<a href="https://yolox.readthedocs.io/en/latest/train_custom_data.html">official documentation</a>. Alternatively, online services like<a href="https://blog.roboflow.com/how-to-train-yolox-on-a-custom-dataset/"></a><a href="https://blog.roboflow.com/how-to-train-yolox-on-a-custom-dataset/">roboflow</a> can make training more convenient. Trained models need to be converted from PyTorch to ONNX (<a href="https://github.com/Megvii-BaseDetection/YOLOX/tree/main/demo/ONNXRuntime">instructions</a>), before being converted to OpenVINO (<a href="https://github.com/Megvii-BaseDetection/YOLOX/tree/main/demo/OpenVINO/cpp">instructions</a>).</p>
<p><strong>Project Resources:</strong></p>
<p><a href="https://github.com/cj-mills/Unity-OpenVINO-YOLOX">GitHub Repository</a></p>


</section>

</main> <!-- /main -->
<!-- Cloudflare Web Analytics --><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;56b8d2f624604c4891327b3c0d9f6703&quot;}"></script><!-- End Cloudflare Web Analytics -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="cj-mills/christianjmills" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright 2023, Christian J. Mills
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>