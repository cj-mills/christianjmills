<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2021-12-06">
<meta name="description" content="This post covers how to modify the existing YOLOX project so that the plugin can be using in the Unity Editor.">

<title>Christian Mills - OpenVINO Object Detection in the Unity Editor (Outdated)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Christian Mills - OpenVINO Object Detection in the Unity Editor (Outdated)">
<meta property="og:description" content="This post covers how to modify the existing YOLOX project so that the plugin can be using in the Unity Editor.">
<meta property="og:image" content="christianjmills.com/images\logo.png">
<meta property="og:site-name" content="Christian Mills">
<meta property="og:image:height" content="295">
<meta property="og:image:width" content="300">
<meta name="twitter:title" content="Christian Mills - OpenVINO Object Detection in the Unity Editor (Outdated)">
<meta name="twitter:description" content="This post covers how to modify the existing YOLOX project so that the plugin can be using in the Unity Editor.">
<meta name="twitter:image" content="christianjmills.com/images\logo.png">
<meta name="twitter:creator" content="@cdotjdotmills">
<meta name="twitter:image-height" content="295">
<meta name="twitter:image-width" content="300">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Christian Mills</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cj-mills"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/cdotjdotmills"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">OpenVINO Object Detection in the Unity Editor (Outdated)</h1>
  </div>

<div>
  <div class="description">
    This post covers how to modify the existing YOLOX project so that the plugin can be using in the Unity Editor.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 6, 2021</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section">8/11/2022:</h3>
<ul>
<li>This tutorial is outdated. Use the new version at the link below.</li>
<li><a href="../../icevision-openvino-unity-tutorial/part-1/">End-to-End Object Detection for Unity With IceVision and OpenVINO Pt. 1</a></li>
</ul>
<hr>
</section>
<section id="previous-part-3" class="level3">
<h3 class="anchored" data-anchor-id="previous-part-3">Previous: <a href="../part-3/">Part 3</a></h3>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#install-new-openvino-version">Install New OpenVINO Version</a></li>
<li><a href="#update-openvino-project">Update OpenVINO Project</a></li>
<li><a href="#modify-unity-project">Modify Unity Project</a></li>
<li><a href="#run-in-editor">Run In Editor</a></li>
<li><a href="#build-the-project">Build the Project</a></li>
</ul>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In this follow-up to the YOLOX tutorial, we will update the OpenVINO and Unity code so that we can use the plugin directly in the Unity Editor. We will also make some additional changes to remove the need to manually move any files when building the Unity project.</p>
</section>
<section id="install-new-openvino-version" class="level2">
<h2 class="anchored" data-anchor-id="install-new-openvino-version">Install New OpenVINO Version</h2>
<p>To use the OpenVINO plugin inside the Unity editor, we will first update the OpenVINO project to <a href="https://www.intel.com/content/www/us/en/developer/articles/release-notes/openvino-2021-4-lts-relnotes.html">OpenVINO 2021.4.2</a>. This resolves the dependency conflict mentioned in the last part of this tutorial series.</p>
<p>New users can register for OpenVINO or download it directly from the links below.</p>
<p>• <a href="https://software.seek.intel.com/openvino-toolkit">Registration Link</a></p>
<p>• <a href="https://registrationcenter.intel.com/en/products/postregistration/?sn=C5RC-BZX263HW&amp;Sequence=632852&amp;encema=Wg/bUFJY2qspv9ef8QA1f1BOLNxZ1m3iLsVPacdcuTnDhAsIxOgbt1LgCVHooFk3zSUt/6VQWTA=&amp;dnld=t&amp;pass=yes">Download Link</a></p>
</section>
<section id="update-openvino-project" class="level2">
<h2 class="anchored" data-anchor-id="update-openvino-project">Update OpenVINO Project</h2>
<p>The code from the previous tutorial can be found at the repository linked below.</p>
<p>• <a href="https://github.com/cj-mills/Unity-OpenVINO-YOLOX">GitHub Repository</a></p>
<p>Once the download is complete, open the OpenVINO_YOLOX_DLL folder and double-click the OpenVINO_YOLOX_DLL.sln file to open the project in Visual Studio.</p>
<section id="update-include-directories" class="level3">
<h3 class="anchored" data-anchor-id="update-include-directories">Update Include Directories</h3>
<p>We need to tell Visual Studio where the new version of OpenVINO is located. In the Solution Explorer panel, right-click the project name.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/solutions_explorer_select_project_name.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">solutions_explorer_select_project_name</figcaption><p></p>
</figure>
</div>
<p>Select the Properties in the popup menu.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/solutions_explorer_open_properties.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">solutions_explorer_open_properties</figcaption><p></p>
</figure>
</div>
<p>In the Properties Window, open the C++ dropdown and click on All Options. Select the Additional Include Directories section and click on &lt;Edit..&gt; in the dropdown.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/properties_c++_all_options.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">properties_c++_all_options</figcaption><p></p>
</figure>
</div>
<p>Replace the existing Include Directories with the ones below.</p>
• C:Files (x86)_2021.4.752_tools_engine
• C:Files (x86)_2021.4.752
</section>
<section id="update-link-libraries" class="level3">
<h3 class="anchored" data-anchor-id="update-link-libraries">Update Link Libraries</h3>
<p>Next, open the Linker dropdown in the Properties window and select All Options. Scroll up to the top of the All Options section and select Additional Dependencies.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/linker_additional_dependencies.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">linker_additional_dependencies</figcaption><p></p>
</figure>
</div>
<p>Replace the existing Link Libraries with the ones below.</p>
<p>• C:Files (x86)_2021.4.752_tools_engine*</p>
<p>• C:Files (x86)_2021.4.752*</p>
<p>Back in the Properties window, click the Apply button and close the window.</p>
</section>
<section id="replace-getavailabledevices" class="level3">
<h3 class="anchored" data-anchor-id="replace-getavailabledevices">Replace GetAvailableDevices()</h3>
<p>We will replace the existing GetAvailableDevices() method with a new method called FindAvailableDevices(). We need to use a different method than storing the available device names in a comma separated string which has resulted in some string conversion issues in Unity.</p>
<p>First, we will make sure the available_devices vector is empty.</p>
<p>We will then iterate through each device name returned from ie.GetAvailableDevices() and add any CPU or GPU compute devices to available_devices.</p>
<p>We will skip any devices that contain GNA as the <a href="https://docs.openvino.ai/latest/openvino_docs_IE_DG_supported_plugins_GNA.html">Gaussian &amp; Neural Accelerator</a> only supports a <a href="https://docs.openvino.ai/latest/openvino_docs_IE_DG_supported_plugins_GNA.html#models-and-layers-limitations">limited set</a> of layer types.</p>
<p>We will still reverse available_devices so any GPU devices are selected first.</p>
<p>The method to set the location for the cache directory has changed from previous versions of OpenVINO. Now, we can set the directory for all GPUs using a single line.</p>
<p>Lastly, we will return the final number of available compute devices to Unity.</p>
<section id="code" class="level4">
<h4 class="anchored" data-anchor-id="code">Code:</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns an unparsed list of available compute devices</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>DLLExport <span class="dt">int</span> FindAvailableDevices<span class="op">(</span><span class="bu">std::</span>string<span class="op">*</span> device_list<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    available_devices<span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span><span class="op">&amp;&amp;</span> device <span class="op">:</span> ie<span class="op">.</span>GetAvailableDevices<span class="op">())</span> <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>device<span class="op">.</span>find<span class="op">(</span><span class="st">"GNA"</span><span class="op">)</span> <span class="op">!=</span> <span class="bu">std::</span>string<span class="bu">::</span>npos<span class="op">)</span> <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        available_devices<span class="op">.</span>push_back<span class="op">(</span>device<span class="op">);</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reverse the order of the list</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>reverse<span class="op">(</span>available_devices<span class="op">.</span>begin<span class="op">(),</span> available_devices<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Configure the cache directory for GPU compute devices</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    ie<span class="op">.</span>SetConfig<span class="op">({</span> <span class="op">{</span>CONFIG_KEY<span class="op">(</span>CACHE_DIR<span class="op">),</span> <span class="st">"cache"</span><span class="op">}</span> <span class="op">},</span> <span class="st">"GPU"</span><span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> available_devices<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-getdevicename" class="level3">
<h3 class="anchored" data-anchor-id="create-getdevicename">Create GetDeviceName()</h3>
<p>Next, we will create a function that returns the name for a device at a given index in available_devices. In Unity, we will use this function to iterate through the devices in available_devices. This will help us avoid the string conversion issues mentioned above.</p>
<section id="code-1" class="level4">
<h4 class="anchored" data-anchor-id="code-1">Code:</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>DLLExport <span class="bu">std::</span>string<span class="op">*</span> GetDeviceName<span class="op">(</span><span class="dt">int</span> index<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&amp;</span>available_devices<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create-freeresources" class="level3">
<h3 class="anchored" data-anchor-id="create-freeresources">Create FreeResources()</h3>
<p>The memory used for the variables might not get automatically freed when running the project in the Unity Editor. This can cause issues when entering Play mode in the editor multiple times. To avoid this, we will manually clear the memory for the vectors by calling the <a href="https://www.cplusplus.com/reference/vector/vector/clear/">clear()</a> method for each.</p>
<section id="code-2" class="level4">
<h4 class="anchored" data-anchor-id="code-2">Code:</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>DLLExport <span class="dt">void</span> FreeResources<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    available_devices<span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    grid_strides<span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    proposals<span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    picked<span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we can build the project as we did in the previous tutorial. Open the Build menu at the top of the Visual Studio window and click Build Solution.</p>
<p>Navigate to the x64 build folder in the File Explorer and open the Release child folder. Inside, we can see the new OpenVINO_YOLOX_DLL.dll file.</p>
</section>
</section>
<section id="gather-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="gather-dependencies">Gather Dependencies</h3>
<p>We need to gather the dependencies for the new OpenVINO version.</p>
<p>Here are the dependencies needed to use our new .dll:</p>
<p>• clDNNPlugin.dll</p>
<p>• inference_engine.dll</p>
<p>• inference_engine_ir_reader.dll</p>
<p>• inference_engine_legacy.dll</p>
<p>• inference_engine_lp_transformations.dll</p>
<p>• inference_engine_preproc.dll</p>
<p>• inference_engine_transformations.dll</p>
<p>• MKLDNNPlugin</p>
<p>• ngraph.dll</p>
<p>• opencv_core_parallel_tbb453_64.dll</p>
<p>• opencv_core453.dll</p>
<p>• opencv_imgcodecs453.dll</p>
<p>• opencv_imgproc453.dll</p>
<p>• plugins.xml</p>
<p>• tbb.dll</p>
<p>The required dependencies can be found in the following directories.</p>
<p>• OpenVINO: C:Files (x86)_2021.4.752_engine</p>
<p>• nGraph: C:Files (x86)_2021.4.752_tools</p>
<p>• TBB: C:Files (x86)_2021.4.752_tools_engine</p>
<p>• OpenCV: C:Files (x86)_2021.4.752</p>
<p>A folder containing the OpenVINO_YOLOX_DLL.dll file and its dependencies is also available to download at the link below.</p>
<p>• <a href="https://drive.google.com/drive/folders/1beawpD4Wai8iELJilPjj5ZVc4CQyE8Rq?usp=sharing">Plugins folder</a></p>
</section>
</section>
<section id="modify-unity-project" class="level2">
<h2 class="anchored" data-anchor-id="modify-unity-project">Modify Unity Project</h2>
<p>Now we can update the Unity project to accommodate the changes we made to the OpenVINO project. There are also some additional changes we will implement to make things easier when building the project.</p>
<section id="open-the-project" class="level3">
<h3 class="anchored" data-anchor-id="open-the-project">Open the Project</h3>
<p>Open the OpenVINO_YOLOX_Demo project in the Unity Editor.</p>
</section>
<section id="add-editor-tools" class="level3">
<h3 class="anchored" data-anchor-id="add-editor-tools">Add Editor Tools</h3>
<p>Next, create a new folder in the Assets section called Editor. Inside the Editor folder, create a new script called PrepareAssets. Open the script in the code editor.</p>
<section id="required-namespaces" class="level4">
<h4 class="anchored" data-anchor-id="required-namespaces">Required Namespaces</h4>
<p><a href="https://docs.unity3d.com/ScriptReference/UnityEditor.html">UnityEditor</a>: Implements the editor-specific APIs in Unity. It cannot be referenced by runtime code compiled into players.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEditor<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-refresh-method" class="level4">
<h4 class="anchored" data-anchor-id="create-refresh-method">Create Refresh() Method</h4>
<p>By default, plugin files are only loaded when the Unity Editor launches. That means we would need to restart the editor whenever we added new .dll files. However, we can avoid this by calling the <a href="https://docs.unity3d.com/ScriptReference/AssetDatabase.Refresh.html">AssetDatabase.Refresh()</a> method.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">MenuItem</span><span class="op">(</span><span class="st">"Tools/OpenVINO/Refresh"</span><span class="op">)]</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">static</span> <span class="dt">void</span> <span class="fu">Refresh</span><span class="op">()</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    AssetDatabase<span class="op">.</span><span class="fu">Refresh</span><span class="op">();</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Refreshing Asset Database."</span><span class="op">);</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-copytostreamingassets-method" class="level4">
<h4 class="anchored" data-anchor-id="create-copytostreamingassets-method">Create CopyToStreamingAssets() Method</h4>
<p>The YOLOX model files need to be copied to the StreamingAssets folder in order to be saved when the project is built.</p>
<p>The OpenVINO inference engine needs the plugins.xml file to know where the .dll files needed to perform inference with a CPU or GPU are located. However, Unity does not save .xml files in the Plugins folder when the project is built. We need to copy the plugins.xml file to the StreamingAssets folder so that the file gets saved in the build folder. We then need to copy the file back to the Plugins folder when the application first runs.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">MenuItem</span><span class="op">(</span><span class="st">"Tools/OpenVINO/Copy to StreamingAssets"</span><span class="op">)]</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">static</span> <span class="dt">void</span> <span class="fu">CopyToStreamingAssets</span><span class="op">()</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>AssetDatabase<span class="op">.</span><span class="fu">IsValidFolder</span><span class="op">(</span><span class="st">"Assets/StreamingAssets"</span><span class="op">)</span> <span class="op">==</span> <span class="kw">false</span><span class="op">)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Creating StreamingAssets folder."</span><span class="op">);</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        AssetDatabase<span class="op">.</span><span class="fu">CreateFolder</span><span class="op">(</span><span class="st">"Assets"</span><span class="op">,</span> <span class="st">"StreamingAssets"</span><span class="op">);</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>AssetDatabase<span class="op">.</span><span class="fu">IsValidFolder</span><span class="op">(</span><span class="st">"Assets/StreamingAssets/models"</span><span class="op">)</span> <span class="op">==</span> <span class="kw">false</span><span class="op">)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Copying models folder to StreamingAssets folder."</span><span class="op">);</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> success <span class="op">=</span> AssetDatabase<span class="op">.</span><span class="fu">CopyAsset</span><span class="op">(</span><span class="st">"Assets/OpenVINO/models"</span><span class="op">,</span> <span class="st">"Assets/StreamingAssets/models"</span><span class="op">);</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>success<span class="op">);</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"models folder already exists in StreamingAssets folder"</span><span class="op">);</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    AssetDatabase<span class="op">.</span><span class="fu">CopyAsset</span><span class="op">(</span><span class="st">"Assets/OpenVINO/Plugins/x86_64/plugins.xml"</span><span class="op">,</span> <span class="st">"Assets/StreamingAssets/plugins.xml"</span><span class="op">);</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="import-openvino-plugins" class="level3">
<h3 class="anchored" data-anchor-id="import-openvino-plugins">Import OpenVINO Plugins</h3>
<p>Back in the Assets section, create a new folder called OpenVINO. Drag and drop the Plugins folder from the file explorer into the OpenVINO folder.</p>
<section id="import-yolox-models" class="level4">
<h4 class="anchored" data-anchor-id="import-yolox-models">Import YOLOX Models</h4>
<p>Download the folder containing the models from the link below.</p>
<p>• <a href="https://drive.google.com/file/d/1N4GuHcKyBpDzJQ1r0LulzD3KRE3GRnAe/view">Google Drive Link</a></p>
<p>Extract the models folder from <code>models.tar</code> and drag it into the OpenVINO folder.</p>
<p>Open the Tools → OpenVINO submenu at the top of the Editor. Click the Refresh button to ensure the DLL files are loaded.</p>
<p>Then click the Copy to StreamingAssets button to copy the models folder and plugins.xml file to the StreamingAssets folder.</p>
</section>
</section>
<section id="remove-graphy-tool-optional" class="level3">
<h3 class="anchored" data-anchor-id="remove-graphy-tool-optional">Remove Graphy Tool (Optional)</h3>
<p>We can remove the Graphy tool since we can now use the in-editor performance metrics. Make sure to remove any references in the <code>ObjectDetector.cs</code> script.</p>
</section>
<section id="remove-the-console-view-optional" class="level3">
<h3 class="anchored" data-anchor-id="remove-the-console-view-optional">Remove the Console View (Optional)</h3>
<p>Likewise, we can remove the <code>Console View</code> object in the Canvas. Again, make sure to remove any references in the <code>ObjectDetector.cs</code> script.</p>
</section>
<section id="modify-objectdetector-script" class="level3">
<h3 class="anchored" data-anchor-id="modify-objectdetector-script">Modify ObjectDetector Script</h3>
<p>Open the <code>ObjectDetector.cs</code> script in the code editor.</p>
<section id="update-dll-method-declarations" class="level4">
<h4 class="anchored" data-anchor-id="update-dll-method-declarations">Update DLL Method Declarations</h4>
<p>Next, we need to replace the old DLL method declarations with the new functions we added earlier.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Name of the DLL file</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">string</span> dll <span class="op">=</span> <span class="st">"OpenVINO_YOLOX_DLL"</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">int</span> <span class="fu">FindAvailableDevices</span><span class="op">();</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> IntPtr <span class="fu">GetDeviceName</span><span class="op">(</span><span class="dt">int</span> index<span class="op">);</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> IntPtr <span class="fu">InitOpenVINO</span><span class="op">(</span><span class="dt">string</span> model<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">,</span> <span class="dt">int</span> device<span class="op">);</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">PerformInference</span><span class="op">(</span>IntPtr inputData<span class="op">);</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">PopulateObjectsArray</span><span class="op">(</span>IntPtr objects<span class="op">);</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">int</span> <span class="fu">GetObjectCount</span><span class="op">();</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">SetNMSThreshold</span><span class="op">(</span><span class="dt">float</span> threshold<span class="op">);</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">SetConfidenceThreshold</span><span class="op">(</span><span class="dt">float</span> threshold<span class="op">);</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">DllImport</span><span class="op">(</span>dll<span class="op">)]</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="kw">extern</span> <span class="dt">void</span> <span class="fu">FreeResources</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-awake-method" class="level4">
<h4 class="anchored" data-anchor-id="define-awake-method">Define Awake() Method</h4>
<p>When the built application first starts, we will check if the plugins.xml file is in the Plugins folder. If not, we will move the file from the StreamingAssets folder to the Plugins folder.</p>
<section id="code-3" class="level5">
<h5 class="anchored" data-anchor-id="code-3">Code:</h5>
<div class="sourceCode" id="cb8"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">Awake</span><span class="op">()</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">#if</span> UNITY_EDITOR_WIN</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">#else</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Checking for plugins.xml file"</span><span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> sourcePath <span class="op">=</span> $<span class="st">"{Application.streamingAssetsPath}/plugins.xml"</span><span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> targetPath <span class="op">=</span> $<span class="st">"{Application.dataPath}/Plugins/x86_64/plugins.xml"</span><span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>File<span class="op">.</span><span class="fu">Exists</span><span class="op">(</span>targetPath<span class="op">))</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"plugins.xml already in folder"</span><span class="op">);</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Moving plugins.xml file from StreamingAssets to Plugins folder."</span><span class="op">);</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        File<span class="op">.</span><span class="fu">Move</span><span class="op">(</span>sourcePath<span class="op">,</span> targetPath<span class="op">);</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">#endif</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="update-getopenvinomodels-method" class="level4">
<h4 class="anchored" data-anchor-id="update-getopenvinomodels-method">Update GetOpenVINOModels() Method</h4>
<p>We need to modify the <code>GetOpenVINOModels()</code> so that it searches the <code>StreamingAssets</code> folder. The path for the <code>StreamingAssets</code> folder is stored in the <code>Application.streamingAssetsPath</code> property.</p>
<section id="code-4" class="level5">
<h5 class="anchored" data-anchor-id="code-4">Code:</h5>
<div class="sourceCode" id="cb9"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">/// Get the list of available OpenVINO models</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">GetOpenVINOModels</span><span class="op">()</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the subdirectories containing the available models</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span><span class="op">[]</span> modelDirs <span class="op">=</span> System<span class="op">.</span><span class="fu">IO</span><span class="op">.</span><span class="fu">Directory</span><span class="op">.</span><span class="fu">GetDirectories</span><span class="op">(</span>Application<span class="op">.</span><span class="fu">streamingAssetsPath</span> <span class="op">+</span> <span class="st">"/models"</span><span class="op">);</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the model files in each subdirectory</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> openVINOFiles <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;();</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> dir <span class="kw">in</span> modelDirs<span class="op">)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        openVINOFiles<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>System<span class="op">.</span><span class="fu">IO</span><span class="op">.</span><span class="fu">Directory</span><span class="op">.</span><span class="fu">GetFiles</span><span class="op">(</span>dir<span class="op">));</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the paths for the .xml files for each model</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Available OpenVINO Models:"</span><span class="op">);</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span><span class="dt">string</span> file <span class="kw">in</span> openVINOFiles<span class="op">)</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>file<span class="op">.</span><span class="fu">EndsWith</span><span class="op">(</span><span class="st">".xml"</span><span class="op">))</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            openVINOPaths<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>file<span class="op">);</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">string</span> modelName <span class="op">=</span> file<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="ch">'\\'</span><span class="op">)[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>            openvinoModels<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>modelName<span class="op">.</span><span class="fu">Substring</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> modelName<span class="op">.</span><span class="fu">Length</span><span class="op">));</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"Model Name: {modelName}"</span><span class="op">);</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"File Path: {file}"</span><span class="op">);</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">""</span><span class="op">);</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="update-start-method" class="level4">
<h4 class="anchored" data-anchor-id="update-start-method">Update Start() Method</h4>
<p>We need to update the <code>if</code> statement in the <code>Start()</code> method so that it calls the new <code>FindAvailableDevices()</code> and <code>GetDeviceName()</code> functions we created earlier.</p>
<section id="code-5" class="level5">
<h5 class="anchored" data-anchor-id="code-5">Code:</h5>
<div class="sourceCode" id="cb10"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>processorType<span class="op">.</span><span class="fu">Contains</span><span class="op">(</span><span class="st">"Intel"</span><span class="op">)</span> <span class="op">||</span> graphicsDeviceName<span class="op">.</span><span class="fu">Contains</span><span class="op">(</span><span class="st">"Intel"</span><span class="op">))</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the list of available models</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">GetOpenVINOModels</span><span class="op">();</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"Available Devices:"</span><span class="op">);</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> deviceCount <span class="op">=</span> <span class="fu">FindAvailableDevices</span><span class="op">();</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> deviceCount<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        deviceList<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>Marshal<span class="op">.</span><span class="fu">PtrToStringAnsi</span><span class="op">(</span><span class="fu">GetDeviceName</span><span class="op">(</span>i<span class="op">)));</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>deviceList<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">else</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    inference<span class="op">.</span><span class="fu">isOn</span> <span class="op">=</span> performInference <span class="op">=</span> inference<span class="op">.</span><span class="fu">enabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span><span class="st">"No Intel hardware detected"</span><span class="op">);</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="call-freeresources-method" class="level4">
<h4 class="anchored" data-anchor-id="call-freeresources-method">Call FreeResources() Method</h4>
<p>We will call the <code>FreeResources()</code> method we created earlier in the <code>OnDisable()</code> method.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c# code-with-copy"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">private</span> <span class="dt">void</span> <span class="fu">OnDisable</span><span class="op">()</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">FreeResources</span><span class="op">();</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="run-in-editor" class="level2">
<h2 class="anchored" data-anchor-id="run-in-editor">Run In Editor</h2>
<p>Those are all the changes we need to make. Now we can try out the project in the editor.</p>
<p><video src="./videos/yolox_in-editor.mp4" class="img-fluid" controls=""><a href="./videos/yolox_in-editor.mp4">Video</a></video></p>
</section>
<section id="build-the-project" class="level2">
<h2 class="anchored" data-anchor-id="build-the-project">Build the Project</h2>
<p>With the modifications we made, we can now build and run the project like any other Unity project without needing to manually copy files anymore.</p>
<section id="next-in-game-camera" class="level3">
<h3 class="anchored" data-anchor-id="next-in-game-camera">Next: <a href="../in-game-camera/">In-Game Camera</a></h3>
<p><strong>Project Resources:</strong></p>
<p><a href="https://github.com/cj-mills/Unity-OpenVINO-YOLOX-In-Editor">GitHub Repository</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>